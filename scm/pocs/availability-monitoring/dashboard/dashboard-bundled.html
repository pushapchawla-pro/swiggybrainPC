<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Availability ActionBoard | Supply Chain Brain</title>
  <meta name="description" content="Availability ActionBoard - Supply Chain Brain MVP">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ§ </text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
/* ==========================================================================
   Design Tokens - Availability Monitoring Dashboard
   ========================================================================== */

:root {
  /* Primary Colors */
  --color-primary: #1e3a8a;
  --color-primary-light: #3b82f6;
  --color-primary-dark: #1e40af;

  /* Status Colors */
  --color-success: #16a34a;
  --color-success-light: #dcfce7;
  --color-warning: #ca8a04;
  --color-warning-light: #fefce8;
  --color-error: #dc2626;
  --color-error-light: #fef2f2;

  /* Priority Colors */
  --color-p0: #dc2626;
  --color-p0-bg: #fef2f2;
  --color-p1: #ea580c;
  --color-p1-bg: #fff7ed;
  --color-p2: #ca8a04;
  --color-p2-bg: #fefce8;

  /* Neutral Colors */
  --color-white: #ffffff;
  --color-gray-50: #f9fafb;
  --color-gray-100: #f3f4f6;
  --color-gray-200: #e5e7eb;
  --color-gray-300: #d1d5db;
  --color-gray-400: #9ca3af;
  --color-gray-500: #6b7280;
  --color-gray-600: #4b5563;
  --color-gray-700: #374151;
  --color-gray-800: #1f2937;
  --color-gray-900: #111827;

  /* Background Colors */
  --bg-primary: #f8fafc;
  --bg-card: #ffffff;
  --bg-sidebar: #1e293b;
  --bg-sidebar-hover: #334155;
  --bg-sidebar-active: #1e3a8a;

  /* Spacing Scale (4px base) */
  --space-1: 4px;
  --space-2: 8px;
  --space-3: 12px;
  --space-4: 16px;
  --space-5: 20px;
  --space-6: 24px;
  --space-8: 32px;
  --space-10: 40px;
  --space-12: 48px;
  --space-16: 64px;

  /* Typography */
  --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
  --font-mono: 'SF Mono', 'Fira Code', 'Fira Mono', Menlo, Monaco, Consolas, monospace;

  /* Font Sizes */
  --text-xs: 0.75rem;    /* 12px */
  --text-sm: 0.875rem;   /* 14px */
  --text-base: 1rem;     /* 16px */
  --text-lg: 1.125rem;   /* 18px */
  --text-xl: 1.25rem;    /* 20px */
  --text-2xl: 1.5rem;    /* 24px */
  --text-3xl: 1.875rem;  /* 30px */
  --text-4xl: 2.25rem;   /* 36px */

  /* Font Weights */
  --font-normal: 400;
  --font-medium: 500;
  --font-semibold: 600;
  --font-bold: 700;

  /* Line Heights */
  --leading-tight: 1.25;
  --leading-normal: 1.5;
  --leading-relaxed: 1.625;

  /* Border Radius */
  --radius-sm: 4px;
  --radius-md: 8px;
  --radius-lg: 12px;
  --radius-xl: 16px;
  --radius-full: 9999px;

  /* Shadows */
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
  --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);

  /* Transitions */
  --transition-fast: 150ms ease;
  --transition-normal: 200ms ease;
  --transition-slow: 300ms ease-out;

  /* Layout */
  --sidebar-width: 260px;
  --sidebar-collapsed-width: 60px;
  --header-height: 64px;
  --content-max-width: 1400px;

  /* Z-index Scale */
  --z-dropdown: 100;
  --z-sticky: 200;
  --z-modal: 300;
  --z-tooltip: 400;
}

/* Dark mode support (future) */
@media (prefers-color-scheme: dark) {
  :root {
    /* Dark mode tokens can be added here */
  }
}

/* ==========================================================================
   Base Styles - Reset, Typography, Utilities
   ========================================================================== */

/* Reset */
*,
*::before,
*::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  font-size: 16px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  font-family: var(--font-family);
  font-size: var(--text-sm);
  line-height: var(--leading-normal);
  color: var(--color-gray-800);
  background-color: var(--bg-primary);
  min-height: 100vh;
}

/* Typography */
h1, h2, h3, h4, h5, h6 {
  font-weight: var(--font-semibold);
  line-height: var(--leading-tight);
  color: var(--color-gray-900);
}

h1 { font-size: var(--text-3xl); }
h2 { font-size: var(--text-2xl); }
h3 { font-size: var(--text-xl); }
h4 { font-size: var(--text-lg); }
h5 { font-size: var(--text-base); }
h6 { font-size: var(--text-sm); }

p {
  margin-bottom: var(--space-4);
}

a {
  color: var(--color-primary-light);
  text-decoration: none;
  transition: color var(--transition-fast);
}

a:hover {
  color: var(--color-primary);
}

/* Lists */
ul, ol {
  list-style: none;
}

/* Images */
img {
  max-width: 100%;
  height: auto;
  display: block;
}

/* Buttons */
button {
  font-family: inherit;
  font-size: inherit;
  cursor: pointer;
  border: none;
  background: none;
}

/* Inputs */
input, select, textarea {
  font-family: inherit;
  font-size: inherit;
}

/* Tables */
table {
  border-collapse: collapse;
  width: 100%;
}

/* Scrollbar Styling */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--color-gray-100);
  border-radius: var(--radius-full);
}

::-webkit-scrollbar-thumb {
  background: var(--color-gray-300);
  border-radius: var(--radius-full);
}

::-webkit-scrollbar-thumb:hover {
  background: var(--color-gray-400);
}

/* ==========================================================================
   Utility Classes
   ========================================================================== */

/* Display */
.hidden { display: none !important; }
.block { display: block; }
.inline-block { display: inline-block; }
.flex { display: flex; }
.inline-flex { display: inline-flex; }
.grid { display: grid; }

/* Flexbox */
.flex-row { flex-direction: row; }
.flex-col { flex-direction: column; }
.flex-wrap { flex-wrap: wrap; }
.items-start { align-items: flex-start; }
.items-center { align-items: center; }
.items-end { align-items: flex-end; }
.justify-start { justify-content: flex-start; }
.justify-center { justify-content: center; }
.justify-end { justify-content: flex-end; }
.justify-between { justify-content: space-between; }
.gap-1 { gap: var(--space-1); }
.gap-2 { gap: var(--space-2); }
.gap-3 { gap: var(--space-3); }
.gap-4 { gap: var(--space-4); }
.gap-6 { gap: var(--space-6); }
.gap-8 { gap: var(--space-8); }
.flex-1 { flex: 1; }
.flex-shrink-0 { flex-shrink: 0; }

/* Spacing - Margin */
.m-0 { margin: 0; }
.m-auto { margin: auto; }
.mt-2 { margin-top: var(--space-2); }
.mt-4 { margin-top: var(--space-4); }
.mt-6 { margin-top: var(--space-6); }
.mt-8 { margin-top: var(--space-8); }
.mb-2 { margin-bottom: var(--space-2); }
.mb-4 { margin-bottom: var(--space-4); }
.mb-6 { margin-bottom: var(--space-6); }
.mb-8 { margin-bottom: var(--space-8); }
.ml-2 { margin-left: var(--space-2); }
.ml-4 { margin-left: var(--space-4); }
.mr-2 { margin-right: var(--space-2); }
.mr-4 { margin-right: var(--space-4); }

/* Spacing - Padding */
.p-0 { padding: 0; }
.p-2 { padding: var(--space-2); }
.p-3 { padding: var(--space-3); }
.p-4 { padding: var(--space-4); }
.p-6 { padding: var(--space-6); }
.p-8 { padding: var(--space-8); }
.px-2 { padding-left: var(--space-2); padding-right: var(--space-2); }
.px-4 { padding-left: var(--space-4); padding-right: var(--space-4); }
.px-6 { padding-left: var(--space-6); padding-right: var(--space-6); }
.py-2 { padding-top: var(--space-2); padding-bottom: var(--space-2); }
.py-4 { padding-top: var(--space-4); padding-bottom: var(--space-4); }
.py-6 { padding-top: var(--space-6); padding-bottom: var(--space-6); }

/* Text */
.text-xs { font-size: var(--text-xs); }
.text-sm { font-size: var(--text-sm); }
.text-base { font-size: var(--text-base); }
.text-lg { font-size: var(--text-lg); }
.text-xl { font-size: var(--text-xl); }
.text-2xl { font-size: var(--text-2xl); }
.text-3xl { font-size: var(--text-3xl); }

.font-normal { font-weight: var(--font-normal); }
.font-medium { font-weight: var(--font-medium); }
.font-semibold { font-weight: var(--font-semibold); }
.font-bold { font-weight: var(--font-bold); }

.text-left { text-align: left; }
.text-center { text-align: center; }
.text-right { text-align: right; }

.text-gray-400 { color: var(--color-gray-400); }
.text-gray-500 { color: var(--color-gray-500); }
.text-gray-600 { color: var(--color-gray-600); }
.text-gray-700 { color: var(--color-gray-700); }
.text-gray-900 { color: var(--color-gray-900); }
.text-primary { color: var(--color-primary); }
.text-success { color: var(--color-success); }
.text-warning { color: var(--color-warning); }
.text-error { color: var(--color-error); }
.text-white { color: var(--color-white); }

.uppercase { text-transform: uppercase; }
.lowercase { text-transform: lowercase; }
.capitalize { text-transform: capitalize; }

.truncate {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Backgrounds */
.bg-white { background-color: var(--color-white); }
.bg-gray-50 { background-color: var(--color-gray-50); }
.bg-gray-100 { background-color: var(--color-gray-100); }
.bg-primary { background-color: var(--color-primary); }
.bg-success-light { background-color: var(--color-success-light); }
.bg-warning-light { background-color: var(--color-warning-light); }
.bg-error-light { background-color: var(--color-error-light); }

/* Borders */
.border { border: 1px solid var(--color-gray-200); }
.border-t { border-top: 1px solid var(--color-gray-200); }
.border-b { border-bottom: 1px solid var(--color-gray-200); }
.border-l { border-left: 1px solid var(--color-gray-200); }
.border-r { border-right: 1px solid var(--color-gray-200); }
.rounded { border-radius: var(--radius-md); }
.rounded-sm { border-radius: var(--radius-sm); }
.rounded-lg { border-radius: var(--radius-lg); }
.rounded-xl { border-radius: var(--radius-xl); }
.rounded-full { border-radius: var(--radius-full); }

/* Shadows */
.shadow-sm { box-shadow: var(--shadow-sm); }
.shadow-md { box-shadow: var(--shadow-md); }
.shadow-lg { box-shadow: var(--shadow-lg); }

/* Width & Height */
.w-full { width: 100%; }
.h-full { height: 100%; }
.min-h-screen { min-height: 100vh; }

/* Overflow */
.overflow-hidden { overflow: hidden; }
.overflow-auto { overflow: auto; }
.overflow-x-auto { overflow-x: auto; }
.overflow-y-auto { overflow-y: auto; }

/* Position */
.relative { position: relative; }
.absolute { position: absolute; }
.fixed { position: fixed; }
.sticky { position: sticky; }

/* Cursor */
.cursor-pointer { cursor: pointer; }
.cursor-not-allowed { cursor: not-allowed; }

/* Transitions */
.transition {
  transition-property: background-color, border-color, color, fill, stroke, opacity, box-shadow, transform;
  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  transition-duration: 150ms;
}

/* Screen reader only */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* ==========================================================================
   Component Styles - Reusable UI Components
   ========================================================================== */

/* ==========================================================================
   KPI Card
   ========================================================================== */
.kpi-card {
  background: var(--bg-card);
  border-radius: var(--radius-lg);
  padding: var(--space-5);
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--color-gray-100);
  display: flex;
  flex-direction: column;
  min-width: 180px;
  transition: box-shadow var(--transition-normal);
}

.kpi-card:hover {
  box-shadow: var(--shadow-md);
}

.kpi-card__label {
  font-size: var(--text-xs);
  font-weight: var(--font-medium);
  color: var(--color-gray-500);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: var(--space-2);
}

.kpi-card__value {
  font-size: var(--text-3xl);
  font-weight: var(--font-bold);
  color: var(--color-gray-900);
  line-height: 1;
  margin-bottom: var(--space-3);
}

.kpi-card__target {
  font-size: var(--text-xs);
  color: var(--color-gray-500);
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

.kpi-card__trend {
  display: inline-flex;
  align-items: center;
  gap: var(--space-1);
  font-size: var(--text-xs);
  font-weight: var(--font-medium);
  padding: 2px 6px;
  border-radius: var(--radius-sm);
}

.kpi-card__trend--up {
  color: var(--color-error);
  background: var(--color-error-light);
}

.kpi-card__trend--down {
  color: var(--color-success);
  background: var(--color-success-light);
}

.kpi-card__trend--neutral {
  color: var(--color-gray-600);
  background: var(--color-gray-100);
}

/* Status variants */
.kpi-card--critical {
  border-left: 4px solid var(--color-error);
}

.kpi-card--warning {
  border-left: 4px solid var(--color-warning);
}

.kpi-card--good {
  border-left: 4px solid var(--color-success);
}

/* KPI Card - Expandable variant */
.kpi-card--expandable {
  cursor: pointer;
  transition: box-shadow var(--transition-fast), transform var(--transition-fast);
}

.kpi-card--expandable:hover {
  box-shadow: var(--shadow-md);
  transform: translateY(-2px);
}

.kpi-card--expandable.expanded {
  box-shadow: var(--shadow-lg);
}

.kpi-card__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.kpi-card__expand-icon {
  font-size: 10px;
  color: var(--color-gray-400);
  transition: transform var(--transition-normal);
}

.kpi-card.expanded .kpi-card__expand-icon {
  transform: rotate(180deg);
}

/* Trend section (collapsed by default) */
.kpi-card__trend-section {
  max-height: 0;
  overflow: hidden;
  transition: max-height var(--transition-slow), margin var(--transition-slow), padding var(--transition-slow);
  margin-top: 0;
}

.kpi-card.expanded .kpi-card__trend-section {
  max-height: 200px;
  margin-top: var(--space-4);
  padding-top: var(--space-3);
  border-top: 1px solid var(--color-gray-100);
}

/* Period selector buttons */
.kpi-card__period-selector {
  display: flex;
  gap: var(--space-1);
  margin-bottom: var(--space-3);
}

.kpi-card__period-btn {
  font-size: var(--text-xs);
  padding: var(--space-1) var(--space-2);
  border: 1px solid var(--color-gray-200);
  background: var(--bg-card);
  border-radius: var(--radius-sm);
  cursor: pointer;
  color: var(--color-gray-600);
  transition: all var(--transition-fast);
}

.kpi-card__period-btn:hover {
  background: var(--color-gray-50);
}

.kpi-card__period-btn.active {
  background: var(--color-primary);
  border-color: var(--color-primary);
  color: white;
}

/* Chart container */
.kpi-card__chart {
  height: 120px;
}

/* ==========================================================================
   Alert Card
   ========================================================================== */
.alert-card {
  background: var(--bg-card);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  overflow: hidden;
  transition: box-shadow var(--transition-normal);
  margin-bottom: var(--space-3);
}

.alert-card:hover {
  box-shadow: var(--shadow-md);
}

/* Priority variants */
.alert-card--p0 {
  border-left: 4px solid var(--color-p0);
  background: var(--color-p0-bg);
}

.alert-card--p1 {
  border-left: 4px solid var(--color-p1);
  background: var(--color-p1-bg);
}

.alert-card--p2 {
  border-left: 4px solid var(--color-p2);
  background: var(--color-p2-bg);
}

.alert-card__header {
  padding: var(--space-4);
  cursor: pointer;
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
}

.alert-card__top-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--space-4);
}

.alert-card__left {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  flex: 1;
  min-width: 0;
}

.alert-card__priority {
  font-size: var(--text-xs);
  font-weight: var(--font-bold);
  padding: 2px 8px;
  border-radius: var(--radius-sm);
  text-transform: uppercase;
  flex-shrink: 0;
}

.alert-card__priority--p0 {
  background: var(--color-p0);
  color: white;
}

.alert-card__priority--p1 {
  background: var(--color-p1);
  color: white;
}

.alert-card__priority--p2 {
  background: var(--color-p2);
  color: white;
}

.alert-card__scope {
  font-size: var(--text-xs);
  color: var(--color-gray-500);
  background: var(--color-gray-100);
  padding: 2px 8px;
  border-radius: var(--radius-sm);
  flex-shrink: 0;
}

.alert-card__entity {
  font-size: var(--text-base);
  font-weight: var(--font-semibold);
  color: var(--color-gray-900);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.alert-card__sparkline {
  width: 80px;
  height: 24px;
  flex-shrink: 0;
}

.alert-card__meta-row {
  display: flex;
  align-items: center;
  gap: var(--space-4);
  font-size: var(--text-sm);
  color: var(--color-gray-600);
}

.alert-card__meta-item {
  display: flex;
  align-items: center;
  gap: var(--space-1);
}

.alert-card__key-metric {
  font-size: var(--text-sm);
  color: var(--color-gray-700);
}

.alert-card__key-metric-value {
  font-weight: var(--font-semibold);
  color: var(--color-error);
}

.alert-card__expand-icon {
  margin-left: auto;
  transition: transform var(--transition-normal);
  color: var(--color-gray-400);
}

.alert-card.expanded .alert-card__expand-icon {
  transform: rotate(180deg);
}

/* Alert details (expandable) */
.alert-card__details {
  max-height: 0;
  overflow: hidden;
  transition: max-height var(--transition-slow);
  background: var(--bg-card);
  border-top: 1px solid var(--color-gray-200);
}

.alert-card.expanded .alert-card__details {
  max-height: 600px;
}

.alert-card__details-content {
  padding: var(--space-5);
  display: flex;
  flex-direction: column;
  gap: var(--space-4);
  background: var(--color-gray-50);
}

/* Top row with two columns */
.alert-card__details-row {
  display: grid;
  grid-template-columns: 1fr 1.5fr;
  gap: var(--space-5);
}

@media (max-width: 768px) {
  .alert-card__details-row {
    grid-template-columns: 1fr;
  }
}

.alert-card__section {
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
}

.alert-card__section-header {
  font-size: var(--text-xs);
  font-weight: var(--font-semibold);
  color: var(--color-gray-500);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

/* RCA section with left accent */
.alert-card__section--rca {
  background: white;
  border-radius: var(--radius-md);
  padding: var(--space-4);
  border-left: 4px solid var(--color-warning);
}

.alert-card__section--rca .alert-card__section-header {
  color: var(--color-warning-dark, #b45309);
}

/* Actions section with left accent */
.alert-card__section--actions {
  background: white;
  border-radius: var(--radius-md);
  padding: var(--space-4);
  border-left: 4px solid var(--color-primary);
}

.alert-card__section--actions .alert-card__section-header {
  color: var(--color-primary);
}

.alert-card__section-title {
  font-size: var(--text-xs);
  font-weight: var(--font-semibold);
  color: var(--color-gray-500);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

.alert-card__section-content {
  font-size: var(--text-sm);
  color: var(--color-gray-700);
  line-height: var(--leading-relaxed);
}

.alert-card__affected-list {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-2);
}

.alert-card__affected-item {
  font-size: var(--text-xs);
  padding: var(--space-1) var(--space-2);
  background: var(--color-gray-100);
  border-radius: var(--radius-sm);
  color: var(--color-gray-700);
}

.alert-card__attribution {
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
}

.alert-card__attribution-item {
  display: flex;
  align-items: center;
  gap: var(--space-3);
}

.alert-card__attribution-bar {
  flex: 1;
  height: 8px;
  background: var(--color-gray-100);
  border-radius: var(--radius-full);
  overflow: hidden;
}

.alert-card__attribution-fill {
  height: 100%;
  background: var(--color-primary);
  border-radius: var(--radius-full);
  transition: width var(--transition-slow);
}

.alert-card__attribution-label {
  font-size: var(--text-xs);
  color: var(--color-gray-600);
  min-width: 120px;
  flex-shrink: 0;
}

.alert-card__attribution-value {
  font-size: var(--text-xs);
  font-weight: var(--font-semibold);
  color: var(--color-gray-700);
  min-width: 40px;
  text-align: right;
}

.alert-card__rca {
  font-size: var(--text-sm);
  color: var(--color-gray-700);
  line-height: var(--leading-relaxed);
}

.alert-card__actions-list {
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
}

.alert-card__action-item {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  font-size: var(--text-sm);
  color: var(--color-gray-700);
}

.alert-card__action-bullet {
  width: 6px;
  height: 6px;
  background: var(--color-primary);
  border-radius: 50%;
  flex-shrink: 0;
}

/* Rich action items (actionable-style) */
.alert-action {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-3);
  background: var(--color-gray-50);
  border-radius: var(--radius-md);
  border: 1px solid var(--color-gray-100);
}

.alert-action__checkbox {
  width: 18px;
  height: 18px;
  border: 2px solid var(--color-gray-300);
  border-radius: var(--radius-sm);
  cursor: pointer;
  flex-shrink: 0;
  transition: all var(--transition-fast);
  position: relative;
}

.alert-action__checkbox:hover {
  border-color: var(--color-primary);
}

.alert-action__checkbox.checked {
  background: var(--color-success);
  border-color: var(--color-success);
}

.alert-action__checkbox.checked::after {
  content: "âœ“";
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: white;
  font-size: 12px;
  font-weight: bold;
}

.alert-action__content {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 2px;
  min-width: 0;
}

.alert-action__text {
  font-size: var(--text-sm);
  color: var(--color-gray-700);
}

.alert-action__text.line-through {
  text-decoration: line-through;
}

.alert-action__owner {
  font-size: var(--text-xs);
  color: var(--color-gray-500);
}

.alert-action__gmv {
  font-size: var(--text-sm);
  font-weight: var(--font-semibold);
  color: var(--color-gray-700);
  white-space: nowrap;
}

.alert-action__buttons {
  display: flex;
  gap: var(--space-2);
  flex-shrink: 0;
}

/* Extra small button variant */
.btn--xs {
  font-size: var(--text-xs);
  padding: var(--space-1) var(--space-2);
}

.alert-card__disclaimer {
  font-size: var(--text-xs);
  color: var(--color-gray-400);
  font-style: italic;
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding-top: var(--space-2);
  border-top: 1px solid var(--color-gray-200);
}

/* ==========================================================================
   Badge
   ========================================================================== */
.badge {
  display: inline-flex;
  align-items: center;
  gap: var(--space-1);
  font-size: var(--text-xs);
  font-weight: var(--font-medium);
  padding: 2px 8px;
  border-radius: var(--radius-full);
}

.badge--critical {
  background: var(--color-error-light);
  color: var(--color-error);
}

.badge--warning {
  background: var(--color-warning-light);
  color: var(--color-warning);
}

.badge--success {
  background: var(--color-success-light);
  color: var(--color-success);
}

.badge--neutral {
  background: var(--color-gray-100);
  color: var(--color-gray-600);
}

/* ==========================================================================
   Pill - Compact info display
   ========================================================================== */
.pill {
  display: inline-flex;
  align-items: center;
  gap: var(--space-1);
  font-size: var(--text-xs);
  font-weight: var(--font-medium);
  padding: var(--space-1) var(--space-3);
  border-radius: var(--radius-full);
  background: rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(4px);
  white-space: nowrap;
}

.pill--light {
  background: rgba(255, 255, 255, 0.9);
  color: var(--color-gray-700);
  border: 1px solid var(--color-gray-200);
}

.pill--dark {
  background: var(--color-gray-800);
  color: white;
}

.pill--primary {
  background: var(--color-primary-light);
  color: var(--color-primary);
  border: 1px solid var(--color-primary);
}

.pill--info {
  background: #e0f2fe;
  color: #0369a1;
  border: 1px solid #7dd3fc;
}

.pill--success {
  background: var(--color-success-light);
  color: var(--color-success);
  border: 1px solid var(--color-success);
}

.pill--warning {
  background: var(--color-warning-light);
  color: #92400e;
  border: 1px solid var(--color-warning);
}

.pill--error {
  background: var(--color-error-light);
  color: var(--color-error);
  border: 1px solid var(--color-error);
}

.pill__label {
  font-weight: var(--font-normal);
  opacity: 0.8;
}

.pill__value {
  font-weight: var(--font-bold);
}

/* Pill group - for displaying multiple pills together */
.pill-group {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-2);
  align-items: center;
}

/* Stat pill - for displaying value + label vertically */
.stat-pill {
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  padding: var(--space-2) var(--space-3);
  border-radius: var(--radius-md);
  background: var(--color-gray-50);
  border: 1px solid var(--color-gray-200);
  min-width: 60px;
}

.stat-pill__value {
  font-size: var(--text-base);
  font-weight: var(--font-bold);
  color: var(--color-gray-900);
  line-height: 1.2;
}

.stat-pill__label {
  font-size: var(--text-xs);
  color: var(--color-gray-500);
  text-transform: uppercase;
  letter-spacing: 0.03em;
}

.stat-pill--error .stat-pill__value {
  color: var(--color-error);
}

.stat-pill--warning .stat-pill__value {
  color: var(--color-warning);
}

.stat-pill--success .stat-pill__value {
  color: var(--color-success);
}

/* ==========================================================================
   Button
   ========================================================================== */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-2);
  padding: var(--space-2) var(--space-4);
  font-size: var(--text-sm);
  font-weight: var(--font-medium);
  border-radius: var(--radius-md);
  transition: all var(--transition-fast);
  cursor: pointer;
  border: none;
  white-space: nowrap;
}

.btn--primary {
  background: var(--color-primary);
  color: white;
}

.btn--primary:hover {
  background: var(--color-primary-dark);
}

.btn--secondary {
  background: var(--color-gray-100);
  color: var(--color-gray-700);
}

.btn--secondary:hover {
  background: var(--color-gray-200);
}

.btn--ghost {
  background: transparent;
  color: var(--color-gray-600);
}

.btn--ghost:hover {
  background: var(--color-gray-100);
}

.btn--sm {
  padding: var(--space-1) var(--space-3);
  font-size: var(--text-xs);
}

.btn--link {
  background: transparent;
  color: var(--color-primary-light);
  padding: 0;
}

.btn--link:hover {
  color: var(--color-primary);
  text-decoration: underline;
}

/* ==========================================================================
   Data Table
   ========================================================================== */
.data-table {
  width: 100%;
  background: var(--bg-card);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  overflow: hidden;
}

.data-table__wrapper {
  overflow-x: auto;
}

.data-table table {
  width: 100%;
  border-collapse: collapse;
}

.data-table th {
  text-align: left;
  padding: var(--space-3) var(--space-4);
  font-size: var(--text-xs);
  font-weight: var(--font-semibold);
  color: var(--color-gray-500);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  background: var(--color-gray-50);
  border-bottom: 1px solid var(--color-gray-200);
  white-space: nowrap;
}

.data-table td {
  padding: var(--space-3) var(--space-4);
  font-size: var(--text-sm);
  color: var(--color-gray-700);
  border-bottom: 1px solid var(--color-gray-100);
  vertical-align: middle;
}

.data-table tr:last-child td {
  border-bottom: none;
}

.data-table tr:hover td {
  background: var(--color-gray-50);
}

.data-table__owner {
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

.data-table__owner-icon {
  font-size: var(--text-lg);
}

.data-table__owner-name {
  font-weight: var(--font-medium);
  color: var(--color-gray-900);
}

.data-table__gmv {
  font-weight: var(--font-semibold);
  color: var(--color-gray-900);
}

.data-table__issue {
  max-width: 200px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ==========================================================================
   Actionable Item
   ========================================================================== */
.actionable-item {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-3) var(--space-4);
  background: var(--bg-card);
  border: 1px solid var(--color-gray-200);
  border-radius: var(--radius-md);
  transition: all var(--transition-fast);
}

.actionable-item:hover {
  border-color: var(--color-gray-300);
  box-shadow: var(--shadow-sm);
}

.actionable-item__checkbox {
  width: 18px;
  height: 18px;
  border: 2px solid var(--color-gray-300);
  border-radius: var(--radius-sm);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  transition: all var(--transition-fast);
}

.actionable-item__checkbox:hover {
  border-color: var(--color-primary);
}

.actionable-item__checkbox.checked {
  background: var(--color-primary);
  border-color: var(--color-primary);
}

.actionable-item__checkbox.checked::after {
  content: 'âœ“';
  color: white;
  font-size: var(--text-xs);
  font-weight: var(--font-bold);
}

.actionable-item__text {
  flex: 1;
  font-size: var(--text-sm);
  color: var(--color-gray-700);
}

.actionable-item__gmv {
  font-size: var(--text-sm);
  font-weight: var(--font-semibold);
  color: var(--color-gray-900);
  white-space: nowrap;
}

.actionable-item__actions {
  display: flex;
  gap: var(--space-2);
}

.actionable-list__disclaimer {
  margin-top: var(--space-3);
  padding: var(--space-3);
  background: var(--color-warning-light);
  border-radius: var(--radius-md);
  font-size: var(--text-xs);
  color: var(--color-warning);
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

/* ==========================================================================
   Chart Container
   ========================================================================== */
.chart-container {
  background: var(--bg-card);
  border-radius: var(--radius-lg);
  padding: var(--space-5);
  box-shadow: var(--shadow-sm);
}

.chart-container__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: var(--space-4);
}

.chart-container__title {
  font-size: var(--text-base);
  font-weight: var(--font-semibold);
  color: var(--color-gray-900);
}

.chart-container__subtitle {
  font-size: var(--text-xs);
  color: var(--color-gray-500);
}

.chart-container__canvas {
  position: relative;
  width: 100%;
}

/* ==========================================================================
   Section Header
   ========================================================================== */
.section-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: var(--space-4);
}

.section-header__title {
  font-size: var(--text-lg);
  font-weight: var(--font-semibold);
  color: var(--color-gray-900);
}

.section-header__subtitle {
  font-size: var(--text-sm);
  color: var(--color-gray-500);
  margin-top: var(--space-1);
}

/* ==========================================================================
   Empty State
   ========================================================================== */
.empty-state {
  text-align: center;
  padding: var(--space-12) var(--space-6);
  color: var(--color-gray-500);
}

.empty-state__icon {
  font-size: 48px;
  margin-bottom: var(--space-4);
  opacity: 0.5;
}

.empty-state__title {
  font-size: var(--text-lg);
  font-weight: var(--font-medium);
  color: var(--color-gray-700);
  margin-bottom: var(--space-2);
}

.empty-state__description {
  font-size: var(--text-sm);
  max-width: 300px;
  margin: 0 auto;
}

/* ==========================================================================
   Loading State
   ========================================================================== */
.loading {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-8);
}

.loading__spinner {
  width: 32px;
  height: 32px;
  border: 3px solid var(--color-gray-200);
  border-top-color: var(--color-primary);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* ==========================================================================
   KPI Tree Component (Compact)
   ========================================================================== */
.ktree-card {
  margin-bottom: var(--space-6);
}

.ktree-body {
  padding: var(--space-4) !important;
}

.ktree-legend {
  display: flex;
  gap: var(--space-4);
  font-size: var(--text-xs);
}

.ktree-legend__item {
  display: flex;
  align-items: center;
  gap: 4px;
  color: var(--color-gray-500);
}

.ktree-legend__item--wow {
  color: var(--color-gray-400);
  font-style: italic;
}

.ktree-legend__dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

.ktree-legend__dot--good { background: var(--color-success); }
.ktree-legend__dot--warn { background: var(--color-warning); }
.ktree-legend__dot--bad { background: var(--color-error); }

/* Root node */
.ktree-root {
  display: flex;
  gap: var(--space-4);
}

.ktree-root__node {
  background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
  color: white;
  padding: var(--space-4);
  border-radius: var(--radius-lg);
  min-width: 140px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  flex-shrink: 0;
}

.ktree-root__main {
  text-align: center;
}

.ktree-root__name {
  font-size: var(--text-xs);
  opacity: 0.8;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.ktree-root__value {
  font-size: var(--text-2xl);
  font-weight: var(--font-bold);
  display: block;
  margin: var(--space-1) 0;
}

.ktree-root__target {
  font-size: var(--text-xs);
  opacity: 0.7;
}

.ktree-root__meta {
  margin-top: var(--space-2);
  text-align: center;
}

.ktree-root__wow {
  font-size: var(--text-xs);
  padding: 2px 8px;
  border-radius: var(--radius-full);
  background: rgba(255,255,255,0.2);
}

/* Branches container */
.ktree-branches {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 2px;
  position: relative;
  padding-left: var(--space-4);
}

.ktree-branches::before {
  content: '';
  position: absolute;
  left: 0;
  top: 12px;
  bottom: 12px;
  width: 2px;
  background: var(--color-gray-200);
}

/* Branch node */
.ktree-branch {
  position: relative;
}

.ktree-branch::before {
  content: '';
  position: absolute;
  left: calc(-1 * var(--space-4));
  top: 14px;
  width: var(--space-4);
  height: 2px;
  background: var(--color-gray-200);
}

.ktree-branch--top > .ktree-branch__header {
  background: var(--color-error-light);
  border-color: var(--color-error);
}

.ktree-branch__header {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-2) var(--space-3);
  background: var(--color-gray-50);
  border: 1px solid var(--color-gray-200);
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: all var(--transition-fast);
  font-size: var(--text-sm);
}

.ktree-branch__header:hover {
  background: var(--color-gray-100);
}

.ktree-branch__toggle {
  font-size: 10px;
  color: var(--color-gray-400);
  transition: transform var(--transition-fast);
  width: 12px;
}

.ktree-branch.expanded .ktree-branch__toggle {
  transform: rotate(90deg);
}

.ktree-branch__name {
  font-weight: var(--font-medium);
  color: var(--color-gray-800);
  min-width: 100px;
}

.ktree-branch__pct {
  font-weight: var(--font-semibold);
  color: var(--color-gray-600);
  min-width: 36px;
}

.ktree-branch__wow {
  font-size: var(--text-xs);
  min-width: 32px;
}

.ktree-branch__owner {
  font-size: var(--text-xs);
  color: var(--color-gray-500);
  margin-left: auto;
}

.ktree-branch__top {
  font-size: 9px;
  font-weight: var(--font-bold);
  background: var(--color-error);
  color: white;
  padding: 1px 4px;
  border-radius: var(--radius-sm);
  text-transform: uppercase;
}

/* Branch children (collapsed by default) */
.ktree-branch__children {
  max-height: 0;
  overflow: hidden;
  transition: max-height var(--transition-slow);
  margin-left: var(--space-6);
  padding-left: var(--space-3);
  border-left: 2px dashed var(--color-gray-200);
}

.ktree-branch.expanded .ktree-branch__children {
  max-height: 500px;
  padding-top: var(--space-2);
  padding-bottom: var(--space-2);
}

/* Leaf node */
.ktree-leaf {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-1) var(--space-2);
  font-size: var(--text-xs);
  position: relative;
}

.ktree-leaf::before {
  content: 'â€¢';
  color: var(--color-gray-300);
}

.ktree-leaf--top {
  background: var(--color-error-light);
  border-radius: var(--radius-sm);
  margin: 2px 0;
}

.ktree-leaf__name {
  color: var(--color-gray-600);
  min-width: 80px;
}

.ktree-leaf__value {
  font-weight: var(--font-semibold);
  min-width: 70px;
}

.ktree-leaf__value--good { color: var(--color-success); }
.ktree-leaf__value--warn { color: var(--color-warning); }
.ktree-leaf__value--bad { color: var(--color-error); }

.ktree-leaf__wow {
  font-size: 10px;
  padding: 1px 4px;
  border-radius: var(--radius-sm);
  min-width: 28px;
  text-align: center;
}

.ktree-leaf__wow--good {
  background: var(--color-success-light);
  color: var(--color-success);
}

.ktree-leaf__wow--bad {
  background: var(--color-error-light);
  color: var(--color-error);
}

.ktree-leaf__owner {
  font-size: var(--text-sm);
}

/* ==========================================================================
   Custom Dropdown
   ========================================================================== */
.dropdown {
  position: relative;
  display: inline-block;
}

.dropdown__trigger {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-2) var(--space-3);
  background: var(--bg-card);
  border: 1px solid var(--color-gray-200);
  border-radius: var(--radius-md);
  font-size: var(--text-sm);
  color: var(--color-gray-600);
  cursor: pointer;
  min-width: 140px;
  transition: all var(--transition-fast);
}

.dropdown__trigger:hover {
  border-color: var(--color-gray-300);
  background: var(--color-gray-50);
}

.dropdown.open .dropdown__trigger {
  border-color: var(--color-primary);
  box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.1);
}

.dropdown__value {
  flex: 1;
  text-align: left;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.dropdown__value--selected {
  color: var(--color-gray-900);
  font-weight: var(--font-medium);
}

.dropdown__arrow {
  font-size: 10px;
  color: var(--color-gray-400);
  transition: transform var(--transition-fast);
}

.dropdown.open .dropdown__arrow {
  transform: rotate(180deg);
}

.dropdown__menu {
  position: absolute;
  top: calc(100% + 4px);
  left: 0;
  min-width: 100%;
  background: var(--bg-card);
  border: 1px solid var(--color-gray-200);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  z-index: 100;
  opacity: 0;
  visibility: hidden;
  transform: translateY(-8px);
  transition: all var(--transition-fast);
}

.dropdown.open .dropdown__menu {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}

.dropdown__item {
  padding: var(--space-2) var(--space-3);
  font-size: var(--text-sm);
  color: var(--color-gray-700);
  cursor: pointer;
  transition: background var(--transition-fast);
}

.dropdown__item:first-child {
  border-radius: var(--radius-md) var(--radius-md) 0 0;
}

.dropdown__item:last-child {
  border-radius: 0 0 var(--radius-md) var(--radius-md);
}

.dropdown__item:hover {
  background: var(--color-gray-50);
}

.dropdown__item.selected {
  background: var(--color-primary-light);
  color: var(--color-primary);
  font-weight: var(--font-medium);
}

/* ==========================================================================
   Dashboard Layout Styles
   ========================================================================== */

/* ==========================================================================
   App Shell
   ========================================================================== */
.app {
  display: flex;
  min-height: 100vh;
}

/* ==========================================================================
   Sidebar Navigation
   ========================================================================== */
.sidebar {
  width: var(--sidebar-width);
  background: var(--bg-sidebar);
  color: var(--color-white);
  display: flex;
  flex-direction: column;
  position: fixed;
  top: 0;
  left: 0;
  bottom: 0;
  z-index: var(--z-sticky);
  transition: width var(--transition-normal);
}

.sidebar__header {
  padding: var(--space-5);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.sidebar__logo {
  display: flex;
  align-items: center;
  gap: var(--space-3);
}

.sidebar__logo-icon {
  width: 36px;
  height: 36px;
  background: var(--color-primary-light);
  border-radius: var(--radius-md);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--text-xl);
}

.sidebar__logo-text {
  font-size: var(--text-base);
  font-weight: var(--font-semibold);
}

.sidebar__logo-subtitle {
  font-size: var(--text-xs);
  color: var(--color-gray-400);
}

.sidebar__nav {
  flex: 1;
  padding: var(--space-4);
  overflow-y: auto;
}

.sidebar__section {
  margin-bottom: var(--space-6);
}

.sidebar__section-title {
  font-size: var(--text-xs);
  font-weight: var(--font-semibold);
  color: var(--color-gray-400);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  padding: var(--space-2) var(--space-3);
  margin-bottom: var(--space-2);
}

.nav-item {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-3);
  border-radius: var(--radius-md);
  color: var(--color-gray-300);
  text-decoration: none;
  transition: all var(--transition-fast);
  margin-bottom: var(--space-1);
  cursor: pointer;
}

.nav-item:hover {
  background: var(--bg-sidebar-hover);
  color: var(--color-white);
}

.nav-item.active {
  background: var(--bg-sidebar-active);
  color: var(--color-white);
}

.nav-item__icon {
  font-size: var(--text-lg);
  width: 24px;
  text-align: center;
}

.nav-item__label {
  font-size: var(--text-sm);
  font-weight: var(--font-medium);
}

.nav-item__badge {
  margin-left: auto;
  font-size: var(--text-xs);
  background: var(--color-error);
  color: white;
  padding: 2px 6px;
  border-radius: var(--radius-full);
  font-weight: var(--font-semibold);
}

/* ==========================================================================
   Main Content Area
   ========================================================================== */
.main-content {
  flex: 1;
  margin-left: var(--sidebar-width);
  min-height: 100vh;
  width: calc(100% - var(--sidebar-width));
  display: flex;
  flex-direction: column;
  overflow-x: hidden;
}

/* ==========================================================================
   Dashboard Header
   ========================================================================== */
.dashboard-header {
  background: linear-gradient(135deg, var(--color-primary) 0%, #1e3a5f 100%);
  color: white;
  padding: var(--space-5) var(--space-6);
  position: sticky;
  top: 0;
  z-index: var(--z-sticky);
  width: 100%;
  box-sizing: border-box;
  border-radius: 0 0 var(--radius-lg) var(--radius-lg);
  margin-bottom: var(--space-4);
}

.dashboard-header__top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: var(--space-3);
}

.dashboard-header__title {
  font-size: var(--text-2xl);
  font-weight: var(--font-bold);
  color: white;
  display: flex;
  align-items: center;
  gap: var(--space-3);
}

.dashboard-header__icon {
  font-size: 2rem;
  background: rgba(255, 255, 255, 0.2);
  width: 48px;
  height: 48px;
  border-radius: var(--radius-lg);
  display: flex;
  align-items: center;
  justify-content: center;
}

.dashboard-header__actions {
  display: flex;
  align-items: center;
  gap: var(--space-3);
}

.dashboard-header__actions .btn--secondary {
  background: rgba(255, 255, 255, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.dashboard-header__actions .btn--secondary:hover {
  background: rgba(255, 255, 255, 0.25);
}

.dashboard-header__actions .btn--primary {
  background: white;
  color: var(--color-primary);
}

.dashboard-header__actions .btn--primary:hover {
  background: rgba(255, 255, 255, 0.9);
}

.dashboard-header__meta {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  font-size: var(--text-sm);
}

.dashboard-header__meta-item {
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

.dashboard-header__meta-label {
  color: rgba(255, 255, 255, 0.7);
}

.dashboard-header__meta-value {
  font-weight: var(--font-semibold);
  color: white;
}

/* ==========================================================================
   Dashboard Content
   ========================================================================== */
.dashboard-content {
  flex: 1;
  padding: var(--space-6);
  width: 100%;
  max-width: var(--content-max-width);
  box-sizing: border-box;
}

/* ==========================================================================
   KPI Grid
   ========================================================================== */
.kpi-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--space-4);
  margin-bottom: var(--space-6);
}

.kpi-grid--5 {
  grid-template-columns: repeat(5, 1fr);
}

.kpi-grid--4 {
  grid-template-columns: repeat(4, 1fr);
}

/* ==========================================================================
   Chart Grid
   ========================================================================== */
.chart-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--space-6);
  margin-bottom: var(--space-6);
}

.chart-grid--3 {
  grid-template-columns: repeat(3, 1fr);
}

.chart-grid__item {
  min-height: 300px;
}

.chart-grid__item--span-2 {
  grid-column: span 2;
}

/* ==========================================================================
   Alert List
   ========================================================================== */
.alert-list {
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
}

.alert-list__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: var(--space-4);
}

.alert-list__title {
  font-size: var(--text-lg);
  font-weight: var(--font-semibold);
  color: var(--color-gray-900);
}

.alert-list__count {
  font-size: var(--text-sm);
  color: var(--color-gray-500);
}

/* ==========================================================================
   Actionables Section
   ========================================================================== */
.actionables-section {
  background: var(--bg-card);
  border-radius: var(--radius-lg);
  padding: var(--space-5);
  box-shadow: var(--shadow-sm);
  margin-top: var(--space-6);
}

.actionables-section__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: var(--space-4);
}

.actionables-section__title {
  font-size: var(--text-base);
  font-weight: var(--font-semibold);
  color: var(--color-gray-900);
}

.actionables-list {
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
}

/* ==========================================================================
   Two Column Layout
   ========================================================================== */
.two-column {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-6);
}

.two-column--wide-left {
  grid-template-columns: 2fr 1fr;
}

.two-column--wide-right {
  grid-template-columns: 1fr 2fr;
}

/* ==========================================================================
   Card
   ========================================================================== */
.card {
  background: var(--bg-card);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  overflow: hidden;
}

.card__header {
  padding: var(--space-4) var(--space-5);
  border-bottom: 1px solid var(--color-gray-100);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.card__title {
  font-size: var(--text-base);
  font-weight: var(--font-semibold);
  color: var(--color-gray-900);
}

.card__body {
  padding: var(--space-5);
}

.card__footer {
  padding: var(--space-4) var(--space-5);
  border-top: 1px solid var(--color-gray-100);
  background: var(--color-gray-50);
}

/* ==========================================================================
   Summary Stats Row
   ========================================================================== */
.summary-stats {
  display: flex;
  align-items: center;
  gap: var(--space-6);
  padding: var(--space-4) var(--space-5);
  background: var(--color-gray-50);
  border-radius: var(--radius-lg);
  margin-bottom: var(--space-6);
}

.summary-stat {
  display: flex;
  flex-direction: column;
}

.summary-stat__label {
  font-size: var(--text-xs);
  color: var(--color-gray-500);
  margin-bottom: var(--space-1);
}

.summary-stat__value {
  font-size: var(--text-lg);
  font-weight: var(--font-semibold);
  color: var(--color-gray-900);
}

.summary-stat__change {
  font-size: var(--text-xs);
  margin-top: var(--space-1);
}

.summary-stat__change--positive {
  color: var(--color-success);
}

.summary-stat__change--negative {
  color: var(--color-error);
}

/* ==========================================================================
   Horizontal Bar Chart (Custom)
   ========================================================================== */
.h-bar-chart {
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
}

.h-bar-chart__item {
  display: flex;
  align-items: center;
  gap: var(--space-3);
}

.h-bar-chart__label {
  width: 160px;
  min-width: 160px;
  max-width: 160px;
  flex-shrink: 0;
  font-size: var(--text-sm);
  color: var(--color-gray-700);
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

.h-bar-chart__icon {
  font-size: var(--text-base);
}

.h-bar-chart__bar-container {
  flex: 1;
  height: 24px;
  background: var(--color-gray-100);
  border-radius: var(--radius-sm);
  overflow: hidden;
}

.h-bar-chart__bar {
  height: 100%;
  background: var(--color-primary);
  border-radius: var(--radius-sm);
  transition: width var(--transition-slow);
  display: flex;
  align-items: center;
  justify-content: flex-end;
  padding-right: var(--space-2);
}

.h-bar-chart__value {
  min-width: 60px;
  text-align: right;
  font-size: var(--text-sm);
  font-weight: var(--font-semibold);
  color: var(--color-gray-900);
}

/* ==========================================================================
   Breakdown List
   ========================================================================== */
.breakdown-list {
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
}

.breakdown-item {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-2) 0;
}

.breakdown-item__label {
  flex: 1;
  font-size: var(--text-sm);
  color: var(--color-gray-700);
}

.breakdown-item__value {
  font-size: var(--text-sm);
  font-weight: var(--font-semibold);
  color: var(--color-gray-900);
  min-width: 50px;
  text-align: right;
}

.breakdown-item__bar {
  width: 100px;
  height: 6px;
  background: var(--color-gray-100);
  border-radius: var(--radius-full);
  overflow: hidden;
}

.breakdown-item__bar-fill {
  height: 100%;
  border-radius: var(--radius-full);
  transition: width var(--transition-slow);
}

/* ==========================================================================
   Filter Bar
   ========================================================================== */
.filter-bar {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-3) var(--space-4);
  background: var(--color-gray-50);
  border-radius: var(--radius-md);
  margin-bottom: var(--space-4);
}

.filter-bar__label {
  font-size: var(--text-sm);
  color: var(--color-gray-500);
}

.filter-bar__select {
  padding: var(--space-2) var(--space-3);
  font-size: var(--text-sm);
  border: 1px solid var(--color-gray-300);
  border-radius: var(--radius-md);
  background: var(--color-white);
  color: var(--color-gray-700);
  cursor: pointer;
}

.filter-bar__select:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
}

/* ==========================================================================
   Top Alerts Table
   ========================================================================== */
.top-alerts-table {
  width: 100%;
}

.top-alerts-table th {
  text-align: left;
  padding: var(--space-3) var(--space-4);
  font-size: var(--text-xs);
  font-weight: var(--font-semibold);
  color: var(--color-gray-500);
  text-transform: uppercase;
  border-bottom: 2px solid var(--color-gray-200);
}

.top-alerts-table td {
  padding: var(--space-3) var(--space-4);
  font-size: var(--text-sm);
  border-bottom: 1px solid var(--color-gray-100);
}

.top-alerts-table tr:hover td {
  background: var(--color-gray-50);
}

.top-alerts-table__rank {
  font-weight: var(--font-bold);
  color: var(--color-gray-400);
}

.top-alerts-table__entity {
  font-weight: var(--font-medium);
  color: var(--color-gray-900);
}

.top-alerts-table__gmv {
  font-weight: var(--font-semibold);
  color: var(--color-error);
}

/* ==========================================================================
   Actionable Completion Widget
   ========================================================================== */
.completion-widget {
  background: var(--bg-card);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  padding: var(--space-5);
  height: 100%;
}

.completion-widget__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: var(--space-4);
  padding-bottom: var(--space-3);
  border-bottom: 1px solid var(--color-gray-100);
}

.completion-widget__title {
  font-size: var(--text-base);
  font-weight: var(--font-semibold);
  color: var(--color-gray-900);
}

.completion-widget__overall {
  text-align: center;
  margin-bottom: var(--space-5);
}

.completion-widget__circle {
  position: relative;
  width: 120px;
  height: 120px;
  margin: 0 auto var(--space-3);
}

.completion-widget__circle-bg {
  fill: none;
  stroke: var(--color-gray-100);
  stroke-width: 10;
}

.completion-widget__circle-progress {
  fill: none;
  stroke: var(--color-success);
  stroke-width: 10;
  stroke-linecap: round;
  transform: rotate(-90deg);
  transform-origin: 50% 50%;
  transition: stroke-dashoffset var(--transition-slow);
}

.completion-widget__circle-progress--warning {
  stroke: var(--color-warning);
}

.completion-widget__circle-progress--critical {
  stroke: var(--color-error);
}

.completion-widget__percentage {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: var(--text-2xl);
  font-weight: var(--font-bold);
  color: var(--color-gray-900);
}

.completion-widget__label {
  font-size: var(--text-sm);
  color: var(--color-gray-500);
}

.completion-widget__section {
  margin-bottom: var(--space-4);
}

.completion-widget__section-title {
  font-size: var(--text-xs);
  font-weight: var(--font-semibold);
  text-transform: uppercase;
  color: var(--color-gray-400);
  margin-bottom: var(--space-3);
  letter-spacing: 0.05em;
}

.completion-widget__item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-2) 0;
  border-bottom: 1px solid var(--color-gray-50);
}

.completion-widget__item:last-child {
  border-bottom: none;
}

.completion-widget__item-left {
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

.completion-widget__item-icon {
  font-size: var(--text-base);
}

.completion-widget__item-name {
  font-size: var(--text-sm);
  color: var(--color-gray-700);
}

.completion-widget__item-right {
  display: flex;
  align-items: center;
  gap: var(--space-3);
}

.completion-widget__item-bar {
  width: 60px;
  height: 6px;
  background: var(--color-gray-100);
  border-radius: var(--radius-full);
  overflow: hidden;
}

.completion-widget__item-bar-fill {
  height: 100%;
  border-radius: var(--radius-full);
  transition: width var(--transition-slow);
}

.completion-widget__item-bar-fill--good {
  background: var(--color-success);
}

.completion-widget__item-bar-fill--warning {
  background: var(--color-warning);
}

.completion-widget__item-bar-fill--critical {
  background: var(--color-error);
}

.completion-widget__item-value {
  font-size: var(--text-sm);
  font-weight: var(--font-semibold);
  color: var(--color-gray-900);
  min-width: 40px;
  text-align: right;
}

/* Side by side layout for executive dashboard */
.exec-row {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: var(--space-6);
  margin-bottom: var(--space-6);
}

.exec-row--equal {
  grid-template-columns: 1fr 1fr;
}

/* ==========================================================================
   Responsive Styles - Mobile & Tablet Adaptations
   ========================================================================== */

/* ==========================================================================
   Tablet (768px - 1024px)
   ========================================================================== */
@media screen and (max-width: 1024px) {
  :root {
    --sidebar-width: 220px;
  }

  .kpi-grid--5 {
    grid-template-columns: repeat(3, 1fr);
  }

  .kpi-grid--4 {
    grid-template-columns: repeat(2, 1fr);
  }

  .chart-grid {
    grid-template-columns: 1fr;
  }

  .chart-grid__item--span-2 {
    grid-column: span 1;
  }

  .two-column,
  .two-column--wide-left,
  .two-column--wide-right {
    grid-template-columns: 1fr;
  }

  .dashboard-header__meta {
    flex-wrap: wrap;
    gap: var(--space-2);
  }

  .h-bar-chart__label {
    min-width: 120px;
  }
}

/* ==========================================================================
   Mobile (< 768px)
   ========================================================================== */
@media screen and (max-width: 768px) {
  /* Sidebar collapses to hamburger menu on mobile */
  .sidebar {
    width: 100%;
    transform: translateX(-100%);
    transition: transform var(--transition-normal);
  }

  .sidebar.open {
    transform: translateX(0);
  }

  .main-content {
    margin-left: 0;
  }

  /* Mobile menu toggle */
  .mobile-menu-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: var(--color-gray-100);
    border-radius: var(--radius-md);
    cursor: pointer;
    font-size: var(--text-lg);
  }

  .mobile-menu-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: calc(var(--z-sticky) - 1);
    opacity: 0;
    pointer-events: none;
    transition: opacity var(--transition-normal);
  }

  .mobile-menu-overlay.visible {
    opacity: 1;
    pointer-events: auto;
  }

  /* Dashboard header mobile */
  .dashboard-header {
    padding: var(--space-3) var(--space-4);
  }

  .dashboard-header__top {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--space-2);
  }

  .dashboard-header__title {
    font-size: var(--text-lg);
  }

  .dashboard-header__actions {
    width: 100%;
    justify-content: space-between;
  }

  .dashboard-header__meta {
    display: none;
  }

  /* Dashboard content mobile */
  .dashboard-content {
    padding: var(--space-4);
  }

  /* KPI grid mobile */
  .kpi-grid,
  .kpi-grid--5,
  .kpi-grid--4 {
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-3);
  }

  .kpi-card {
    padding: var(--space-3);
    min-width: auto;
  }

  .kpi-card__value {
    font-size: var(--text-2xl);
  }

  /* Alert cards mobile */
  .alert-card__top-row {
    flex-wrap: wrap;
    gap: var(--space-2);
  }

  .alert-card__left {
    width: 100%;
  }

  .alert-card__sparkline {
    display: none;
  }

  .alert-card__meta-row {
    flex-wrap: wrap;
    gap: var(--space-2);
  }

  .alert-card__details-content {
    padding: var(--space-3);
  }

  /* Data table mobile */
  .data-table {
    font-size: var(--text-xs);
  }

  .data-table th,
  .data-table td {
    padding: var(--space-2) var(--space-3);
  }

  .data-table__issue {
    max-width: 120px;
  }

  /* Actionable items mobile */
  .actionable-item {
    flex-wrap: wrap;
    gap: var(--space-2);
  }

  .actionable-item__text {
    width: 100%;
    order: 1;
  }

  .actionable-item__checkbox {
    order: 0;
  }

  .actionable-item__gmv {
    order: 2;
    margin-left: auto;
  }

  .actionable-item__actions {
    order: 3;
  }

  /* Charts mobile */
  .chart-container {
    padding: var(--space-3);
  }

  .chart-container__header {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--space-2);
  }

  /* Horizontal bar chart mobile */
  .h-bar-chart__item {
    flex-wrap: wrap;
  }

  .h-bar-chart__label {
    width: 100%;
    min-width: auto;
    margin-bottom: var(--space-1);
  }

  .h-bar-chart__bar-container {
    flex: 1;
  }

  .h-bar-chart__value {
    min-width: 50px;
  }

  /* Summary stats mobile */
  .summary-stats {
    flex-wrap: wrap;
    gap: var(--space-4);
    padding: var(--space-3);
  }

  .summary-stat {
    width: calc(50% - var(--space-2));
  }

  /* Filter bar mobile */
  .filter-bar {
    flex-wrap: wrap;
  }

  .filter-bar__select {
    flex: 1;
    min-width: 120px;
  }

  /* Top alerts table mobile */
  .top-alerts-table {
    display: block;
  }

  .top-alerts-table thead {
    display: none;
  }

  .top-alerts-table tbody,
  .top-alerts-table tr,
  .top-alerts-table td {
    display: block;
  }

  .top-alerts-table tr {
    padding: var(--space-3);
    border-bottom: 1px solid var(--color-gray-200);
    margin-bottom: var(--space-2);
    background: var(--color-gray-50);
    border-radius: var(--radius-md);
  }

  .top-alerts-table td {
    padding: var(--space-1) 0;
    border: none;
    display: flex;
    justify-content: space-between;
  }

  .top-alerts-table td::before {
    content: attr(data-label);
    font-weight: var(--font-medium);
    color: var(--color-gray-500);
    font-size: var(--text-xs);
    text-transform: uppercase;
  }
}

/* ==========================================================================
   Small Mobile (< 480px)
   ========================================================================== */
@media screen and (max-width: 480px) {
  .kpi-grid,
  .kpi-grid--5,
  .kpi-grid--4 {
    grid-template-columns: 1fr;
  }

  .kpi-card {
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
  }

  .kpi-card__value {
    font-size: var(--text-xl);
    margin-bottom: 0;
  }

  .kpi-card__target {
    flex-direction: column;
    align-items: flex-end;
    gap: var(--space-1);
  }

  .alert-card__priority,
  .alert-card__scope {
    font-size: 10px;
  }

  .alert-card__entity {
    font-size: var(--text-sm);
  }

  .btn {
    padding: var(--space-2) var(--space-3);
    font-size: var(--text-xs);
  }

  .summary-stat {
    width: 100%;
  }
}

/* ==========================================================================
   Large Desktop (> 1400px)
   ========================================================================== */
@media screen and (min-width: 1400px) {
  .dashboard-content {
    max-width: 1600px;
    margin: 0 auto;
  }

  .kpi-grid--5 {
    grid-template-columns: repeat(5, 1fr);
  }

  .chart-grid--3 {
    grid-template-columns: repeat(3, 1fr);
  }
}

/* ==========================================================================
   Print Styles
   ========================================================================== */
@media print {
  .sidebar,
  .mobile-menu-toggle,
  .dashboard-header__actions {
    display: none !important;
  }

  .main-content {
    margin-left: 0;
  }

  .dashboard-content {
    padding: 0;
  }

  .kpi-card,
  .alert-card,
  .chart-container,
  .card {
    box-shadow: none;
    border: 1px solid var(--color-gray-200);
    break-inside: avoid;
  }

  .alert-card__details {
    max-height: none !important;
  }
}

/* ==========================================================================
   Accessibility - Reduced Motion
   ========================================================================== */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* ==========================================================================
   High Contrast Mode
   ========================================================================== */
@media (prefers-contrast: high) {
  :root {
    --color-gray-100: #e0e0e0;
    --color-gray-200: #c0c0c0;
    --color-gray-500: #505050;
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.2);
    --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.25);
  }

  .kpi-card,
  .alert-card,
  .card {
    border: 2px solid var(--color-gray-300);
  }
}

  </style>
</head>
<body class="loaded">
  <div class="app">
    <button id="mobile-menu-toggle" class="mobile-menu-toggle" style="display: none; position: fixed; top: 12px; left: 12px; z-index: 300;">â˜°</button>
    <div id="mobile-overlay" class="mobile-menu-overlay"></div>
    <aside id="sidebar" class="sidebar"></aside>
    <main id="main-content" class="main-content">
      <div class="loading" style="min-height: 100vh;"><div class="loading__spinner"></div></div>
    </main>
  </div>
  <script>
// === js/data/mock-data.js ===
/**
 * Mock Data for Availability Monitoring Dashboard
 * All data is structured to support the Executive and 7 Persona dashboards
 * Schema documented in DATA_STRATEGY.md
 */

const mockData = {
  // ==========================================================================
  // Dashboard Configuration (UI metadata)
  // ==========================================================================
  dashboardConfig: {
    executive: {
      name: "Executive Dashboard",
      icon: "ðŸ“Š",
      description: "Cross-team availability overview with accountability tracking",
      headerLabels: {
        date: "Date",
        city: "City",
        category: "Category",
        tracking: "Tracking"
      },
      charts: {
        gmvByOwner: "GMV at Risk by Owner",
        chronicDuration: "Chronic Duration Distribution"
      },
      completionWidget: {
        title: "Today's Actions",
        overallLabel: "Overall Completion",
        byTeamLabel: "By Team",
        byPriorityLabel: "By Priority"
      },
      tables: {
        accountability: "Accountability by Owner",
        topAlerts: "Top 5 P0 Alerts"
      }
    },
    kpiTree: {
      title: "KPI Dependency Tree - Root Cause Analysis"
    },
    persona: {
      sections: {
        alerts: "Active Alerts",
        actionables: "Top Actionables"
      },
      labels: {
        level: "Level",
        aggregateBy: "Aggregates By",
        focus: "Focus"
      },
      filters: {
        priority: {
          placeholder: "All Priorities",
          options: ["All Priorities", "P0 Only", "P1 Only", "P2 Only"]
        },
        sort: {
          placeholder: "Sort by GMV",
          options: ["Sort by GMV", "Sort by Days", "Sort by Priority"]
        }
      }
    }
  },

  // ==========================================================================
  // Executive Summary Data
  // ==========================================================================
  summary: {
    date: "2026-01-14",
    city: "Bangalore",
    category: "FMCG",
    trackedSkus: 6000,
    availability: 98.2,
    target: 99.9,
    chronicIssues: 127,
    totalGmvAtRisk: 5230000, // â‚¹52.3L
    totalAlerts: 28,
    alertsByPriority: { P0: 5, P1: 12, P2: 11 },
    resolutionRate: 73,
    sdlwComparison: {
      chronicSkus: +12,
      gmvAtRisk: -13, // percentage change
      alerts: -3,
      resolutionRate: +5
    },
    // Executive KPI trend history
    trendHistory: {
      availability: {
        '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [98.5, 98.4, 98.3, 98.3, 98.2, 98.2, 98.2] },
        '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [99.1, 98.9, 98.7, 98.5, 98.4, 98.3, 98.2] },
        '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [99.5, 99.4, 99.2, 99.0, 98.7, 98.4, 98.2] }
      },
      chronicIssues: {
        '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [118, 120, 122, 124, 125, 126, 127] },
        '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [95, 102, 108, 114, 119, 124, 127] },
        '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [65, 78, 88, 98, 108, 118, 127] }
      },
      gmvAtRisk: {
        '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [5.8, 5.6, 5.5, 5.4, 5.3, 5.25, 5.23] },
        '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [6.5, 6.2, 5.9, 5.6, 5.4, 5.3, 5.23] },
        '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [4.2, 4.5, 4.9, 5.3, 5.8, 6.1, 5.23] }
      },
      totalAlerts: {
        '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [32, 31, 30, 29, 29, 28, 28] },
        '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [38, 36, 34, 32, 30, 29, 28] },
        '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [22, 25, 28, 32, 35, 32, 28] }
      },
      resolutionRate: {
        '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [68, 69, 70, 71, 72, 72, 73] },
        '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [62, 64, 66, 68, 70, 71, 73] },
        '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [55, 58, 62, 65, 68, 70, 73] }
      }
    }
  },

  // ==========================================================================
  // Actionable Completion Data (for Executive Dashboard)
  // ==========================================================================
  actionableCompletion: {
    overall: 62,
    byTeam: [
      { name: 'Category', icon: 'ðŸ“¦', completed: 8, total: 12, percentage: 67 },
      { name: 'Procurement', icon: 'ðŸ­', completed: 5, total: 10, percentage: 50 },
      { name: 'Pod Ops', icon: 'ðŸª', completed: 7, total: 9, percentage: 78 },
      { name: 'Planning', icon: 'ðŸ“‹', completed: 4, total: 8, percentage: 50 },
      { name: 'Warehouse', icon: 'ðŸ¢', completed: 6, total: 8, percentage: 75 },
      { name: 'ERP', icon: 'âš™ï¸', completed: 3, total: 5, percentage: 60 }
    ],
    byImpact: [
      { name: 'P0 (Critical)', completed: 3, total: 5, percentage: 60, gmvImpact: 2100000 },
      { name: 'P1 (High)', completed: 8, total: 12, percentage: 67, gmvImpact: 1850000 },
      { name: 'P2 (Medium)', completed: 22, total: 35, percentage: 63, gmvImpact: 1280000 }
    ],
    todayStats: {
      assigned: 52,
      completed: 33,
      inProgress: 12,
      pending: 7
    }
  },

  // ==========================================================================
  // GMV at Risk by Owner
  // ==========================================================================
  gmvByOwner: [
    { owner: "Category Management", gmv: 1820000, icon: "ðŸ“¦", alerts: 5, dashboardLink: "#/category" },
    { owner: "Procurement", gmv: 1280000, icon: "ðŸ­", alerts: 6, dashboardLink: "#/procurement" },
    { owner: "Pod Ops", gmv: 840000, icon: "ðŸª", alerts: 5, dashboardLink: "#/pod-ops" },
    { owner: "Planning", gmv: 650000, icon: "ðŸ“‹", alerts: 4, dashboardLink: "#/planning" },
    { owner: "Warehouse", gmv: 420000, icon: "ðŸ¢", alerts: 4, dashboardLink: "#/warehouse" },
    { owner: "ERP Team", gmv: 180000, icon: "âš™ï¸", alerts: 2, dashboardLink: "#/erp-team" },
    { owner: "Product Support", gmv: 40000, icon: "ðŸ”§", alerts: 2, dashboardLink: "#/product-support" }
  ],

  // ==========================================================================
  // Alerts by Issue Branch
  // ==========================================================================
  alertsByBranch: [
    { branch: "Branch 3: Supply-led", percentage: 35, color: "#dc2626" },
    { branch: "Branch 2: PO-led", percentage: 25, color: "#ea580c" },
    { branch: "Branch 5: Pod-led", percentage: 20, color: "#ca8a04" },
    { branch: "Branch 1: Forecast", percentage: 12, color: "#16a34a" },
    { branch: "Branch 4: Warehouse", percentage: 5, color: "#3b82f6" },
    { branch: "Branch 6: Config", percentage: 3, color: "#8b5cf6" }
  ],

  // ==========================================================================
  // Chronic Duration Breakdown
  // ==========================================================================
  chronicDuration: [
    { range: "15-18 days", count: 57, percentage: 45, color: "#fbbf24" },
    { range: "19-22 days", count: 38, percentage: 30, color: "#f97316" },
    { range: "23-26 days", count: 23, percentage: 18, color: "#ef4444" },
    { range: "27-30 days", count: 9, percentage: 7, color: "#b91c1c" }
  ],

  // ==========================================================================
  // 30-Day Trend Data
  // ==========================================================================
  trendData: [
    { day: 1, date: "Dec 15", count: 140, availability: 97.8 },
    { day: 2, date: "Dec 16", count: 138, availability: 97.9 },
    { day: 3, date: "Dec 17", count: 142, availability: 97.7 },
    { day: 4, date: "Dec 18", count: 145, availability: 97.6 },
    { day: 5, date: "Dec 19", count: 148, availability: 97.5 },
    { day: 6, date: "Dec 20", count: 152, availability: 97.4 },
    { day: 7, date: "Dec 21", count: 155, availability: 97.3 },
    { day: 8, date: "Dec 22", count: 151, availability: 97.5 },
    { day: 9, date: "Dec 23", count: 148, availability: 97.6 },
    { day: 10, date: "Dec 24", count: 145, availability: 97.7 },
    { day: 11, date: "Dec 25", count: 150, availability: 97.5 },
    { day: 12, date: "Dec 26", count: 147, availability: 97.6 },
    { day: 13, date: "Dec 27", count: 143, availability: 97.8 },
    { day: 14, date: "Dec 28", count: 140, availability: 97.9 },
    { day: 15, date: "Dec 29", count: 138, availability: 98.0 },
    { day: 16, date: "Dec 30", count: 135, availability: 98.1 },
    { day: 17, date: "Dec 31", count: 133, availability: 98.1 },
    { day: 18, date: "Jan 1", count: 136, availability: 98.0 },
    { day: 19, date: "Jan 2", count: 138, availability: 97.9 },
    { day: 20, date: "Jan 3", count: 140, availability: 97.8 },
    { day: 21, date: "Jan 4", count: 137, availability: 97.9 },
    { day: 22, date: "Jan 5", count: 134, availability: 98.0 },
    { day: 23, date: "Jan 6", count: 131, availability: 98.1 },
    { day: 24, date: "Jan 7", count: 128, availability: 98.2 },
    { day: 25, date: "Jan 8", count: 130, availability: 98.1 },
    { day: 26, date: "Jan 9", count: 132, availability: 98.0 },
    { day: 27, date: "Jan 10", count: 129, availability: 98.1 },
    { day: 28, date: "Jan 11", count: 127, availability: 98.2 },
    { day: 29, date: "Jan 12", count: 128, availability: 98.2 },
    { day: 30, date: "Jan 13", count: 127, availability: 98.2 }
  ],

  // ==========================================================================
  // Accountability Table
  // ==========================================================================
  accountabilityTable: [
    {
      owner: "Category Management",
      icon: "ðŸ“¦",
      alertCount: 5,
      gmvAtRisk: 1820000,
      topIssue: "Coca-Cola fill rate 45%",
      status: "critical",
      dashboardLink: "#/category"
    },
    {
      owner: "Procurement",
      icon: "ðŸ­",
      alertCount: 6,
      gmvAtRisk: 1280000,
      topIssue: "3 POs stuck at MOQ",
      status: "critical",
      dashboardLink: "#/procurement"
    },
    {
      owner: "Pod Ops",
      icon: "ðŸª",
      alertCount: 5,
      gmvAtRisk: 840000,
      topIssue: "HSR Layout rack full",
      status: "warning",
      dashboardLink: "#/pod-ops"
    },
    {
      owner: "Planning",
      icon: "ðŸ“‹",
      alertCount: 4,
      gmvAtRisk: 650000,
      topIssue: "wMAPE 28% on beverages",
      status: "warning",
      dashboardLink: "#/planning"
    },
    {
      owner: "Warehouse",
      icon: "ðŸ¢",
      alertCount: 4,
      gmvAtRisk: 420000,
      topIssue: "GRN backlog 850 SKUs",
      status: "warning",
      dashboardLink: "#/warehouse"
    },
    {
      owner: "ERP Team",
      icon: "âš™ï¸",
      alertCount: 2,
      gmvAtRisk: 180000,
      topIssue: "12 missing vendor codes",
      status: "warning",
      dashboardLink: "#/erp-team"
    },
    {
      owner: "Product Support",
      icon: "ðŸ”§",
      alertCount: 2,
      gmvAtRisk: 40000,
      topIssue: "Stale override rules",
      status: "good",
      dashboardLink: "#/product-support"
    }
  ],

  // ==========================================================================
  // Top 5 P0 Alerts (derived from persona alerts, sorted by gmv_loss)
  // ==========================================================================
  topP0Alerts: [
    {
      rank: 1,
      scope: "BRAND",
      entity: "Coca-Cola",
      owner: "Category Management",
      gmv_loss: 1250000,
      chronic_days_avg: 22,
      l3_narrative: "Supplier fill rate at 45% vs 80% target"
    },
    {
      rank: 2,
      scope: "WAREHOUSE",
      entity: "Central WH",
      owner: "Procurement",
      gmv_loss: 680000,
      chronic_days_avg: 18,
      l3_narrative: "PO blocked at MOQ threshold"
    },
    {
      rank: 3,
      scope: "POD",
      entity: "HSR Layout Store",
      owner: "Pod Ops",
      gmv_loss: 520000,
      chronic_days_avg: 25,
      l3_narrative: "Rack utilization at 98%"
    },
    {
      rank: 4,
      scope: "WAREHOUSE",
      entity: "Central WH",
      owner: "Planning",
      gmv_loss: 480000,
      chronic_days_avg: 16,
      l3_narrative: "wMAPE 28% underforecast on beverages"
    },
    {
      rank: 5,
      scope: "WAREHOUSE",
      entity: "Whitefield Hub",
      owner: "Warehouse",
      gmv_loss: 350000,
      chronic_days_avg: 19,
      l3_narrative: "GRN TAT 72+ hours"
    }
  ],

  // ==========================================================================
  // Category Management Dashboard Data
  // ==========================================================================
  categoryManagement: {
    persona: {
      name: "Category Management",
      icon: "ðŸ“¦",
      level: "Brand / Category",
      aggregateBy: ["brand", "l1_category"],
      description: "Brand POC escalations, selection gaps, fill rate issues"
    },
    kpis: {
      avgFillRate: {
        value: 68, target: 80, unit: "%", status: "critical", trend: -5,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [72, 71, 70, 69, 69, 68, 68] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [78, 76, 74, 72, 70, 69, 68] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [85, 82, 79, 76, 73, 70, 68] }
        }
      },
      brandsAtRisk: {
        value: 12, gmv: 1820000, status: "critical", trend: +3,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [9, 10, 10, 11, 11, 12, 12] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [6, 7, 8, 9, 10, 11, 12] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [3, 4, 5, 7, 8, 10, 12] }
        }
      },
      npiPending: {
        value: 5, threshold: 7, status: "warning", trend: +2,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [3, 3, 4, 4, 5, 5, 5] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [2, 2, 3, 3, 4, 4, 5] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [1, 2, 2, 3, 3, 4, 5] }
        }
      },
      escalations: {
        value: 3, avgAge: 4, status: "warning", trend: 0,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [3, 3, 3, 3, 3, 3, 3] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [2, 2, 3, 3, 3, 3, 3] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [1, 2, 2, 2, 3, 3, 3] }
        }
      }
    },
    alerts: [
      {
        alert_id: "CAT-001",
        owner: "Category Management",
        scope: "BRAND",
        entity: "Coca-Cola",
        gmv_loss: 1250000,
        rank: 1,
        priority: "P0",
        affected_sku_count: 8,
        affected_skus: [
          { sku_id: "SKU-CC-500", sku_name: "Coca-Cola 500ml", chronic_days: 22 },
          { sku_id: "SKU-CC-1L", sku_name: "Coca-Cola 1L", chronic_days: 20 },
          { sku_id: "SKU-CC-2L", sku_name: "Coca-Cola 2L", chronic_days: 18 },
          { sku_id: "SKU-CC-Z500", sku_name: "Coca-Cola Zero 500ml", chronic_days: 17 }
        ],
        chronic_days_avg: 22,
        l1_reason_distribution: {
          "Fill Rate issue": 0.65,
          "OTIF": 0.20,
          "Long Term Supply issue": 0.15
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "Primary supplier HCCB failing fill targets due to production constraints at Bidadi plant. 3-week declining trend with no recovery signal.",
        key_signals: ["Fill Rate: 45% (target 80%)", "Chronic Days: 22", "PODs Affected: 15 (75%)"],
        actions: [
          { action_id: "CAT-001-A1", text: "Escalate to HCCB Brand POC", gmv_at_risk: 750000, owner: "Category", status: "pending" },
          { action_id: "CAT-001-A2", text: "Activate secondary supplier Reliance", gmv_at_risk: 500000, owner: "Procurement", status: "pending" }
        ],
        key_metric: { label: "Fill Rate", value: 45, target: 80, unit: "%" },
        trend: [65, 58, 52, 48, 45, 44, 45],
        impact_scope: { count: 15, unit: "pods", percentage: 75 }
      },
      {
        alert_id: "CAT-002",
        owner: "Category Management",
        scope: "BRAND",
        entity: "Britannia",
        gmv_loss: 420000,
        rank: 2,
        priority: "P1",
        affected_sku_count: 5,
        affected_skus: [
          { sku_id: "SKU-BR-GD", sku_name: "Good Day Butter", chronic_days: 16 },
          { sku_id: "SKU-BR-MG", sku_name: "Marie Gold", chronic_days: 15 },
          { sku_id: "SKU-BR-TG", sku_name: "Tiger Biscuits", chronic_days: 14 }
        ],
        chronic_days_avg: 16,
        l1_reason_distribution: {
          "Fill Rate issue": 0.55,
          "Contract Not Available": 0.30,
          "ERP Disabled": 0.15
        },
        is_primary: true,
        shared_with: "ERP Team",
        l3_narrative: "New product variants not enabled in system. Fill rate dropping on existing SKUs due to allocation priority.",
        key_signals: ["Fill Rate: 62% (target 80%)", "Chronic Days: 16", "PODs Affected: 8 (40%)"],
        actions: [
          { action_id: "CAT-002-A1", text: "Enable NPI SKUs in MIM", gmv_at_risk: 280000, owner: "ERP Team", status: "pending" },
          { action_id: "CAT-002-A2", text: "Request fill rate commitment from brand", gmv_at_risk: 140000, owner: "Category", status: "pending" }
        ],
        key_metric: { label: "Fill Rate", value: 62, target: 80, unit: "%" },
        trend: [75, 70, 68, 65, 63, 62, 62],
        impact_scope: { count: 8, unit: "pods", percentage: 40 }
      },
      {
        alert_id: "CAT-003",
        owner: "Category Management",
        scope: "BRAND",
        entity: "Amul",
        gmv_loss: 180000,
        rank: 3,
        priority: "P1",
        affected_sku_count: 1,
        affected_skus: [
          { sku_id: "SKU-AM-B500", sku_name: "Amul Butter 500g", chronic_days: 19 }
        ],
        chronic_days_avg: 19,
        l1_reason_distribution: {
          "Long Term Supply issue": 0.70,
          "Fill Rate issue": 0.30
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "Cold chain capacity constraints at supplier end. Competing allocation with quick commerce players.",
        key_signals: ["Fill Rate: 55% (target 85%)", "Chronic Days: 19", "PODs Affected: 12 (60%)"],
        actions: [
          { action_id: "CAT-003-A1", text: "Escalate to Amul regional manager", gmv_at_risk: 120000, owner: "Category", status: "pending" },
          { action_id: "CAT-003-A2", text: "Request priority allocation", gmv_at_risk: 60000, owner: "Procurement", status: "pending" }
        ],
        key_metric: { label: "Fill Rate", value: 55, target: 85, unit: "%" },
        trend: [70, 65, 60, 58, 56, 55, 55],
        impact_scope: { count: 12, unit: "pods", percentage: 60 }
      },
      {
        alert_id: "CAT-004",
        owner: "Category Management",
        scope: "BRAND",
        entity: "Nestle",
        gmv_loss: 95000,
        rank: 4,
        priority: "P2",
        affected_sku_count: 5,
        affected_skus: [
          { sku_id: "SKU-NS-M2-70", sku_name: "Maggi 2-min 70g", chronic_days: 15 },
          { sku_id: "SKU-NS-NC-50", sku_name: "Nescafe Classic 50g", chronic_days: 14 }
        ],
        chronic_days_avg: 15,
        l1_reason_distribution: {
          "Fill Rate issue": 0.60,
          "MOV/MOQ/Tonnage Constraint": 0.40
        },
        is_primary: true,
        shared_with: "Procurement",
        l3_narrative: "Slight fill rate miss combined with MOQ constraints on smaller pods.",
        key_signals: ["Fill Rate: 72% (target 80%)", "Chronic Days: 15", "PODs Affected: 5 (25%)"],
        actions: [
          { action_id: "CAT-004-A1", text: "Monitor fill rate trend", gmv_at_risk: 55000, owner: "Category", status: "completed" },
          { action_id: "CAT-004-A2", text: "Review MOQ thresholds", gmv_at_risk: 40000, owner: "Procurement", status: "pending" }
        ],
        key_metric: { label: "Fill Rate", value: 72, target: 80, unit: "%" },
        trend: [78, 76, 74, 73, 72, 72, 72],
        impact_scope: { count: 5, unit: "pods", percentage: 25 }
      },
      {
        alert_id: "CAT-005",
        owner: "Category Management",
        scope: "CATEGORY",
        entity: "Baby Care",
        gmv_loss: 75000,
        rank: 5,
        priority: "P2",
        affected_sku_count: 6,
        affected_skus: [
          { sku_id: "SKU-PM-M-64", sku_name: "Pampers M 64 Count", chronic_days: 17 },
          { sku_id: "SKU-HG-L-46", sku_name: "Huggies L 46 Count", chronic_days: 16 },
          { sku_id: "SKU-JN-BO-200", sku_name: "Johnson Baby Oil 200ml", chronic_days: 15 }
        ],
        chronic_days_avg: 17,
        l1_reason_distribution: {
          "Contract Not Available": 0.80,
          "ERP Disabled": 0.20
        },
        is_primary: true,
        shared_with: "ERP Team",
        l3_narrative: "Missing key SKUs in assortment. Competitor benchmark shows 15 SKU gap.",
        key_signals: ["Selection Gap: 15 SKUs (target 5)", "Chronic Days: 17", "SKUs Affected: 6 (30%)"],
        actions: [
          { action_id: "CAT-005-A1", text: "Add missing SKUs to selection", gmv_at_risk: 50000, owner: "Category", status: "pending" },
          { action_id: "CAT-005-A2", text: "Enable via MIM", gmv_at_risk: 25000, owner: "ERP Team", status: "pending" }
        ],
        key_metric: { label: "Selection Gap", value: 15, target: 5, unit: "SKUs" },
        trend: [10, 11, 12, 13, 14, 15, 15],
        impact_scope: { count: 6, unit: "SKUs", percentage: 30 }
      }
    ]
  },

  // ==========================================================================
  // Procurement Dashboard Data
  // ==========================================================================
  procurement: {
    persona: {
      name: "Procurement",
      icon: "ðŸ­",
      level: "City / WH",
      aggregateBy: ["city", "warehouse"],
      description: "PO generation, MOQ/MOV issues, supplier OTIF"
    },
    kpis: {
      otifRate: {
        value: 72, target: 90, unit: "%", status: "critical", trend: -8,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [78, 77, 75, 74, 73, 72, 72] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [85, 82, 80, 78, 75, 73, 72] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [92, 89, 86, 82, 78, 75, 72] }
        }
      },
      moqBlocking: {
        value: 18, unit: "%", status: "warning", trend: +5,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [14, 15, 16, 16, 17, 17, 18] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [10, 12, 13, 14, 15, 17, 18] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [5, 7, 9, 11, 13, 15, 18] }
        }
      },
      pendingPos: {
        value: 23, gmv: 850000, status: "critical", trend: +7,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [18, 19, 20, 21, 22, 22, 23] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [12, 14, 16, 18, 20, 22, 23] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [5, 8, 10, 13, 16, 20, 23] }
        }
      },
      contractIssues: {
        value: 4, status: "warning", trend: 0,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [4, 4, 4, 4, 4, 4, 4] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [3, 3, 4, 4, 4, 4, 4] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [2, 2, 3, 3, 3, 4, 4] }
        }
      }
    },
    alerts: [
      {
        alert_id: "PROC-001",
        owner: "Procurement",
        scope: "WAREHOUSE",
        entity: "Central WH",
        gmv_loss: 680000,
        rank: 1,
        priority: "P0",
        affected_sku_count: 45,
        affected_skus: [
          { sku_id: "SKU-PG-80", sku_name: "Parle-G 80g", chronic_days: 18 },
          { sku_id: "SKU-HS-120", sku_name: "Hide & Seek 120g", chronic_days: 17 },
          { sku_id: "SKU-ML-150", sku_name: "Milano 150g", chronic_days: 16 },
          { sku_id: "SKU-KJ-100", sku_name: "Krackjack 100g", chronic_days: 15 }
        ],
        chronic_days_avg: 18,
        l1_reason_distribution: {
          "OTIF": 0.50,
          "MOV/MOQ/Tonnage Constraint": 0.35,
          "Ordering / OTIF / Contract issue": 0.15
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "Multiple POs stuck at MOQ threshold. OTIF declining due to transport issues from Bahadurgarh plant.",
        key_signals: ["OTIF Rate: 58% (target 90%)", "Chronic Days: 18", "SKUs Affected: 45 (60%)"],
        actions: [
          { action_id: "PROC-001-A1", text: "Negotiate MOQ reduction with Parle", gmv_at_risk: 400000, owner: "Procurement", status: "pending" },
          { action_id: "PROC-001-A2", text: "Escalate OTIF to vendor management", gmv_at_risk: 280000, owner: "Procurement", status: "pending" }
        ],
        key_metric: { label: "OTIF Rate", value: 58, target: 90, unit: "%" },
        trend: [75, 70, 65, 62, 60, 58, 58],
        impact_scope: { count: 45, unit: "SKUs", percentage: 60 }
      },
      {
        alert_id: "PROC-002",
        owner: "Procurement",
        scope: "WAREHOUSE",
        entity: "Whitefield Hub",
        gmv_loss: 320000,
        rank: 2,
        priority: "P1",
        affected_sku_count: 18,
        affected_skus: [
          { sku_id: "SKU-AA-1K", sku_name: "Aashirvaad Atta 1kg", chronic_days: 12 },
          { sku_id: "SKU-SF-BS-150", sku_name: "Sunfeast Dark Fantasy 150g", chronic_days: 11 },
          { sku_id: "SKU-BG-90", sku_name: "Bingo Tedhe Medhe 90g", chronic_days: 10 }
        ],
        chronic_days_avg: 12,
        l1_reason_distribution: {
          "Ordering / OTIF / Contract issue": 0.60,
          "MOV/MOQ/Tonnage Constraint": 0.40
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "PO pending approval due to MOV not met. Need to consolidate orders or adjust MOV.",
        key_signals: ["Days Pending: 12 (target 3)", "Chronic Days: 12", "SKUs Affected: 18 (35%)"],
        actions: [
          { action_id: "PROC-002-A1", text: "Consolidate with other pending POs", gmv_at_risk: 200000, owner: "Procurement", status: "pending" },
          { action_id: "PROC-002-A2", text: "Request MOV waiver from vendor", gmv_at_risk: 120000, owner: "Procurement", status: "pending" }
        ],
        key_metric: { label: "Days Pending", value: 12, target: 3, unit: "days" },
        trend: [3, 5, 7, 9, 10, 11, 12],
        impact_scope: { count: 18, unit: "SKUs", percentage: 35 }
      },
      {
        alert_id: "PROC-003",
        owner: "Procurement",
        scope: "WAREHOUSE",
        entity: "Bommanahalli Hub",
        gmv_loss: 280000,
        rank: 3,
        priority: "P1",
        affected_sku_count: 22,
        affected_skus: [
          { sku_id: "SKU-SE-1K", sku_name: "Surf Excel Easy Wash 1kg", chronic_days: 14 },
          { sku_id: "SKU-VM-250", sku_name: "Vim Bar 250g", chronic_days: 13 },
          { sku_id: "SKU-LB-100", sku_name: "Lifebuoy Total 100g", chronic_days: 12 }
        ],
        chronic_days_avg: 14,
        l1_reason_distribution: {
          "OTIF": 0.70,
          "Ordering / OTIF / Contract issue": 0.30
        },
        is_primary: true,
        shared_with: "Planning",
        l3_narrative: "HUL warehouse capacity issues causing fulfillment delays. Lead times extended by 2 days.",
        key_signals: ["OTIF Rate: 68% (target 90%)", "Chronic Days: 14", "SKUs Affected: 22 (28%)"],
        actions: [
          { action_id: "PROC-003-A1", text: "Escalate to HUL supply chain head", gmv_at_risk: 180000, owner: "Procurement", status: "pending" },
          { action_id: "PROC-003-A2", text: "Adjust safety stock levels", gmv_at_risk: 100000, owner: "Planning", status: "pending" }
        ],
        key_metric: { label: "OTIF Rate", value: 68, target: 90, unit: "%" },
        trend: [82, 78, 75, 72, 70, 68, 68],
        impact_scope: { count: 22, unit: "SKUs", percentage: 28 }
      },
      {
        alert_id: "PROC-004",
        owner: "Procurement",
        scope: "WAREHOUSE",
        entity: "Yelahanka Hub",
        gmv_loss: 120000,
        rank: 4,
        priority: "P2",
        affected_sku_count: 8,
        affected_skus: [
          { sku_id: "SKU-RJ-1L", sku_name: "Real Mixed Fruit Juice 1L", chronic_days: 20 },
          { sku_id: "SKU-HJ-120", sku_name: "Hajmola Regular 120 Tablets", chronic_days: 18 },
          { sku_id: "SKU-CY-500", sku_name: "Dabur Chyawanprash 500g", chronic_days: 16 }
        ],
        chronic_days_avg: 20,
        l1_reason_distribution: {
          "Contract Not Available": 1.00
        },
        is_primary: true,
        shared_with: "Category Management",
        l3_narrative: "Contract expired 20 days ago. Operating on interim terms with limited fill commitment.",
        key_signals: ["Contract Status: Expired (target Active)", "Chronic Days: 20", "SKUs Affected: 8 (15%)"],
        actions: [
          { action_id: "PROC-004-A1", text: "Fast-track contract renewal", gmv_at_risk: 80000, owner: "Category", status: "completed" },
          { action_id: "PROC-004-A2", text: "Negotiate interim fill guarantee", gmv_at_risk: 40000, owner: "Procurement", status: "pending" }
        ],
        key_metric: { label: "Contract Status", value: 0, target: 1, unit: "active" },
        trend: [0, 0, 0, 0, 0, 0, 0],
        impact_scope: { count: 8, unit: "SKUs", percentage: 15 }
      },
      {
        alert_id: "PROC-005",
        owner: "Procurement",
        scope: "WAREHOUSE",
        entity: "Electronic City Hub",
        gmv_loss: 85000,
        rank: 5,
        priority: "P2",
        affected_sku_count: 10,
        affected_skus: [
          { sku_id: "SKU-PC-200", sku_name: "Parachute Coconut Oil 200ml", chronic_days: 16 },
          { sku_id: "SKU-SF-1L", sku_name: "Saffola Gold 1L", chronic_days: 15 },
          { sku_id: "SKU-LV-100", sku_name: "Livon Serum 100ml", chronic_days: 14 }
        ],
        chronic_days_avg: 16,
        l1_reason_distribution: {
          "OTIF": 0.65,
          "MOV/MOQ/Tonnage Constraint": 0.35
        },
        is_primary: true,
        shared_with: "Planning",
        l3_narrative: "OTIF declining due to increased demand not matched by allocation.",
        key_signals: ["OTIF Rate: 75% (target 90%)", "Chronic Days: 16", "SKUs Affected: 10 (20%)"],
        actions: [
          { action_id: "PROC-005-A1", text: "Request allocation increase", gmv_at_risk: 55000, owner: "Procurement", status: "pending" },
          { action_id: "PROC-005-A2", text: "Review forecast accuracy", gmv_at_risk: 30000, owner: "Planning", status: "pending" }
        ],
        key_metric: { label: "OTIF Rate", value: 75, target: 90, unit: "%" },
        trend: [85, 82, 80, 78, 76, 75, 75],
        impact_scope: { count: 10, unit: "SKUs", percentage: 20 }
      }
    ]
  },

  // ==========================================================================
  // Pod Ops Dashboard Data
  // ==========================================================================
  podOps: {
    persona: {
      name: "Pod Ops",
      icon: "ðŸª",
      level: "Pod",
      aggregateBy: ["pod"],
      description: "Inwarding, rack capacity, processing, FTR"
    },
    kpis: {
      rackUtilization: {
        value: 94, target: 85, unit: "%", status: "critical", trend: +6,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [90, 91, 92, 93, 93, 94, 94] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [85, 87, 89, 90, 92, 93, 94] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [78, 80, 83, 86, 89, 92, 94] }
        }
      },
      inwardingTat: {
        value: 4.2, target: 2, unit: "hrs", status: "warning", trend: +1.5,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [3.2, 3.5, 3.8, 4.0, 4.1, 4.1, 4.2] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [2.5, 2.8, 3.2, 3.5, 3.8, 4.0, 4.2] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [1.8, 2.2, 2.6, 3.0, 3.4, 3.8, 4.2] }
        }
      },
      podsAtRisk: {
        value: 8, gmv: 840000, status: "critical", trend: +2,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [6, 6, 7, 7, 8, 8, 8] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [4, 5, 5, 6, 7, 7, 8] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [2, 3, 4, 5, 6, 7, 8] }
        }
      },
      ftrRate: {
        value: 88, target: 95, unit: "%", status: "warning", trend: -3,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [91, 90, 90, 89, 89, 88, 88] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [93, 92, 91, 90, 90, 89, 88] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [96, 95, 94, 93, 91, 90, 88] }
        }
      }
    },
    alerts: [
      {
        alert_id: "POD-001",
        owner: "Pod Ops",
        scope: "POD",
        entity: "HSR Layout Store",
        gmv_loss: 520000,
        rank: 1,
        priority: "P0",
        affected_sku_count: 85,
        affected_skus: [
          { sku_id: "SKU-TH-500", sku_name: "Thums Up 500ml", chronic_days: 25 },
          { sku_id: "SKU-LY-150", sku_name: "Lay's Classic 150g", chronic_days: 24 },
          { sku_id: "SKU-AM-TZ500", sku_name: "Amul Taaza 500ml", chronic_days: 22 }
        ],
        chronic_days_avg: 25,
        l1_reason_distribution: {
          "Pod Missed Qty": 0.70,
          "Movement Setting Design Issue": 0.20,
          "Pod_Space Issue_freezer": 0.10
        },
        is_primary: true,
        shared_with: "Category Management",
        l3_narrative: "Rack utilization at 98% causing stockout of fast movers. Need capacity expansion or SKU rationalization.",
        key_signals: ["Rack Util: 98% (target 85%)", "Chronic Days: 25", "SKUs Affected: 85 (42%)"],
        actions: [
          { action_id: "POD-001-A1", text: "Request rack expansion for HSR Layout", gmv_at_risk: 320000, owner: "Pod Ops", status: "pending" },
          { action_id: "POD-001-A2", text: "Identify slow movers for removal", gmv_at_risk: 200000, owner: "Category Management", status: "pending" }
        ],
        key_metric: { label: "Rack Util", value: 98, target: 85, unit: "%" },
        trend: [88, 90, 92, 94, 96, 97, 98],
        impact_scope: { count: 85, unit: "SKUs", percentage: 42 }
      },
      {
        alert_id: "POD-002",
        owner: "Pod Ops",
        scope: "POD",
        entity: "Koramangala Store",
        gmv_loss: 180000,
        rank: 2,
        priority: "P1",
        affected_sku_count: 45,
        affected_skus: [
          { sku_id: "SKU-HB-500", sku_name: "Harvest Bread 500g", chronic_days: 15 },
          { sku_id: "SKU-NS-CD200", sku_name: "Nestle Curd 200g", chronic_days: 14 }
        ],
        chronic_days_avg: 15,
        l1_reason_distribution: {
          "Pod Inward Delay Impact": 0.60,
          "Pod Missed Qty": 0.40
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "Inwarding TAT 6 hours causing stockouts for morning orders. Staff shortage during peak hours.",
        key_signals: ["Inwarding TAT: 6 hrs (target 2)", "Chronic Days: 15", "SKUs Affected: 45 (28%)"],
        actions: [
          { action_id: "POD-002-A1", text: "Add morning shift staff at Koramangala", gmv_at_risk: 110000, owner: "Pod Ops", status: "pending" },
          { action_id: "POD-002-A2", text: "Optimize inwarding process", gmv_at_risk: 70000, owner: "Pod Ops", status: "pending" }
        ],
        key_metric: { label: "Inwarding TAT", value: 6, target: 2, unit: "hrs" },
        trend: [2.5, 3, 3.5, 4, 5, 5.5, 6],
        impact_scope: { count: 45, unit: "SKUs", percentage: 28 }
      },
      {
        alert_id: "POD-003",
        owner: "Pod Ops",
        scope: "POD",
        entity: "Indiranagar Store",
        gmv_loss: 95000,
        rank: 3,
        priority: "P1",
        affected_sku_count: 18,
        affected_skus: [
          { sku_id: "SKU-AM-ML500", sku_name: "Amul Gold Milk 500ml", chronic_days: 12 },
          { sku_id: "SKU-MT-CD400", sku_name: "Mother Dairy Curd 400g", chronic_days: 11 },
          { sku_id: "SKU-AM-PN200", sku_name: "Amul Fresh Paneer 200g", chronic_days: 10 }
        ],
        chronic_days_avg: 12,
        l1_reason_distribution: {
          "Pod_Space Issue_freezer": 0.50,
          "Pod Missed Qty": 0.30,
          "Pod Inward Delay Impact": 0.20
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "FTR dropping due to FEFO compliance issues in dairy. Short-dated stock not rotated properly.",
        key_signals: ["FTR: 78% (target 95%)", "Chronic Days: 12", "SKUs Affected: 18 (35%)"],
        actions: [
          { action_id: "POD-003-A1", text: "Conduct FEFO audit at Indiranagar", gmv_at_risk: 55000, owner: "Pod Ops", status: "pending" },
          { action_id: "POD-003-A2", text: "Staff training on dairy rotation", gmv_at_risk: 40000, owner: "Pod Ops", status: "pending" }
        ],
        key_metric: { label: "FTR", value: 78, target: 95, unit: "%" },
        trend: [92, 88, 85, 82, 80, 79, 78],
        impact_scope: { count: 18, unit: "SKUs", percentage: 35 }
      },
      {
        alert_id: "POD-004",
        owner: "Pod Ops",
        scope: "POD",
        entity: "Whitefield Store",
        gmv_loss: 65000,
        rank: 4,
        priority: "P2",
        affected_sku_count: 32,
        affected_skus: [
          { sku_id: "SKU-BG-100", sku_name: "Bingo Mad Angles 100g", chronic_days: 18 },
          { sku_id: "SKU-SP-750", sku_name: "Sprite 750ml", chronic_days: 17 }
        ],
        chronic_days_avg: 18,
        l1_reason_distribution: {
          "Pod Missed Qty": 0.60,
          "Movement Setting Design Issue": 0.40
        },
        is_primary: true,
        shared_with: "Category Management",
        l3_narrative: "Gradual capacity creep. Several slow movers occupying premium shelf space.",
        key_signals: ["Rack Util: 92% (target 85%)", "Chronic Days: 18", "SKUs Affected: 32 (22%)"],
        actions: [
          { action_id: "POD-004-A1", text: "SKU rationalization review at Whitefield", gmv_at_risk: 40000, owner: "Category Management", status: "pending" },
          { action_id: "POD-004-A2", text: "Identify delist candidates", gmv_at_risk: 25000, owner: "Category Management", status: "pending" }
        ],
        key_metric: { label: "Rack Util", value: 92, target: 85, unit: "%" },
        trend: [85, 86, 88, 89, 90, 91, 92],
        impact_scope: { count: 32, unit: "SKUs", percentage: 22 }
      },
      {
        alert_id: "POD-005",
        owner: "Pod Ops",
        scope: "POD",
        entity: "Jayanagar Store",
        gmv_loss: 45000,
        rank: 5,
        priority: "P2",
        affected_sku_count: 22,
        affected_skus: [
          { sku_id: "SKU-TS-1K", sku_name: "Tata Salt 1kg", chronic_days: 14 },
          { sku_id: "SKU-SF-500", sku_name: "Saffola Gold 500ml", chronic_days: 13 }
        ],
        chronic_days_avg: 14,
        l1_reason_distribution: {
          "Pod Inward Delay Impact": 0.70,
          "Pod Missed Qty": 0.30
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "Staging area congested during peak delivery windows.",
        key_signals: ["Inwarding TAT: 4.5 hrs (target 2)", "Chronic Days: 14", "SKUs Affected: 22 (18%)"],
        actions: [
          { action_id: "POD-005-A1", text: "Stagger delivery appointments at Jayanagar", gmv_at_risk: 28000, owner: "Pod Ops", status: "pending" },
          { action_id: "POD-005-A2", text: "Expand staging area", gmv_at_risk: 17000, owner: "Pod Ops", status: "pending" }
        ],
        key_metric: { label: "Inwarding TAT", value: 4.5, target: 2, unit: "hrs" },
        trend: [2, 2.5, 3, 3.5, 4, 4.2, 4.5],
        impact_scope: { count: 22, unit: "SKUs", percentage: 18 }
      }
    ]
  },

  // ==========================================================================
  // Planning Dashboard Data
  // ==========================================================================
  planning: {
    persona: {
      name: "Planning",
      icon: "ðŸ“‹",
      level: "City / WH",
      aggregateBy: ["city", "warehouse"],
      description: "Forecast accuracy, DOH, replenishment rules"
    },
    kpis: {
      forecastAccuracy: {
        value: 72, target: 85, unit: "% (wMAPE)", status: "critical", trend: -5,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [76, 75, 74, 74, 73, 72, 72] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [82, 80, 78, 76, 74, 73, 72] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [88, 86, 83, 80, 77, 74, 72] }
        }
      },
      dohBreaches: {
        value: 34, threshold: 10, status: "critical", trend: +12,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [26, 28, 30, 31, 32, 33, 34] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [18, 21, 24, 27, 30, 32, 34] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [8, 12, 16, 20, 25, 30, 34] }
        }
      },
      rrGeneration: {
        value: 85, target: 95, unit: "%", status: "warning", trend: -3,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [88, 87, 87, 86, 86, 85, 85] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [91, 90, 89, 88, 87, 86, 85] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [95, 94, 92, 90, 88, 86, 85] }
        }
      },
      movementGaps: {
        value: 18, status: "warning", trend: +4,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [15, 16, 16, 17, 17, 18, 18] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [12, 13, 14, 15, 16, 17, 18] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [8, 10, 12, 14, 15, 17, 18] }
        }
      }
    },
    alerts: [
      {
        alert_id: "PLAN-001",
        owner: "Planning",
        scope: "WAREHOUSE",
        entity: "Central WH",
        gmv_loss: 480000,
        rank: 1,
        priority: "P0",
        affected_sku_count: 65,
        affected_skus: [
          { sku_id: "SKU-TU-750", sku_name: "Thums Up 750ml", chronic_days: 16 },
          { sku_id: "SKU-RL-1L", sku_name: "Real Mixed Fruit 1L", chronic_days: 15 },
          { sku_id: "SKU-RB-250", sku_name: "Red Bull 250ml", chronic_days: 14 },
          { sku_id: "SKU-KN-1L", sku_name: "Kinley Water 1L", chronic_days: 13 }
        ],
        chronic_days_avg: 16,
        l1_reason_distribution: {
          "Forecast Error": 0.75,
          "Movement Setting Design Issue": 0.25
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "Systematic underforecasting in beverages due to unseasonally warm weather. TFT model not capturing weather signals.",
        key_signals: ["wMAPE: 28% (target 15%)", "Chronic Days: 16", "SKUs Affected: 65 (55%)"],
        actions: [
          { action_id: "PLAN-001-A1", text: "Retrain TFT model with weather features", gmv_at_risk: 300000, owner: "Planning", status: "pending" },
          { action_id: "PLAN-001-A2", text: "Manual uplift 15% for beverages (2 weeks)", gmv_at_risk: 180000, owner: "Planning", status: "pending" }
        ],
        key_metric: { label: "wMAPE", value: 28, target: 15, unit: "%" },
        trend: [18, 20, 22, 24, 26, 27, 28],
        impact_scope: { count: 65, unit: "SKUs", percentage: 55 }
      },
      {
        alert_id: "PLAN-002",
        owner: "Planning",
        scope: "WAREHOUSE",
        entity: "Whitefield Hub",
        gmv_loss: 120000,
        rank: 2,
        priority: "P1",
        affected_sku_count: 1,
        affected_skus: [
          { sku_id: "SKU-TS-1K", sku_name: "Tata Salt 1kg", chronic_days: 22 }
        ],
        chronic_days_avg: 22,
        l1_reason_distribution: {
          "Movement Setting Design Issue": 0.80,
          "Movement_Blocking": 0.20
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "Safety stock depleted. RR generation delayed due to incorrect movement class.",
        key_signals: ["DOH: 0.5 days (target 3)", "Chronic Days: 22", "PODs Affected: 18 (90%)"],
        actions: [
          { action_id: "PLAN-002-A1", text: "Correct movement class to A for Tata Salt", gmv_at_risk: 75000, owner: "Planning", status: "pending" },
          { action_id: "PLAN-002-A2", text: "Trigger emergency replenishment", gmv_at_risk: 45000, owner: "Planning", status: "pending" }
        ],
        key_metric: { label: "DOH", value: 0.5, target: 3, unit: "days" },
        trend: [2.5, 2, 1.5, 1, 0.8, 0.6, 0.5],
        impact_scope: { count: 18, unit: "pods", percentage: 90 }
      },
      {
        alert_id: "PLAN-003",
        owner: "Planning",
        scope: "WAREHOUSE",
        entity: "Electronic City Hub",
        gmv_loss: 95000,
        rank: 3,
        priority: "P1",
        affected_sku_count: 42,
        affected_skus: [
          { sku_id: "SKU-FR-1L", sku_name: "Fortune Rice Bran Oil 1L", chronic_days: 14 }
        ],
        chronic_days_avg: 14,
        l1_reason_distribution: {
          "Movement_Blocking": 1.00
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "RR generation rate dropped due to system sync issues. Multiple SKUs missing replenishment triggers.",
        key_signals: ["RR Rate: 72% (target 95%)", "Chronic Days: 14", "SKUs Affected: 42 (35%)"],
        actions: [
          { action_id: "PLAN-003-A1", text: "Debug RR generation pipeline", gmv_at_risk: 60000, owner: "Planning", status: "pending" },
          { action_id: "PLAN-003-A2", text: "Manual RR for top 20 SKUs", gmv_at_risk: 35000, owner: "Planning", status: "pending" }
        ],
        key_metric: { label: "RR Rate", value: 72, target: 95, unit: "%" },
        trend: [90, 88, 85, 80, 78, 75, 72],
        impact_scope: { count: 42, unit: "SKUs", percentage: 35 }
      },
      {
        alert_id: "PLAN-004",
        owner: "Planning",
        scope: "WAREHOUSE",
        entity: "Bommanahalli Hub",
        gmv_loss: 75000,
        rank: 4,
        priority: "P2",
        affected_sku_count: 28,
        affected_skus: [
          { sku_id: "SKU-DV-200", sku_name: "Dove Shampoo 200ml", chronic_days: 12 },
          { sku_id: "SKU-LX-100", sku_name: "Lux Beauty Bar 100g", chronic_days: 11 },
          { sku_id: "SKU-AX-150", sku_name: "Axe Deo 150ml", chronic_days: 10 }
        ],
        chronic_days_avg: 12,
        l1_reason_distribution: {
          "Forecast Error": 0.60,
          "Movement Setting Design Issue": 0.40
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "Promotional uplift not captured in forecast. Baseline drifting upward.",
        key_signals: ["wMAPE: 22% (target 15%)", "Chronic Days: 12", "SKUs Affected: 28 (22%)"],
        actions: [
          { action_id: "PLAN-004-A1", text: "Incorporate promo calendar into forecast", gmv_at_risk: 50000, owner: "Planning", status: "pending" },
          { action_id: "PLAN-004-A2", text: "Recalibrate personal care baseline", gmv_at_risk: 25000, owner: "Planning", status: "pending" }
        ],
        key_metric: { label: "wMAPE", value: 22, target: 15, unit: "%" },
        trend: [16, 17, 18, 19, 20, 21, 22],
        impact_scope: { count: 28, unit: "SKUs", percentage: 22 }
      },
      {
        alert_id: "PLAN-005",
        owner: "Planning",
        scope: "WAREHOUSE",
        entity: "Yelahanka Hub",
        gmv_loss: 45000,
        rank: 5,
        priority: "P2",
        affected_sku_count: 1,
        affected_skus: [
          { sku_id: "SKU-MG-70", sku_name: "Maggi 2-min 70g", chronic_days: 18 }
        ],
        chronic_days_avg: 18,
        l1_reason_distribution: {
          "Forecast Error": 0.70,
          "Movement Setting Design Issue": 0.30
        },
        is_primary: true,
        shared_with: "Category Management",
        l3_narrative: "Overstocked due to demand drop post-promotion. Occupying shelf space needed for faster movers.",
        key_signals: ["DOH: 8 days (target 5)", "Chronic Days: 18", "Overstock: 60%"],
        actions: [
          { action_id: "PLAN-005-A1", text: "Reduce incoming quantity for Maggi", gmv_at_risk: 30000, owner: "Planning", status: "pending" },
          { action_id: "PLAN-005-A2", text: "Consider markdown to clear stock", gmv_at_risk: 15000, owner: "Category Management", status: "pending" }
        ],
        key_metric: { label: "DOH", value: 8, target: 5, unit: "days" },
        trend: [4, 5, 5.5, 6, 7, 7.5, 8],
        impact_scope: { count: 1, unit: "pod", percentage: 100 }
      }
    ]
  },

  // ==========================================================================
  // Warehouse Dashboard Data
  // ==========================================================================
  warehouse: {
    persona: {
      name: "Warehouse",
      icon: "ðŸ¢",
      level: "Warehouse",
      aggregateBy: ["warehouse"],
      description: "GRN, putaway, outbound fill, capacity"
    },
    kpis: {
      grnTat: {
        value: 48, target: 24, unit: "hrs", status: "critical", trend: +12,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [38, 40, 42, 44, 46, 47, 48] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [28, 32, 36, 40, 43, 46, 48] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [20, 25, 30, 35, 40, 44, 48] }
        }
      },
      outboundFill: {
        value: 88, target: 95, unit: "%", status: "warning", trend: -4,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [91, 90, 90, 89, 89, 88, 88] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [94, 93, 92, 91, 90, 89, 88] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [96, 95, 94, 92, 91, 89, 88] }
        }
      },
      capacityUtil: {
        value: 92, target: 85, unit: "%", status: "warning", trend: +5,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [89, 90, 90, 91, 91, 92, 92] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [86, 87, 88, 89, 90, 91, 92] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [80, 82, 84, 87, 89, 91, 92] }
        }
      },
      putawayPending: {
        value: 850, status: "critical", trend: +200,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [700, 730, 760, 790, 810, 830, 850] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [500, 580, 640, 700, 760, 810, 850] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [200, 320, 440, 560, 680, 780, 850] }
        }
      }
    },
    alerts: [
      {
        alert_id: "WH-001",
        owner: "Warehouse",
        scope: "WAREHOUSE",
        entity: "Whitefield Hub",
        gmv_loss: 350000,
        rank: 1,
        priority: "P0",
        affected_sku_count: 850,
        affected_skus: [
          { sku_id: "SKU-AA-5K", sku_name: "Aashirvaad Atta 5kg", chronic_days: 19 },
          { sku_id: "SKU-DT-1K", sku_name: "Daawat Basmati 1kg", chronic_days: 18 }
        ],
        chronic_days_avg: 19,
        l1_reason_distribution: {
          "WH Putaway Delay": 0.60,
          "Warehouse Missed Qty": 0.25,
          "WH Capacity (Movement Setting Reduced)": 0.15
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "GRN backlog of 850 SKUs. Processing capacity constrained. Need additional receiving docks.",
        key_signals: ["GRN TAT: 72 hrs (target 24)", "Chronic Days: 19", "SKUs Affected: 850 (45%)"],
        actions: [
          { action_id: "WH-001-A1", text: "Add temp staff for Whitefield GRN", gmv_at_risk: 220000, owner: "Warehouse", status: "pending" },
          { action_id: "WH-001-A2", text: "Extend receiving hours to 10pm", gmv_at_risk: 130000, owner: "Warehouse", status: "pending" }
        ],
        key_metric: { label: "GRN TAT", value: 72, target: 24, unit: "hrs" },
        trend: [30, 40, 48, 55, 62, 68, 72],
        impact_scope: { count: 850, unit: "SKUs", percentage: 45 }
      },
      {
        alert_id: "WH-002",
        owner: "Warehouse",
        scope: "WAREHOUSE",
        entity: "Bommanahalli Hub",
        gmv_loss: 180000,
        rank: 2,
        priority: "P1",
        affected_sku_count: 320,
        affected_skus: [
          { sku_id: "SKU-SN-1L", sku_name: "Sundrop Lite Oil 1L", chronic_days: 14 },
          { sku_id: "SKU-WK-500", sku_name: "Weikfield Cornflour 500g", chronic_days: 13 }
        ],
        chronic_days_avg: 14,
        l1_reason_distribution: {
          "Warehouse Missed Qty": 0.70,
          "WH Capacity (Movement Setting Reduced)": 0.30
        },
        is_primary: true,
        shared_with: "Category Management",
        l3_narrative: "Warehouse at 95% capacity. Unable to receive new inventory efficiently.",
        key_signals: ["Capacity: 95% (target 85%)", "Chronic Days: 14", "SKUs Affected: 320 (28%)"],
        actions: [
          { action_id: "WH-002-A1", text: "Expedite outbound to pods from Bommanahalli", gmv_at_risk: 110000, owner: "Warehouse", status: "pending" },
          { action_id: "WH-002-A2", text: "Identify slow movers for removal", gmv_at_risk: 70000, owner: "Category Management", status: "pending" }
        ],
        key_metric: { label: "Capacity", value: 95, target: 85, unit: "%" },
        trend: [86, 88, 90, 91, 93, 94, 95],
        impact_scope: { count: 320, unit: "SKUs", percentage: 28 }
      },
      {
        alert_id: "WH-003",
        owner: "Warehouse",
        scope: "WAREHOUSE",
        entity: "Central WH",
        gmv_loss: 120000,
        rank: 3,
        priority: "P1",
        affected_sku_count: 35,
        affected_skus: [
          { sku_id: "SKU-AM-TZ1L", sku_name: "Amul Taaza Milk 1L", chronic_days: 12 },
          { sku_id: "SKU-AM-MT400", sku_name: "Amul Masti Dahi 400g", chronic_days: 11 },
          { sku_id: "SKU-AM-PN200", sku_name: "Amul Paneer 200g", chronic_days: 10 },
          { sku_id: "SKU-AM-CH200", sku_name: "Amul Cheese Slices 200g", chronic_days: 10 }
        ],
        chronic_days_avg: 12,
        l1_reason_distribution: {
          "Warehouse Outbound Fillrate Impact": 0.55,
          "Stock Transfer Delay Issue": 0.45
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "Cold storage capacity limited. FEFO compliance causing early expiry write-offs.",
        key_signals: ["Outbound Fill: 75% (target 95%)", "Chronic Days: 12", "SKUs Affected: 35 (40%)"],
        actions: [
          { action_id: "WH-003-A1", text: "Expand cold storage at Whitefield", gmv_at_risk: 75000, owner: "Warehouse", status: "pending" },
          { action_id: "WH-003-A2", text: "Improve FEFO compliance processes", gmv_at_risk: 45000, owner: "Warehouse", status: "pending" }
        ],
        key_metric: { label: "Outbound Fill", value: 75, target: 95, unit: "%" },
        trend: [90, 88, 85, 82, 78, 76, 75],
        impact_scope: { count: 35, unit: "SKUs", percentage: 40 }
      },
      {
        alert_id: "WH-004",
        owner: "Warehouse",
        scope: "WAREHOUSE",
        entity: "Yelahanka Hub",
        gmv_loss: 85000,
        rank: 4,
        priority: "P2",
        affected_sku_count: 180,
        affected_skus: [
          { sku_id: "SKU-RC-1K", sku_name: "India Gate Basmati Rice 1kg", chronic_days: 10 },
          { sku_id: "SKU-TT-250", sku_name: "Tata Tea Gold 250g", chronic_days: 9 }
        ],
        chronic_days_avg: 10,
        l1_reason_distribution: {
          "WH Putaway Delay": 0.65,
          "Warehouse Missed Qty": 0.35
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "Putaway delays due to location assignment issues. WMS location accuracy at 85%.",
        key_signals: ["Putaway TAT: 8 hrs (target 4)", "Chronic Days: 10", "SKUs Affected: 180 (18%)"],
        actions: [
          { action_id: "WH-004-A1", text: "WMS location audit at Yelahanka", gmv_at_risk: 55000, owner: "Warehouse", status: "pending" },
          { action_id: "WH-004-A2", text: "Staff training on putaway process", gmv_at_risk: 30000, owner: "Warehouse", status: "pending" }
        ],
        key_metric: { label: "Putaway TAT", value: 8, target: 4, unit: "hrs" },
        trend: [4, 5, 5.5, 6, 6.5, 7.5, 8],
        impact_scope: { count: 180, unit: "SKUs", percentage: 18 }
      },
      {
        alert_id: "WH-005",
        owner: "Warehouse",
        scope: "WAREHOUSE",
        entity: "Electronic City Hub",
        gmv_loss: 65000,
        rank: 5,
        priority: "P2",
        affected_sku_count: 42,
        affected_skus: [
          { sku_id: "SKU-LY-100", sku_name: "Lay's Magic Masala 100g", chronic_days: 15 },
          { sku_id: "SKU-HL-200", sku_name: "Haldiram's Bhujia 200g", chronic_days: 14 },
          { sku_id: "SKU-PG-80", sku_name: "Parle-G 80g", chronic_days: 13 }
        ],
        chronic_days_avg: 15,
        l1_reason_distribution: {
          "Warehouse Outbound Fillrate Impact": 0.60,
          "Warehouse Missed Qty": 0.40
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "Stock position issues. Multiple SKUs showing system vs physical mismatch.",
        key_signals: ["Outbound Fill: 82% (target 95%)", "Chronic Days: 15", "SKUs Affected: 42 (22%)"],
        actions: [
          { action_id: "WH-005-A1", text: "Cycle count for snacks at Bommanahalli", gmv_at_risk: 40000, owner: "Warehouse", status: "pending" },
          { action_id: "WH-005-A2", text: "Investigate stock discrepancies", gmv_at_risk: 25000, owner: "Warehouse", status: "pending" }
        ],
        key_metric: { label: "Outbound Fill", value: 82, target: 95, unit: "%" },
        trend: [92, 90, 88, 86, 84, 83, 82],
        impact_scope: { count: 42, unit: "SKUs", percentage: 22 }
      }
    ]
  },

  // ==========================================================================
  // ERP Team Dashboard Data
  // ==========================================================================
  erpTeam: {
    persona: {
      name: "ERP Team",
      icon: "âš™ï¸",
      level: "City",
      aggregateBy: ["city"],
      description: "Enablement, vendor codes, contract sync, config"
    },
    kpis: {
      enablementRate: {
        value: 94, target: 99, unit: "%", status: "warning", trend: -2,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [96, 95, 95, 95, 94, 94, 94] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [97, 97, 96, 96, 95, 95, 94] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [98, 98, 97, 97, 96, 95, 94] }
        }
      },
      missingVendorCodes: {
        value: 12, threshold: 5, status: "critical", trend: +4,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [9, 10, 10, 11, 11, 12, 12] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [6, 7, 8, 9, 10, 11, 12] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [3, 4, 5, 7, 8, 10, 12] }
        }
      },
      contractSync: {
        value: 88, target: 95, unit: "%", status: "warning", trend: -3,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [91, 90, 90, 89, 89, 88, 88] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [93, 92, 91, 90, 90, 89, 88] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [96, 95, 94, 92, 91, 89, 88] }
        }
      },
      configErrors: {
        value: 8, status: "warning", trend: +2,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [6, 6, 7, 7, 8, 8, 8] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [5, 5, 6, 6, 7, 7, 8] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [3, 4, 4, 5, 6, 7, 8] }
        }
      }
    },
    alerts: [
      {
        alert_id: "ERP-001",
        owner: "ERP Team",
        scope: "CITY",
        entity: "Bangalore",
        gmv_loss: 120000,
        rank: 1,
        priority: "P1",
        affected_sku_count: 45,
        affected_skus: [
          { sku_id: "SKU-LD-ML500", sku_name: "Local Dairy Milk 500ml", chronic_days: 18 },
          { sku_id: "SKU-FF-VG200", sku_name: "Fresh Farms Veggies 200g", chronic_days: 17 },
          { sku_id: "SKU-RB-BR400", sku_name: "Regional Bakery Bread 400g", chronic_days: 16 }
        ],
        chronic_days_avg: 18,
        l1_reason_distribution: {
          "Vendor Code Not Available": 0.80,
          "ERP Disabled": 0.20
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "45 SKUs blocked. 12 vendors awaiting SAP vendor code creation. POs cannot be raised without codes.",
        key_signals: ["Missing Codes: 12 vendors (target 0)", "Chronic Days: 18", "SKUs Affected: 45"],
        actions: [
          { action_id: "ERP-001-A1", text: "Fast-track vendor code creation for 12 vendors", gmv_at_risk: 75000, owner: "ERP Team", status: "pending" },
          { action_id: "ERP-001-A2", text: "Escalate to ERP admin for expedited processing", gmv_at_risk: 45000, owner: "ERP Team", status: "pending" }
        ],
        key_metric: { label: "Missing Codes", value: 12, target: 0, unit: "vendors" },
        trend: [5, 6, 7, 8, 9, 10, 12],
        impact_scope: { count: 12, unit: "vendors", percentage: 15 }
      },
      {
        alert_id: "ERP-002",
        owner: "ERP Team",
        scope: "CITY",
        entity: "Bangalore",
        gmv_loss: 85000,
        rank: 2,
        priority: "P1",
        affected_sku_count: 32,
        affected_skus: [
          { sku_id: "SKU-DB-CH100", sku_name: "Dabur Chyawanprash 100g", chronic_days: 14 },
          { sku_id: "SKU-MR-PC200", sku_name: "Marico Parachute 200ml", chronic_days: 13 },
          { sku_id: "SKU-GD-GH100", sku_name: "Godrej Hair Color 100ml", chronic_days: 12 }
        ],
        chronic_days_avg: 14,
        l1_reason_distribution: {
          "Vinculum Error": 0.60,
          "Contract Not Available": 0.40
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "32 SKUs affected. Contract terms for 8 vendors not synced to procurement system. Causing pricing and MOQ discrepancies.",
        key_signals: ["Sync Rate: 88% (target 95%)", "Chronic Days: 14", "SKUs Affected: 32"],
        actions: [
          { action_id: "ERP-002-A1", text: "Debug contract sync pipeline", gmv_at_risk: 55000, owner: "ERP Team", status: "pending" },
          { action_id: "ERP-002-A2", text: "Manual contract update for 8 vendors", gmv_at_risk: 30000, owner: "ERP Team", status: "pending" }
        ],
        key_metric: { label: "Sync Rate", value: 88, target: 95, unit: "%" },
        trend: [95, 94, 92, 91, 90, 89, 88],
        impact_scope: { count: 8, unit: "contracts", percentage: 12 }
      },
      {
        alert_id: "ERP-003",
        owner: "ERP Team",
        scope: "CITY",
        entity: "Bangalore",
        gmv_loss: 65000,
        rank: 3,
        priority: "P2",
        affected_sku_count: 45,
        affected_skus: [
          { sku_id: "SKU-HL-NW100", sku_name: "Haldiram Namkeen (New) 100g", chronic_days: 12 },
          { sku_id: "SKU-MT-RG200", sku_name: "MTR Masala (Regional) 200g", chronic_days: 11 },
          { sku_id: "SKU-CP-SS500", sku_name: "Cadbury (Seasonal) 500g", chronic_days: 10 }
        ],
        chronic_days_avg: 12,
        l1_reason_distribution: {
          "ERP Disabled": 0.70,
          "Temp Disable": 0.30
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "45 SKUs pending enablement in ERP system. Includes new launches, regional variants, and seasonal items. Bottleneck in master data team.",
        key_signals: ["Pending Enable: 45 SKUs (target 10)", "Chronic Days: 12", "SKUs Affected: 45"],
        actions: [
          { action_id: "ERP-003-A1", text: "Clear SKU enablement backlog (45 items)", gmv_at_risk: 40000, owner: "ERP Team", status: "pending" },
          { action_id: "ERP-003-A2", text: "Add temp resource to master data team", gmv_at_risk: 25000, owner: "ERP Team", status: "pending" }
        ],
        key_metric: { label: "Pending Enable", value: 45, target: 10, unit: "SKUs" },
        trend: [20, 25, 30, 35, 38, 42, 45],
        impact_scope: { count: 45, unit: "SKUs", percentage: 8 }
      },
      {
        alert_id: "ERP-004",
        owner: "ERP Team",
        scope: "CITY",
        entity: "Bangalore",
        gmv_loss: 45000,
        rank: 4,
        priority: "P2",
        affected_sku_count: 85,
        affected_skus: [
          { sku_id: "SKU-HM-PN250", sku_name: "Haldiram's Peanuts 250g", chronic_days: 16 },
          { sku_id: "SKU-LY-IN100", sku_name: "Lay's India's Magic Masala 100g", chronic_days: 15 },
          { sku_id: "SKU-BR-5050-200", sku_name: "Britannia 50-50 200g", chronic_days: 14 }
        ],
        chronic_days_avg: 16,
        l1_reason_distribution: {
          "ERP Disabled": 1.00
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "85 SKUs affected. 8 pods have incorrect tier configuration causing wrong assortment assignment.",
        key_signals: ["Config Errors: 8 pods (target 0)", "Chronic Days: 16", "SKUs Affected: 85"],
        actions: [
          { action_id: "ERP-004-A1", text: "Correct tier mapping for 8 pods", gmv_at_risk: 28000, owner: "ERP Team", status: "pending" },
          { action_id: "ERP-004-A2", text: "Audit all pod configurations", gmv_at_risk: 17000, owner: "ERP Team", status: "pending" }
        ],
        key_metric: { label: "Config Errors", value: 8, target: 0, unit: "errors" },
        trend: [3, 4, 5, 6, 6, 7, 8],
        impact_scope: { count: 8, unit: "pods", percentage: 10 }
      }
    ]
  },

  // ==========================================================================
  // Product Support Dashboard Data
  // ==========================================================================
  productSupport: {
    persona: {
      name: "Product Support",
      icon: "ðŸ”§",
      level: "SKU",
      aggregateBy: ["sku_id"],
      description: "OOS overrides, stale rules, holiday config, CR rules"
    },
    kpis: {
      oosOverrides: {
        value: 23, threshold: 10, unit: "active", status: "warning", trend: +5,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [19, 20, 21, 21, 22, 22, 23] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [15, 16, 18, 19, 20, 22, 23] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [10, 12, 14, 16, 18, 21, 23] }
        }
      },
      staleRules: {
        value: 15, threshold: 5, status: "critical", trend: +8,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [10, 11, 12, 13, 14, 14, 15] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [7, 8, 10, 11, 12, 14, 15] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [3, 5, 7, 9, 11, 13, 15] }
        }
      },
      holidayMisconfig: {
        value: 3, threshold: 0, status: "warning", trend: +1,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [2, 2, 3, 3, 3, 3, 3] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [1, 1, 2, 2, 2, 3, 3] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [0, 0, 1, 1, 2, 2, 3] }
        }
      },
      crRuleErrors: {
        value: 4, threshold: 2, status: "warning", trend: +2,
        trendHistory: {
          '7d': { labels: ['Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16', 'Jan 17', 'Jan 18'], data: [2, 3, 3, 3, 4, 4, 4] },
          '30d': { labels: ['Dec 19', 'Dec 24', 'Dec 29', 'Jan 3', 'Jan 8', 'Jan 13', 'Jan 18'], data: [1, 2, 2, 3, 3, 3, 4] },
          '180d': { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'], data: [0, 1, 1, 2, 2, 3, 4] }
        }
      }
    },
    alerts: [
      {
        alert_id: "PS-001",
        owner: "Product Support",
        scope: "CONFIG",
        entity: "Stale Override Rules",
        gmv_loss: 85000,
        rank: 1,
        priority: "P1",
        affected_sku_count: 15,
        affected_skus: [
          { sku_id: "SKU-CC-500", sku_name: "Coca-Cola 500ml", chronic_days: 22 },
          { sku_id: "SKU-PG-100", sku_name: "Parle-G 100g", chronic_days: 20 },
          { sku_id: "SKU-AM-500", sku_name: "Amul Milk 500ml", chronic_days: 18 }
        ],
        chronic_days_avg: 22,
        l1_reason_distribution: {
          "POD Inactive": 1.00
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "15 override rules active beyond intended period. Affecting SKUs with promo, manual block, and test configs.",
        key_signals: ["Stale Rules: 15 (target 0)", "Chronic Days: 22", "SKUs Affected: 15"],
        actions: [
          { action_id: "PS-001-A1", text: "Audit and cleanup 15 stale rules", gmv_at_risk: 55000, owner: "Product Support", status: "pending" },
          { action_id: "PS-001-A2", text: "Set mandatory expiry on all new rules", gmv_at_risk: 30000, owner: "Product Support", status: "pending" }
        ],
        key_metric: { label: "Stale Rules", value: 15, target: 0, unit: "rules" },
        trend: [5, 7, 8, 10, 12, 14, 15],
        impact_scope: { count: 15, unit: "SKUs", percentage: 35 }
      },
      {
        alert_id: "PS-002",
        owner: "Product Support",
        scope: "CONFIG",
        entity: "Holiday Calendar Config",
        gmv_loss: 45000,
        rank: 2,
        priority: "P1",
        affected_sku_count: 120,
        affected_skus: [
          { sku_id: "SKU-DM-500", sku_name: "Dairy Milk 500g", chronic_days: 8 },
          { sku_id: "SKU-MG-200", sku_name: "Maggi 200g", chronic_days: 7 },
          { sku_id: "SKU-TB-100", sku_name: "Tata Tea 100g", chronic_days: 6 }
        ],
        chronic_days_avg: 8,
        l1_reason_distribution: {
          "POD Inactive": 0.70,
          "POD Closure": 0.30
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "Holiday calendar not updated for Jan. 120 SKUs affected during Republic Day, Makara Sankranti, Pongal periods.",
        key_signals: ["Holidays Missing: 3 (target 0)", "Chronic Days: 8", "SKUs Affected: 120"],
        actions: [
          { action_id: "PS-002-A1", text: "Update holiday calendar for Jan-Feb", gmv_at_risk: 30000, owner: "Product Support", status: "pending" },
          { action_id: "PS-002-A2", text: "Add regional holidays to system", gmv_at_risk: 15000, owner: "Product Support", status: "pending" }
        ],
        key_metric: { label: "Holidays Missing", value: 3, target: 0, unit: "days" },
        trend: [0, 0, 1, 1, 2, 2, 3],
        impact_scope: { count: 120, unit: "SKUs", percentage: 2 }
      },
      {
        alert_id: "PS-003",
        owner: "Product Support",
        scope: "CONFIG",
        entity: "OOS Override Accumulation",
        gmv_loss: 35000,
        rank: 3,
        priority: "P2",
        affected_sku_count: 23,
        affected_skus: [
          { sku_id: "SKU-LY-150", sku_name: "Lay's Classic 150g", chronic_days: 18 },
          { sku_id: "SKU-KK-50", sku_name: "KitKat 50g", chronic_days: 16 },
          { sku_id: "SKU-OR-120", sku_name: "Oreo 120g", chronic_days: 15 }
        ],
        chronic_days_avg: 18,
        l1_reason_distribution: {
          "POD Inactive": 0.80,
          "Temp Disable": 0.20
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "23 SKUs have active OOS overrides. Many are one-time fixes that were never removed after issue resolution.",
        key_signals: ["Active Overrides: 23 (target 10)", "Chronic Days: 18", "SKUs Affected: 23"],
        actions: [
          { action_id: "PS-003-A1", text: "Cleanup 13 stale OOS overrides", gmv_at_risk: 22000, owner: "Product Support", status: "pending" },
          { action_id: "PS-003-A2", text: "Add auto-expiry to override system", gmv_at_risk: 13000, owner: "Product Support", status: "pending" }
        ],
        key_metric: { label: "Active Overrides", value: 23, target: 10, unit: "SKUs" },
        trend: [12, 14, 16, 18, 20, 22, 23],
        impact_scope: { count: 23, unit: "SKUs", percentage: 0.4 }
      },
      {
        alert_id: "PS-004",
        owner: "Product Support",
        scope: "CONFIG",
        entity: "CR Rule Conflicts",
        gmv_loss: 25000,
        rank: 4,
        priority: "P2",
        affected_sku_count: 45,
        affected_skus: [
          { sku_id: "SKU-NS-500", sku_name: "Nestle Milk 500ml", chronic_days: 14 },
          { sku_id: "SKU-BR-400", sku_name: "Britannia Bread 400g", chronic_days: 13 },
          { sku_id: "SKU-HZ-200", sku_name: "Heinz Ketchup 200g", chronic_days: 12 }
        ],
        chronic_days_avg: 14,
        l1_reason_distribution: {
          "Movement_Blocking": 1.00
        },
        is_primary: true,
        shared_with: null,
        l3_narrative: "4 CR rules with conflicting MOQ/max qty settings. Affecting 45 SKUs with unpredictable replenishment behavior.",
        key_signals: ["Rule Conflicts: 4 (target 0)", "Chronic Days: 14", "SKUs Affected: 45"],
        actions: [
          { action_id: "PS-004-A1", text: "Resolve 4 CR rule conflicts", gmv_at_risk: 16000, owner: "Product Support", status: "pending" },
          { action_id: "PS-004-A2", text: "Define rule priority hierarchy", gmv_at_risk: 9000, owner: "Product Support", status: "pending" }
        ],
        key_metric: { label: "Rule Conflicts", value: 4, target: 0, unit: "rules" },
        trend: [1, 1, 2, 2, 3, 3, 4],
        impact_scope: { count: 45, unit: "SKUs", percentage: 0.75 }
      }
    ]
  }
};

// ==========================================================================
// Reason Codes Mapping (from IM Availability RCA Reasons Mapping.csv)
// ==========================================================================

/**
 * Maps reason codes to their bins, CSV owners, and display owners
 * Format: { code: { bin, csvOwner, displayOwner, description } }
 */
const reasonCodes = {
  // OOS codes (warehouse out of stock)
  'oos_0': { bin: 'POD Inactive', csvOwner: 'Business', displayOwner: 'Product Support', description: 'POD is inactive' },
  'oos_2': { bin: 'ERP Disabled', csvOwner: 'Catalog', displayOwner: 'ERP Team', description: 'Item not in ERP' },
  'oos_3': { bin: 'Temp Disable', csvOwner: 'Catalog', displayOwner: 'ERP Team', description: 'Item temporarily disabled' },
  'oos_5': { bin: 'Fresh', csvOwner: 'NA', displayOwner: null, description: 'Fresh items' },
  'oos_6': { bin: 'Movement_Blocking', csvOwner: 'Planning', displayOwner: 'Planning', description: 'RR not generated' },
  'oos_7': { bin: 'Movement_Blocking', csvOwner: 'Planning', displayOwner: 'Planning', description: 'RR blocked (0.001)' },
  'oos_8': { bin: 'Long Term Supply issue', csvOwner: 'Cat M', displayOwner: 'Category Management', description: 'Vendor supply problem' },
  'oos_9': { bin: 'Fill Rate issue', csvOwner: 'Procurement', displayOwner: 'Procurement', description: 'Vendor fill rate <80%' },
  'oos_9a': { bin: 'Last PO Fill Rate issue', csvOwner: 'Procurement', displayOwner: 'Procurement', description: 'Last PO <50% filled' },
  'oos_9b': { bin: 'OTIF', csvOwner: 'Procurement', displayOwner: 'Procurement', description: 'Late delivery' },
  'oos_9c': { bin: 'Vendor Code Not Available', csvOwner: 'Catalog', displayOwner: 'ERP Team', description: 'Missing vendor code' },
  'oos_9d': { bin: 'Contract Not Available', csvOwner: 'Cat M', displayOwner: 'Category Management', description: 'Missing contract' },
  'oos_9e': { bin: 'OTB Block', csvOwner: 'Cat M', displayOwner: 'Category Management', description: 'Budget constraint' },
  'oos_9f': { bin: 'Vinculum Error', csvOwner: 'Catalog', displayOwner: 'ERP Team', description: 'System error' },
  'oos_9g': { bin: 'MOV/MOQ/Tonnage Constraint', csvOwner: 'Procurement', displayOwner: 'Procurement', description: 'Order constraint' },
  'oos_9h': { bin: 'Case Size Constraint', csvOwner: 'Cat M', displayOwner: 'Category Management', description: 'Min case not met' },
  'oos_10': { bin: 'Ordering / OTIF / Contract issue', csvOwner: 'Planning', displayOwner: 'Planning', description: 'Catch-all ordering' },

  // Instock codes (warehouse has stock, pod doesn't)
  'instock_0': { bin: 'POD Inactive', csvOwner: 'Business', displayOwner: 'Product Support', description: 'POD is inactive' },
  'instock_1': { bin: 'ERP Disabled', csvOwner: 'Catalog', displayOwner: 'ERP Team', description: 'Item not in ERP at POD' },
  'instock_2': { bin: 'POD Closure', csvOwner: 'Pod Ops', displayOwner: 'Pod Ops', description: 'Movement blocked for POD' },
  'instock_6': { bin: 'Movement_Blocking', csvOwner: 'Planning', displayOwner: 'Planning', description: 'RR not generated' },
  'instock_7': { bin: 'Movement_Blocking', csvOwner: 'Planning', displayOwner: 'Planning', description: 'RR blocked' },
  'instock_8': { bin: 'Pod Missed Qty', csvOwner: 'Pod Ops', displayOwner: 'Pod Ops', description: 'POD capacity full' },
  'instock_9': { bin: 'Warehouse Missed Qty', csvOwner: 'Warehouse', displayOwner: 'Warehouse', description: 'WH capacity exceeded' },
  'instock_10': { bin: 'WH Capacity (Movement Setting Reduced)', csvOwner: 'Warehouse', displayOwner: 'Warehouse', description: 'Movement reduced' },
  'instock_11': { bin: 'Pod_Space Issue_freezer', csvOwner: 'Pod Ops', displayOwner: 'Pod Ops', description: 'Cold storage full' },
  'instock_12': { bin: 'Warehouse Outbound Fillrate Impact', csvOwner: 'Warehouse', displayOwner: 'Warehouse', description: 'WH fill rate <80%' },
  'instock_12a': { bin: 'Stock Transfer Delay Issue', csvOwner: 'Warehouse', displayOwner: 'Warehouse', description: 'WH-to-POD delay' },
  'instock_13': { bin: 'Forecast Error', csvOwner: 'Planning', displayOwner: 'Planning', description: 'Sales >3x forecast' },
  'instock_14': { bin: 'Pod Inward Delay Impact', csvOwner: 'Pod Ops', displayOwner: 'Pod Ops', description: 'GRN delay at POD' },
  'instock_15': { bin: 'WH Putaway Delay', csvOwner: 'Warehouse', displayOwner: 'Warehouse', description: 'Stock in staging' },
  'instock_16': { bin: 'Movement Setting Design Issue', csvOwner: 'Planning', displayOwner: 'Planning', description: 'Conservative movement' },
  'instock_17': { bin: 'Unallocated Bin', csvOwner: 'NA', displayOwner: null, description: 'Unexplained' },
  'instock_18': { bin: 'Warehouse Outbound Fillrate Impact', csvOwner: 'Warehouse', displayOwner: 'Warehouse', description: 'QPL dropped qty' }
};

/**
 * Owner mapping: CSV ai_owner â†’ Display name
 */
const ownerMapping = {
  'Cat M': 'Category Management',
  'Procurement': 'Procurement',
  'Pod Ops': 'Pod Ops',
  'Planning': 'Planning',
  'Warehouse': 'Warehouse',
  'Catalog': 'ERP Team',
  'Business': 'Product Support',
  'NA': null  // Excluded from owner attribution
};

/**
 * Reverse mapping: Display name â†’ CSV ai_owner
 */
const reverseOwnerMapping = {
  'Category Management': 'Cat M',
  'Procurement': 'Procurement',
  'Pod Ops': 'Pod Ops',
  'Planning': 'Planning',
  'Warehouse': 'Warehouse',
  'ERP Team': 'Catalog',
  'Product Support': 'Business'
};

/**
 * Get reason code details by code
 */
function getReasonCodeDetails(code) {
  return reasonCodes[code] || null;
}

/**
 * Get display owner from CSV owner
 */
function getDisplayOwner(csvOwner) {
  return ownerMapping[csvOwner] || csvOwner;
}

// ==========================================================================
// Helper Functions
// ==========================================================================

/**
 * Format GMV value to human readable string (â‚¹X.XL or â‚¹X.XK)
 */
function formatGmv(value) {
  if (value >= 100000) {
    return `â‚¹${(value / 100000).toFixed(1)}L`;
  }
  if (value >= 1000) {
    return `â‚¹${(value / 1000).toFixed(1)}K`;
  }
  return `â‚¹${value}`;
}

/**
 * Get status class based on status string
 */
function getStatusClass(status) {
  const statusMap = {
    'critical': 'badge--critical',
    'warning': 'badge--warning',
    'good': 'badge--success',
    'neutral': 'badge--neutral'
  };
  return statusMap[status] || 'badge--neutral';
}

/**
 * Get priority class based on priority string
 */
function getPriorityClass(priority) {
  const priorityMap = {
    'P0': 'alert-card--p0',
    'P1': 'alert-card--p1',
    'P2': 'alert-card--p2'
  };
  return priorityMap[priority] || 'alert-card--p2';
}

/**
 * Generate realistic trend history data for KPIs
 * @param {number} currentValue - Current KPI value
 * @param {string} status - 'critical', 'warning', or 'good'
 * @param {boolean} invertTrend - If true, higher was worse (e.g., for errors count)
 * @returns {Object} Trend history with 7d, 30d, 180d data
 */
function generateTrendHistory(currentValue, status, invertTrend = false) {
  const today = new Date('2026-01-18');

  // Generate 7-day labels and data
  const labels7d = [];
  for (let i = 6; i >= 0; i--) {
    const d = new Date(today);
    d.setDate(d.getDate() - i);
    labels7d.push(d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
  }

  // Generate 30-day labels (7 points)
  const labels30d = [];
  for (let i = 6; i >= 0; i--) {
    const d = new Date(today);
    d.setDate(d.getDate() - i * 5);
    labels30d.push(d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
  }

  // Generate 180-day labels (monthly)
  const labels180d = ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'];

  // Generate data based on status
  let data7d, data30d, data180d;
  const variation = currentValue * 0.05; // 5% variation

  if (status === 'critical') {
    // Declining trend - was better before
    data7d = generateDecline(currentValue, 7, variation * 0.5);
    data30d = generateDecline(currentValue, 7, variation * 1.5);
    data180d = generateDecline(currentValue, 7, variation * 3);
  } else if (status === 'warning') {
    // Slight decline or flat
    data7d = generateSlightDecline(currentValue, 7, variation * 0.3);
    data30d = generateSlightDecline(currentValue, 7, variation);
    data180d = generateSlightDecline(currentValue, 7, variation * 2);
  } else {
    // Good - improving or stable
    data7d = generateImproving(currentValue, 7, variation * 0.3);
    data30d = generateImproving(currentValue, 7, variation);
    data180d = generateImproving(currentValue, 7, variation * 2);
  }

  // If invertTrend, flip the data direction
  if (invertTrend) {
    data7d = data7d.reverse();
    data30d = data30d.reverse();
    data180d = data180d.reverse();
  }

  return {
    '7d': { labels: labels7d, data: data7d },
    '30d': { labels: labels30d, data: data30d },
    '180d': { labels: labels180d, data: data180d }
  };
}

function generateDecline(endValue, points, totalDrop) {
  const result = [];
  const startValue = endValue + totalDrop;
  for (let i = 0; i < points; i++) {
    const progress = i / (points - 1);
    const value = startValue - (totalDrop * progress) + (Math.random() - 0.5) * (totalDrop * 0.1);
    result.push(Math.round(value * 10) / 10);
  }
  result[points - 1] = endValue; // Ensure last value is exact
  return result;
}

function generateSlightDecline(endValue, points, totalDrop) {
  const result = [];
  const startValue = endValue + totalDrop * 0.5;
  for (let i = 0; i < points; i++) {
    const progress = i / (points - 1);
    const value = startValue - (totalDrop * 0.5 * progress) + (Math.random() - 0.5) * (totalDrop * 0.2);
    result.push(Math.round(value * 10) / 10);
  }
  result[points - 1] = endValue;
  return result;
}

function generateImproving(endValue, points, totalGain) {
  const result = [];
  const startValue = endValue - totalGain;
  for (let i = 0; i < points; i++) {
    const progress = i / (points - 1);
    const value = startValue + (totalGain * progress) + (Math.random() - 0.5) * (totalGain * 0.1);
    result.push(Math.round(value * 10) / 10);
  }
  result[points - 1] = endValue;
  return result;
}

/**
 * Format trend value with arrow
 */
function formatTrend(value, invertColors = false) {
  if (value === 0) {
    return { text: 'â†’ 0', class: 'kpi-card__trend--neutral' };
  }

  const isPositive = value > 0;
  const arrow = isPositive ? 'â†‘' : 'â†“';
  const text = `${arrow} ${Math.abs(value)}`;

  // For some metrics, up is bad (e.g., chronic SKUs)
  // For others, up is good (e.g., resolution rate)
  let trendClass;
  if (invertColors) {
    trendClass = isPositive ? 'kpi-card__trend--down' : 'kpi-card__trend--up';
  } else {
    trendClass = isPositive ? 'kpi-card__trend--up' : 'kpi-card__trend--down';
  }

  return { text, class: trendClass };
}

/**
 * Get persona data by key
 */
function getPersonaData(key) {
  const personaMap = {
    'category': mockData.categoryManagement,
    'procurement': mockData.procurement,
    'pod-ops': mockData.podOps,
    'planning': mockData.planning,
    'warehouse': mockData.warehouse,
    'erp-team': mockData.erpTeam,
    'product-support': mockData.productSupport
  };
  return personaMap[key];
}

/**
 * Get all persona keys
 */
function getPersonaKeys() {
  return ['category', 'procurement', 'pod-ops', 'planning', 'warehouse', 'erp-team', 'product-support'];
}

/**
 * Extract top actionables from alerts
 * Collects all actions from alerts, sorts by GMV, returns top N
 * @param {Array} alerts - Array of alert objects
 * @param {number} limit - Maximum number of actionables to return
 * @returns {Array} Sorted actionables array in actionable item format
 */
function getTopActionablesFromAlerts(alerts, limit = 5) {
  const allActions = [];

  alerts.forEach(alert => {
    if (alert.actions && Array.isArray(alert.actions)) {
      alert.actions.forEach((action, idx) => {
        // Support both new schema and legacy formats
        if (typeof action === 'object') {
          allActions.push({
            id: action.action_id || action.id || `${alert.alert_id || alert.id}-A${idx}`,
            action: action.text,
            gmv: action.gmv_at_risk || action.gmv || 0,
            owner: action.owner || '',
            completed: action.status === 'completed' || action.completed || false,
            status: action.status || (action.completed ? 'completed' : 'pending'),
            alertId: alert.alert_id || alert.id,
            priority: alert.priority
          });
        } else {
          // Legacy string format - use alert GMV split evenly
          allActions.push({
            id: `${alert.alert_id || alert.id}-A${idx}`,
            action: action,
            gmv: Math.round((alert.gmv_loss || alert.gmv) / (alert.actions?.length || 1)),
            owner: '',
            completed: false,
            status: 'pending',
            alertId: alert.alert_id || alert.id,
            priority: alert.priority
          });
        }
      });
    }
  });

  // Sort by GMV descending, then return top N
  return allActions
    .sort((a, b) => b.gmv - a.gmv)
    .slice(0, limit);
}


// === js/components/chart.js ===
/**
 * Chart Components
 * Wrappers for Chart.js and custom canvas charts
 */


/**
 * Draw a sparkline on a canvas element
 * Lightweight alternative to Chart.js for small trend indicators
 * @param {HTMLCanvasElement} canvas - Canvas element
 * @param {Array<number>} data - Array of values
 * @param {string} [color='#3b82f6'] - Line color
 */
function drawSparkline(canvas, data, color = '#3b82f6') {
  if (!canvas || !data || data.length < 2) return;

  const ctx = canvas.getContext('2d');
  const width = canvas.width;
  const height = canvas.height;
  const padding = 2;

  // Clear canvas
  ctx.clearRect(0, 0, width, height);

  // Find min/max for scaling
  const min = Math.min(...data);
  const max = Math.max(...data);
  const range = max - min || 1;

  // Calculate points
  const stepX = (width - padding * 2) / (data.length - 1);
  const points = data.map((value, i) => ({
    x: padding + i * stepX,
    y: height - padding - ((value - min) / range) * (height - padding * 2)
  }));

  // Draw line
  ctx.beginPath();
  ctx.moveTo(points[0].x, points[0].y);
  points.slice(1).forEach(point => {
    ctx.lineTo(point.x, point.y);
  });
  ctx.strokeStyle = color;
  ctx.lineWidth = 1.5;
  ctx.lineCap = 'round';
  ctx.lineJoin = 'round';
  ctx.stroke();

  // Draw endpoint dot
  const lastPoint = points[points.length - 1];
  ctx.beginPath();
  ctx.arc(lastPoint.x, lastPoint.y, 2, 0, Math.PI * 2);
  ctx.fillStyle = color;
  ctx.fill();
}

/**
 * Create a horizontal bar chart (custom HTML/CSS)
 * @param {Object} options - Chart options
 * @param {string} options.title - Chart title
 * @param {Array} options.data - Array of {label, value, icon, color}
 * @param {boolean} [options.isGmv=false] - Format values as GMV
 * @param {boolean} [options.showPercentage=false] - Show as percentage
 * @returns {string} HTML string
 */
function createHorizontalBarChart({ title, data, isGmv = false, showPercentage = false }) {
  const maxValue = Math.max(...data.map(d => d.value));

  const barsHtml = data.map(item => {
    const percentage = (item.value / maxValue) * 100;
    const displayValue = isGmv ? formatGmv(item.value) :
                         showPercentage ? `${item.value}%` : item.value;
    const barColor = item.color || 'var(--color-primary)';

    return `
      <div class="h-bar-chart__item">
        <div class="h-bar-chart__label">
          ${item.icon ? `<span class="h-bar-chart__icon">${item.icon}</span>` : ''}
          <span>${item.label}</span>
        </div>
        <div class="h-bar-chart__bar-container">
          <div class="h-bar-chart__bar" style="width: ${percentage}%; background: ${barColor}"></div>
        </div>
        <span class="h-bar-chart__value">${displayValue}</span>
      </div>
    `;
  }).join('');

  return `
    <div class="chart-container">
      <div class="chart-container__header">
        <h4 class="chart-container__title">${title}</h4>
      </div>
      <div class="h-bar-chart">
        ${barsHtml}
      </div>
    </div>
  `;
}

/**
 * Create a breakdown list (vertical list with progress bars)
 * @param {Object} options - Options
 * @param {string} options.title - Section title
 * @param {Array} options.data - Array of {label, value, percentage, color}
 * @returns {string} HTML string
 */
function createBreakdownList({ title, data }) {
  const itemsHtml = data.map(item => `
    <div class="breakdown-item">
      <span class="breakdown-item__label">${item.label || item.range}</span>
      <span class="breakdown-item__value">${item.percentage}%</span>
      <div class="breakdown-item__bar">
        <div class="breakdown-item__bar-fill" style="width: ${item.percentage}%; background: ${item.color || 'var(--color-primary)'}"></div>
      </div>
    </div>
  `).join('');

  return `
    <div class="chart-container">
      <div class="chart-container__header">
        <h4 class="chart-container__title">${title}</h4>
      </div>
      <div class="breakdown-list">
        ${itemsHtml}
      </div>
    </div>
  `;
}

/**
 * Create a Chart.js line chart
 * @param {string} canvasId - Canvas element ID
 * @param {Object} options - Chart options
 * @param {string} options.title - Chart title
 * @param {Array} options.labels - X-axis labels
 * @param {Array} options.data - Data values
 * @param {string} [options.label='Value'] - Dataset label
 * @param {string} [options.color='#3b82f6'] - Line color
 * @returns {string} HTML string for chart container
 */
function createLineChartContainer({ canvasId, title, subtitle }) {
  return `
    <div class="chart-container">
      <div class="chart-container__header">
        <div>
          <h4 class="chart-container__title">${title}</h4>
          ${subtitle ? `<span class="chart-container__subtitle">${subtitle}</span>` : ''}
        </div>
      </div>
      <div class="chart-container__canvas">
        <canvas id="${canvasId}" height="250"></canvas>
      </div>
    </div>
  `;
}

/**
 * Initialize a Chart.js line chart
 * @param {string} canvasId - Canvas element ID
 * @param {Object} config - Chart configuration
 */
function initLineChart(canvasId, { labels, data, label = 'Value', color = '#3b82f6' }) {
  const canvas = document.getElementById(canvasId);
  if (!canvas || typeof Chart === 'undefined') return null;

  return new Chart(canvas, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label,
        data,
        borderColor: color,
        backgroundColor: `${color}20`,
        borderWidth: 2,
        fill: true,
        tension: 0.3,
        pointRadius: 0,
        pointHoverRadius: 4
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          mode: 'index',
          intersect: false
        }
      },
      scales: {
        x: {
          grid: {
            display: false
          },
          ticks: {
            maxTicksLimit: 8,
            font: {
              size: 11
            }
          }
        },
        y: {
          beginAtZero: false,
          grid: {
            color: '#e5e7eb'
          },
          ticks: {
            font: {
              size: 11
            }
          }
        }
      },
      interaction: {
        mode: 'nearest',
        axis: 'x',
        intersect: false
      }
    }
  });
}

/**
 * Create a doughnut chart container
 */
function createDoughnutChartContainer({ canvasId, title }) {
  return `
    <div class="chart-container">
      <div class="chart-container__header">
        <h4 class="chart-container__title">${title}</h4>
      </div>
      <div class="chart-container__canvas" style="height: 250px; display: flex; justify-content: center;">
        <canvas id="${canvasId}"></canvas>
      </div>
    </div>
  `;
}

/**
 * Initialize a Chart.js doughnut chart
 */
function initDoughnutChart(canvasId, { labels, data, colors }) {
  const canvas = document.getElementById(canvasId);
  if (!canvas || typeof Chart === 'undefined') return null;

  return new Chart(canvas, {
    type: 'doughnut',
    data: {
      labels,
      datasets: [{
        data,
        backgroundColor: colors,
        borderWidth: 0,
        hoverOffset: 4
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      cutout: '60%',
      plugins: {
        legend: {
          position: 'right',
          labels: {
            padding: 12,
            font: {
              size: 11
            },
            usePointStyle: true,
            pointStyle: 'circle'
          }
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              return `${context.label}: ${context.raw}%`;
            }
          }
        }
      }
    }
  });
}

/**
 * Create a bar chart container
 */
function createBarChartContainer({ canvasId, title }) {
  return `
    <div class="chart-container">
      <div class="chart-container__header">
        <h4 class="chart-container__title">${title}</h4>
      </div>
      <div class="chart-container__canvas">
        <canvas id="${canvasId}" height="250"></canvas>
      </div>
    </div>
  `;
}

/**
 * Initialize a Chart.js horizontal bar chart
 */
function initHorizontalBarChart(canvasId, { labels, data, colors, isGmv = false }) {
  const canvas = document.getElementById(canvasId);
  if (!canvas || typeof Chart === 'undefined') return null;

  return new Chart(canvas, {
    type: 'bar',
    data: {
      labels,
      datasets: [{
        data,
        backgroundColor: colors || '#3b82f6',
        borderRadius: 4,
        barThickness: 24
      }]
    },
    options: {
      indexAxis: 'y',
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              return isGmv ? formatGmv(context.raw) : context.raw;
            }
          }
        }
      },
      scales: {
        x: {
          grid: {
            color: '#e5e7eb'
          },
          ticks: {
            callback: function(value) {
              return isGmv ? formatGmv(value) : value;
            },
            font: {
              size: 11
            }
          }
        },
        y: {
          grid: {
            display: false
          },
          ticks: {
            font: {
              size: 11
            }
          }
        }
      }
    }
  });
}


// === js/components/kpi-card.js ===
/**
 * KPI Card Component
 * Renders a KPI card with value, target, trend, and status indicator
 * Now supports expandable trend charts with time period selectors
 */


// Store Chart instances for expandable KPIs (global for cleanup)
window.kpiCharts = window.kpiCharts || {};
window.kpiTrendData = window.kpiTrendData || {};

/**
 * Create a KPI card HTML string
 * @param {Object} options - Card options
 * @param {string} options.title - Card title/label
 * @param {string|number} options.value - Main value to display
 * @param {string} [options.unit] - Unit suffix (%, hrs, etc.)
 * @param {string|number} [options.target] - Target value for comparison
 * @param {number} [options.trend] - Trend value (+/- number)
 * @param {string} [options.status] - Status: 'critical', 'warning', 'good'
 * @param {boolean} [options.invertTrend] - If true, positive trend is bad
 * @param {string} [options.subtitle] - Additional context below value
 * @param {boolean} [options.isGmv] - If true, format value as GMV
 * @param {Object} [options.trendHistory] - Trend history data for expandable chart
 * @param {string} [options.kpiId] - Unique ID for this KPI (for chart)
 * @returns {string} HTML string
 */
function createKpiCard({
  title,
  value,
  unit = '',
  target,
  trend,
  status = 'neutral',
  invertTrend = false,
  subtitle,
  isGmv = false,
  trendHistory,
  kpiId
}) {
  // Format the main value
  let displayValue = isGmv ? formatGmv(value) : value;
  if (unit && !isGmv) {
    displayValue = `${value}${unit}`;
  }

  // Build target line
  let targetHtml = '';
  if (target !== undefined) {
    const targetDisplay = isGmv ? formatGmv(target) : `${target}${unit}`;
    targetHtml = `<span>Target: ${targetDisplay}</span>`;
  }

  // Build trend badge
  let trendHtml = '';
  if (trend !== undefined) {
    const trendData = formatTrend(trend, !invertTrend);
    trendHtml = `<span class="kpi-card__trend ${trendData.class}">${trendData.text}</span>`;
  }

  // Build subtitle
  let subtitleHtml = '';
  if (subtitle) {
    subtitleHtml = `<span class="text-gray-500">${subtitle}</span>`;
  }

  // Status class for left border
  const statusClass = status ? `kpi-card--${status}` : '';

  // Store trend data if provided (use window for global access in bundled file)
  if (trendHistory && kpiId) {
    window.kpiTrendData[kpiId] = trendHistory;
  }

  // Build expandable class and trend section if trendHistory exists
  const isExpandable = trendHistory && kpiId;
  const expandableClass = isExpandable ? 'kpi-card--expandable' : '';

  // Build trend section HTML for expandable KPIs
  let trendSectionHtml = '';
  if (isExpandable) {
    trendSectionHtml = `
      <div class="kpi-card__trend-section" onclick="event.stopPropagation()">
        <div class="kpi-card__period-selector">
          <button class="kpi-card__period-btn active" data-period="7d" onclick="updateKpiChart('${kpiId}', '7d')">7D</button>
          <button class="kpi-card__period-btn" data-period="30d" onclick="updateKpiChart('${kpiId}', '30d')">30D</button>
          <button class="kpi-card__period-btn" data-period="180d" onclick="updateKpiChart('${kpiId}', '180d')">180D</button>
        </div>
        <div class="kpi-card__chart">
          <canvas id="kpi-chart-${kpiId}" height="120"></canvas>
        </div>
      </div>
    `;
  }

  const clickHandler = isExpandable ? `onclick="toggleKpiCard('${kpiId}')"` : '';
  const dataAttr = kpiId ? `data-kpi-id="${kpiId}"` : '';

  return `
    <div class="kpi-card ${statusClass} ${expandableClass}" ${dataAttr} ${clickHandler}>
      <div class="kpi-card__header">
        <div class="kpi-card__label">${title}</div>
        ${isExpandable ? '<span class="kpi-card__expand-icon">â–¼</span>' : ''}
      </div>
      <div class="kpi-card__value">${displayValue}</div>
      <div class="kpi-card__target">
        ${targetHtml}
        ${trendHtml}
        ${subtitleHtml}
      </div>
      ${trendSectionHtml}
    </div>
  `;
}

/**
 * Create a row of KPI cards
 * @param {Array} kpis - Array of KPI configurations
 * @param {string} [gridClass] - Optional grid class override
 * @returns {string} HTML string
 */
function createKpiGrid(kpis, gridClass = 'kpi-grid') {
  const cards = kpis.map(kpi => createKpiCard(kpi)).join('');
  return `<div class="${gridClass}">${cards}</div>`;
}

/**
 * Create KPI cards for Executive dashboard
 * @param {Object} summary - Summary data from mock data
 * @returns {string} HTML string
 */
function createExecutiveKpis(summary) {
  const th = summary.trendHistory || {};
  const kpis = [
    {
      title: 'Availability',
      value: summary.availability,
      unit: '%',
      target: summary.target,
      status: summary.availability < summary.target - 1 ? 'critical' : 'warning',
      trend: -(summary.target - summary.availability).toFixed(1),
      invertTrend: true,
      kpiId: 'exec-availability',
      trendHistory: th.availability
    },
    {
      title: 'Chronic SKUs',
      value: summary.chronicIssues,
      trend: summary.sdlwComparison.chronicSkus,
      status: summary.sdlwComparison.chronicSkus > 0 ? 'critical' : 'good',
      subtitle: 'vs SDLW',
      kpiId: 'exec-chronic',
      trendHistory: th.chronicIssues
    },
    {
      title: 'GMV at Risk',
      value: summary.totalGmvAtRisk,
      isGmv: true,
      trend: summary.sdlwComparison.gmvAtRisk,
      invertTrend: true,
      status: summary.sdlwComparison.gmvAtRisk < 0 ? 'good' : 'warning',
      subtitle: '% vs SDLW',
      kpiId: 'exec-gmv',
      trendHistory: th.gmvAtRisk
    },
    {
      title: 'Total Alerts',
      value: summary.totalAlerts,
      subtitle: `P0:${summary.alertsByPriority.P0} P1:${summary.alertsByPriority.P1} P2:${summary.alertsByPriority.P2}`,
      status: summary.alertsByPriority.P0 > 3 ? 'critical' : 'warning',
      kpiId: 'exec-alerts',
      trendHistory: th.totalAlerts
    },
    {
      title: 'Resolution Rate',
      value: summary.resolutionRate,
      unit: '%',
      trend: summary.sdlwComparison.resolutionRate,
      invertTrend: false,
      status: summary.resolutionRate >= 70 ? 'good' : 'warning',
      subtitle: 'vs LW',
      kpiId: 'exec-resolution',
      trendHistory: th.resolutionRate
    }
  ];

  return createKpiGrid(kpis, 'kpi-grid kpi-grid--5');
}

/**
 * Create KPI cards for a persona dashboard
 * @param {Object} kpiData - KPI data object from persona
 * @param {string} [personaPrefix='kpi'] - Prefix for KPI IDs
 * @returns {string} HTML string
 */
function createPersonaKpis(kpiData, personaPrefix = 'kpi') {
  const kpis = Object.entries(kpiData).map(([key, data]) => {
    const config = {
      title: formatKpiTitle(key),
      value: data.value,
      unit: data.unit || '',
      status: data.status,
      trend: data.trend,
      kpiId: `${personaPrefix}-${key}`,
      trendHistory: data.trendHistory
    };

    if (data.target) {
      config.target = data.target;
    }

    if (data.gmv) {
      config.subtitle = formatGmv(data.gmv) + ' GMV';
    }

    if (data.threshold) {
      config.subtitle = `Threshold: ${data.threshold}`;
    }

    if (data.avgAge) {
      config.subtitle = `Avg age: ${data.avgAge}d`;
    }

    return config;
  });

  return createKpiGrid(kpis, 'kpi-grid kpi-grid--4');
}

/**
 * Format KPI key to title
 */
function formatKpiTitle(key) {
  const titleMap = {
    avgFillRate: 'Avg Fill Rate',
    brandsAtRisk: 'Brands at Risk',
    npiPending: 'NPI Pending',
    escalations: 'Escalations',
    otifRate: 'OTIF Rate',
    moqBlocking: 'MOQ Blocking',
    pendingPos: 'Pending POs',
    contractIssues: 'Contract Issues',
    rackUtilization: 'Rack Utilization',
    inwardingTat: 'Inwarding TAT',
    podsAtRisk: 'Pods at Risk',
    ftrRate: 'FTR Rate',
    forecastAccuracy: 'Forecast Acc',
    dohBreaches: 'DOH Breaches',
    rrGeneration: 'RR Generation',
    movementGaps: 'Movement Gaps',
    grnTat: 'GRN TAT',
    outboundFill: 'Outbound Fill',
    capacityUtil: 'Capacity Util',
    putawayPending: 'Putaway Pending',
    enablementRate: 'Enablement Rate',
    missingVendorCodes: 'Missing Vendor Codes',
    contractSync: 'Contract Sync',
    configErrors: 'Config Errors',
    oosOverrides: 'OOS Overrides',
    staleRules: 'Stale Rules',
    holidayMisconfig: 'Holiday Misconfig',
    crRuleErrors: 'CR Rule Errors'
  };

  return titleMap[key] || key.replace(/([A-Z])/g, ' $1').trim();
}

/**
 * Initialize a KPI trend chart
 * @param {string} kpiId - KPI identifier
 * @param {string} period - Time period ('7d', '30d', '180d')
 */
function initKpiTrendChart(kpiId, period) {
  const canvas = document.getElementById(`kpi-chart-${kpiId}`);
  if (!canvas || typeof Chart === 'undefined') {
    console.warn('KPI Chart: Canvas or Chart.js not found for', kpiId);
    return null;
  }

  const data = window.kpiTrendData[kpiId]?.[period];
  if (!data) {
    console.warn('KPI Chart: No trend data found for', kpiId, period);
    return null;
  }

  // Determine chart color based on trend direction
  const firstVal = data.data[0];
  const lastVal = data.data[data.data.length - 1];
  const isImproving = lastVal >= firstVal;
  const color = isImproving ? '#16a34a' : '#dc2626'; // green or red

  window.kpiCharts[kpiId] = new Chart(canvas, {
    type: 'line',
    data: {
      labels: data.labels,
      datasets: [{
        data: data.data,
        borderColor: color,
        backgroundColor: `${color}20`,
        borderWidth: 2,
        fill: true,
        tension: 0.3,
        pointRadius: 2,
        pointHoverRadius: 4
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          mode: 'index',
          intersect: false,
          displayColors: false,
          callbacks: {
            title: function(context) {
              return context[0].label;
            },
            label: function(context) {
              return context.raw;
            }
          }
        }
      },
      scales: {
        x: {
          grid: {
            display: false
          },
          ticks: {
            maxTicksLimit: 5,
            font: {
              size: 10
            }
          }
        },
        y: {
          beginAtZero: false,
          grid: {
            color: '#e5e7eb'
          },
          ticks: {
            font: {
              size: 10
            }
          }
        }
      },
      interaction: {
        mode: 'nearest',
        axis: 'x',
        intersect: false
      }
    }
  });

  return window.kpiCharts[kpiId];
}

/**
 * Toggle ALL KPI cards expansion at once
 * Global function called from onclick on any KPI card
 */
window.toggleKpiCard = function(kpiId) {
  // Prevent event from firing multiple times
  if (window._kpiToggling) return;
  window._kpiToggling = true;

  // Get all expandable KPI cards
  const allCards = document.querySelectorAll('.kpi-card--expandable');
  if (!allCards.length) {
    window._kpiToggling = false;
    return;
  }

  // Check current state from the clicked card
  const clickedCard = document.querySelector(`[data-kpi-id="${kpiId}"]`);
  const isExpanding = clickedCard && !clickedCard.classList.contains('expanded');

  // Toggle all cards together
  allCards.forEach(card => {
    if (isExpanding) {
      card.classList.add('expanded');
    } else {
      card.classList.remove('expanded');
    }
  });

  // Initialize charts for all expanded cards
  if (isExpanding) {
    setTimeout(() => {
      allCards.forEach(card => {
        const cardKpiId = card.getAttribute('data-kpi-id');
        if (cardKpiId && !window.kpiCharts[cardKpiId] && window.kpiTrendData[cardKpiId]) {
          initKpiTrendChart(cardKpiId, '7d');
        }
      });
    }, 150);
  }

  // Reset toggle flag after animation
  setTimeout(() => {
    window._kpiToggling = false;
  }, 50);
};

/**
 * Update KPI chart for a different time period
 * Global function called from onclick
 */
window.updateKpiChart = function(kpiId, period) {
  const card = document.querySelector(`[data-kpi-id="${kpiId}"]`);
  if (!card) return;

  // Update active button
  card.querySelectorAll('.kpi-card__period-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.period === period);
  });

  // Update chart data
  const data = window.kpiTrendData[kpiId]?.[period];
  if (window.kpiCharts[kpiId] && data) {
    // Update color based on trend direction
    const firstVal = data.data[0];
    const lastVal = data.data[data.data.length - 1];
    const isImproving = lastVal >= firstVal;
    const color = isImproving ? '#16a34a' : '#dc2626';

    window.kpiCharts[kpiId].data.labels = data.labels;
    window.kpiCharts[kpiId].data.datasets[0].data = data.data;
    window.kpiCharts[kpiId].data.datasets[0].borderColor = color;
    window.kpiCharts[kpiId].data.datasets[0].backgroundColor = `${color}20`;
    window.kpiCharts[kpiId].update();
  }
};

/**
 * Clean up KPI charts (call when navigating away)
 */
function destroyKpiCharts() {
  Object.keys(window.kpiCharts).forEach(kpiId => {
    if (window.kpiCharts[kpiId]) {
      window.kpiCharts[kpiId].destroy();
      delete window.kpiCharts[kpiId];
    }
  });
}


// === js/components/alert-card.js ===
/**
 * Alert Card Component
 * Renders an expandable alert card with RCA details
 * Uses data strategy schema exclusively
 */


/**
 * Create an alert card HTML string
 * @param {Object} alert - Alert data object (data strategy schema)
 * @param {boolean} [expanded=false] - Whether card starts expanded
 * @returns {string} HTML string
 */
function createAlertCard(alert, expanded = false) {
  const priorityClass = getPriorityClass(alert.priority);
  const expandedClass = expanded ? 'expanded' : '';

  // Format GMV
  const gmvDisplay = formatGmv(alert.gmv_loss);

  // Build affected items list from affected_skus array
  let affectedItemsHtml = '';
  if (alert.affected_skus && alert.affected_skus.length > 0) {
    affectedItemsHtml = alert.affected_skus
      .map(sku => `<span class="alert-card__affected-item">${sku.sku_name} (${sku.chronic_days}d)</span>`)
      .join('');
    // Add count badge if there are more
    if (alert.affected_sku_count > alert.affected_skus.length) {
      affectedItemsHtml += `<span class="alert-card__affected-item alert-card__affected-item--more">+${alert.affected_sku_count - alert.affected_skus.length} more</span>`;
    }
  } else {
    affectedItemsHtml = '<span class="alert-card__affected-item">No items listed</span>';
  }

  // Build attribution bars from l1_reason_distribution object
  let attributionHtml = '';
  if (alert.l1_reason_distribution && Object.keys(alert.l1_reason_distribution).length > 0) {
    attributionHtml = Object.entries(alert.l1_reason_distribution)
      .map(([reason, pct]) => {
        const percentage = Math.round(pct * 100);
        return `
        <div class="alert-card__attribution-item">
          <span class="alert-card__attribution-label">${reason}</span>
          <div class="alert-card__attribution-bar">
            <div class="alert-card__attribution-fill" style="width: ${percentage}%"></div>
          </div>
          <span class="alert-card__attribution-value">${percentage}%</span>
        </div>
      `;
      })
      .join('');
  } else {
    attributionHtml = '<div class="alert-card__attribution-item">No attribution data</div>';
  }

  // Build actions list from actions array
  const actionsHtml = alert.actions
    .map(action => {
      const actionGmv = formatGmv(action.gmv_at_risk);
      const isCompleted = action.status === 'completed';
      const checkedClass = isCompleted ? 'checked' : '';
      const textClass = isCompleted ? 'text-gray-400 line-through' : '';
      const ownerHtml = action.owner ? `<span class="alert-action__owner">${action.owner}</span>` : '';

      return `
        <div class="alert-action" data-action-id="${action.action_id}">
          <div class="alert-action__checkbox ${checkedClass}" onclick="event.stopPropagation(); toggleAlertAction('${action.action_id}')"></div>
          <div class="alert-action__content">
            <span class="alert-action__text ${textClass}">${action.text}</span>
            ${ownerHtml}
          </div>
          <span class="alert-action__gmv">${actionGmv}</span>
          <div class="alert-action__buttons">
            ${!isCompleted ? `
              <button class="btn btn--primary btn--xs" onclick="event.stopPropagation(); executeAlertAction('${action.action_id}')">Execute</button>
              <button class="btn btn--secondary btn--xs" onclick="event.stopPropagation(); snoozeAlertAction('${action.action_id}')">Snooze</button>
            ` : `
              <span class="badge badge--success">Done</span>
            `}
          </div>
        </div>
      `;
    })
    .join('');

  // LLM disclaimer
  const disclaimerHtml = alert.is_llm_generated
    ? '<div class="alert-card__disclaimer">âš ï¸ LLM generated - verify before action</div>'
    : '';

  // Key metric display
  const keyMetricHtml = alert.key_metric
    ? `<span class="stat-pill stat-pill--metric">
        <span class="stat-pill__value">${alert.key_metric.value}${alert.key_metric.unit}</span>
        <span class="stat-pill__label">${alert.key_metric.label} (target: ${alert.key_metric.target}${alert.key_metric.unit})</span>
       </span>`
    : '';

  return `
    <div class="alert-card ${priorityClass} ${expandedClass}" data-alert-id="${alert.alert_id}">
      <div class="alert-card__header" onclick="toggleAlertCard('${alert.alert_id}')">
        <div class="alert-card__top-row">
          <div class="alert-card__left">
            <span class="alert-card__priority alert-card__priority--${alert.priority.toLowerCase()}">${alert.priority}</span>
            <span class="alert-card__scope">${alert.scope}</span>
            <span class="alert-card__entity">${alert.entity}</span>
          </div>
          <canvas class="alert-card__sparkline" id="sparkline-${alert.alert_id}" width="80" height="24"></canvas>
          <span class="alert-card__expand-icon">â–¼</span>
        </div>
        <div class="alert-card__meta-row">
          <span class="stat-pill">
            <span class="stat-pill__value">${gmvDisplay}</span>
            <span class="stat-pill__label">GMV</span>
          </span>
          <span class="stat-pill">
            <span class="stat-pill__value">${alert.chronic_days_avg}</span>
            <span class="stat-pill__label">days</span>
          </span>
          <span class="stat-pill">
            <span class="stat-pill__value">${alert.impact_scope.count}</span>
            <span class="stat-pill__label">${alert.impact_scope.unit} (${alert.impact_scope.percentage}%)</span>
          </span>
          ${keyMetricHtml}
        </div>
      </div>
      <div class="alert-card__details">
        <div class="alert-card__details-content">
          <!-- Top row: Affected Items + Attribution side by side -->
          <div class="alert-card__details-row">
            <div class="alert-card__section alert-card__section--items">
              <div class="alert-card__section-header">Affected Items</div>
              <div class="alert-card__affected-list">
                ${affectedItemsHtml}
              </div>
            </div>
            <div class="alert-card__section alert-card__section--attribution">
              <div class="alert-card__section-header">Attribution</div>
              <div class="alert-card__attribution">
                ${attributionHtml}
              </div>
            </div>
          </div>

          <!-- RCA section - full width with accent -->
          <div class="alert-card__section alert-card__section--rca">
            <div class="alert-card__section-header">
              <span>ðŸ”</span> Root Cause Analysis
            </div>
            <div class="alert-card__rca">
              ${alert.l3_narrative}
            </div>
          </div>

          <!-- Actions section - full width with accent -->
          <div class="alert-card__section alert-card__section--actions">
            <div class="alert-card__section-header">
              <span>âš¡</span> Recommended Actions
            </div>
            <div class="alert-card__actions-list">
              ${actionsHtml}
            </div>
          </div>

          ${disclaimerHtml}
        </div>
      </div>
    </div>
  `;
}

/**
 * Create a list of alert cards
 * @param {Array} alerts - Array of alert objects
 * @param {number} [limit] - Maximum number of cards to show
 * @returns {string} HTML string
 */
function createAlertList(alerts, limit) {
  const displayAlerts = limit ? alerts.slice(0, limit) : alerts;
  const cardsHtml = displayAlerts.map(alert => createAlertCard(alert)).join('');

  return `
    <div class="alert-list">
      ${cardsHtml}
    </div>
  `;
}

/**
 * Create alert list with header
 * @param {Array} alerts - Array of alert objects
 * @param {string} title - Section title
 * @param {number} [limit=5] - Maximum alerts to show
 * @returns {string} HTML string
 */
function createAlertSection(alerts, title, limit = 5) {
  const displayAlerts = alerts.slice(0, limit);

  return `
    <div class="alert-section">
      <div class="alert-list__header">
        <h3 class="alert-list__title">${title}</h3>
        <span class="alert-list__count">${alerts.length} total alerts</span>
      </div>
      ${createAlertList(displayAlerts)}
    </div>
  `;
}

/**
 * Toggle alert card expansion
 * Global function called from onclick
 * @param {string} alertId - The alert_id from data strategy schema
 */
window.toggleAlertCard = function(alertId) {
  const card = document.querySelector(`[data-alert-id="${alertId}"]`);
  if (card) {
    card.classList.toggle('expanded');
  }
};

/**
 * Toggle alert action completion state
 * Global function called from onclick
 */
window.toggleAlertAction = function(actionId) {
  const action = document.querySelector(`[data-action-id="${actionId}"]`);
  if (action) {
    const checkbox = action.querySelector('.alert-action__checkbox');
    const text = action.querySelector('.alert-action__text');
    const buttonsDiv = action.querySelector('.alert-action__buttons');

    checkbox.classList.toggle('checked');

    if (checkbox.classList.contains('checked')) {
      text.classList.add('text-gray-400', 'line-through');
      buttonsDiv.innerHTML = '<span class="badge badge--success">Done</span>';
    } else {
      text.classList.remove('text-gray-400', 'line-through');
      buttonsDiv.innerHTML = `
        <button class="btn btn--primary btn--xs" onclick="event.stopPropagation(); executeAlertAction('${actionId}')">Execute</button>
        <button class="btn btn--secondary btn--xs" onclick="event.stopPropagation(); snoozeAlertAction('${actionId}')">Snooze</button>
      `;
    }
  }
};

/**
 * Execute alert action
 * Global function called from onclick
 */
window.executeAlertAction = function(actionId) {
  alert(`Executing action ${actionId}...\n\nIn production, this would trigger the corresponding workflow.`);
  window.toggleAlertAction(actionId);
};

/**
 * Snooze alert action
 * Global function called from onclick
 */
window.snoozeAlertAction = function(actionId) {
  const action = document.querySelector(`[data-action-id="${actionId}"]`);
  if (action) {
    action.style.opacity = '0.5';
    setTimeout(() => {
      action.style.opacity = '1';
    }, 2000);
  }
  alert(`Action ${actionId} snoozed for 24 hours.\n\nIn production, this would reschedule the reminder.`);
};

/**
 * Initialize sparklines for all alert cards
 * Should be called after alerts are rendered
 */
function initAlertSparklines(alerts) {
  alerts.forEach(alert => {
    const canvas = document.getElementById(`sparkline-${alert.alert_id}`);
    if (canvas && alert.trend) {
      const color = alert.priority === 'P0' ? '#dc2626' :
                    alert.priority === 'P1' ? '#ea580c' : '#ca8a04';
      drawSparkline(canvas, alert.trend, color);
    }
  });
}


// === js/components/table.js ===
/**
 * Table Component
 * Renders accountability tables and other data tables
 */


/**
 * Create an accountability table
 * @param {Array} data - Array of row objects
 * @param {string} [title] - Optional table title
 * @returns {string} HTML string
 */
function createAccountabilityTable(data, title = 'Accountability by Owner') {
  const rowsHtml = data.map(row => {
    const gmvDisplay = formatGmv(row.gmvAtRisk);
    const statusBadge = `<span class="badge ${getStatusClass(row.status)}">${row.status}</span>`;

    return `
      <tr>
        <td>
          <div class="data-table__owner">
            <span class="data-table__owner-icon">${row.icon}</span>
            <span class="data-table__owner-name">${row.owner}</span>
          </div>
        </td>
        <td class="text-center">${row.alertCount}</td>
        <td class="data-table__gmv">${gmvDisplay}</td>
        <td class="data-table__issue" title="${row.topIssue}">${row.topIssue}</td>
        <td>${statusBadge}</td>
        <td>
          <a href="${row.dashboardLink}" class="btn btn--link">View â†’</a>
        </td>
      </tr>
    `;
  }).join('');

  return `
    <div class="card">
      <div class="card__header">
        <h3 class="card__title">${title}</h3>
      </div>
      <div class="data-table">
        <div class="data-table__wrapper">
          <table>
            <thead>
              <tr>
                <th>Owner</th>
                <th class="text-center">Alerts</th>
                <th>GMV at Risk</th>
                <th>Top Issue</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              ${rowsHtml}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  `;
}

/**
 * Create a top alerts summary table
 * @param {Array} alerts - Array of top alert objects
 * @param {string} [title] - Optional table title
 * @returns {string} HTML string
 */
function createTopAlertsTable(alerts, title = 'Top 5 P0 Alerts') {
  const rowsHtml = alerts.map(alert => {
    const gmvDisplay = formatGmv(alert.gmv_loss);

    return `
      <tr>
        <td class="top-alerts-table__rank">#${alert.rank}</td>
        <td>
          <span class="badge badge--neutral">${alert.scope}</span>
        </td>
        <td class="top-alerts-table__entity">${alert.entity}</td>
        <td>${alert.owner}</td>
        <td class="top-alerts-table__gmv">${gmvDisplay}</td>
        <td>${alert.chronic_days_avg}d</td>
        <td class="data-table__issue" title="${alert.l3_narrative}">${alert.l3_narrative}</td>
      </tr>
    `;
  }).join('');

  return `
    <div class="card">
      <div class="card__header">
        <h3 class="card__title">${title}</h3>
      </div>
      <div class="data-table">
        <div class="data-table__wrapper">
          <table class="top-alerts-table">
            <thead>
              <tr>
                <th>Rank</th>
                <th>Scope</th>
                <th>Entity</th>
                <th>Owner</th>
                <th>GMV</th>
                <th>Age</th>
                <th>Root Cause</th>
              </tr>
            </thead>
            <tbody>
              ${rowsHtml}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  `;
}

/**
 * Create a generic data table
 * @param {Object} options - Table options
 * @param {Array} options.columns - Column definitions [{key, label, align, format}]
 * @param {Array} options.data - Row data
 * @param {string} [options.title] - Table title
 * @returns {string} HTML string
 */
function createDataTable({ columns, data, title }) {
  // Build header
  const headerHtml = columns.map(col =>
    `<th class="${col.align === 'center' ? 'text-center' : col.align === 'right' ? 'text-right' : ''}">${col.label}</th>`
  ).join('');

  // Build rows
  const rowsHtml = data.map(row => {
    const cellsHtml = columns.map(col => {
      let value = row[col.key];

      // Apply format if specified
      if (col.format === 'gmv') {
        value = formatGmv(value);
      } else if (col.format === 'percentage') {
        value = `${value}%`;
      } else if (col.format === 'badge' && col.badgeKey) {
        const status = row[col.badgeKey];
        value = `<span class="badge ${getStatusClass(status)}">${value}</span>`;
      }

      const alignClass = col.align === 'center' ? 'text-center' :
                         col.align === 'right' ? 'text-right' : '';

      return `<td class="${alignClass}">${value}</td>`;
    }).join('');

    return `<tr>${cellsHtml}</tr>`;
  }).join('');

  const titleHtml = title ? `
    <div class="card__header">
      <h3 class="card__title">${title}</h3>
    </div>
  ` : '';

  return `
    <div class="card">
      ${titleHtml}
      <div class="data-table">
        <div class="data-table__wrapper">
          <table>
            <thead>
              <tr>${headerHtml}</tr>
            </thead>
            <tbody>
              ${rowsHtml}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  `;
}

/**
 * Create a simple stats table (2 columns: label, value)
 * @param {Array} stats - Array of {label, value} objects
 * @param {string} [title] - Optional title
 * @returns {string} HTML string
 */
function createStatsTable(stats, title) {
  const rowsHtml = stats.map(stat => `
    <tr>
      <td class="text-gray-600">${stat.label}</td>
      <td class="text-right font-semibold">${stat.value}</td>
    </tr>
  `).join('');

  const titleHtml = title ? `
    <div class="card__header">
      <h3 class="card__title">${title}</h3>
    </div>
  ` : '';

  return `
    <div class="card">
      ${titleHtml}
      <div class="data-table">
        <table>
          <tbody>
            ${rowsHtml}
          </tbody>
        </table>
      </div>
    </div>
  `;
}


// === js/components/actionable.js ===
/**
 * Actionable Component
 * Renders actionable items with checkboxes and action buttons
 */


/**
 * Create a single actionable item
 * @param {Object} item - Actionable item data
 * @param {number} item.id - Item ID
 * @param {string} item.action - Action description
 * @param {number} item.gmv - GMV impact
 * @param {boolean} item.completed - Whether item is completed
 * @returns {string} HTML string
 */
function createActionableItem(item) {
  const gmvDisplay = formatGmv(item.gmv);
  const checkedClass = item.completed ? 'checked' : '';
  const textClass = item.completed ? 'text-gray-400' : '';
  const strikeClass = item.completed ? 'style="text-decoration: line-through;"' : '';

  return `
    <div class="actionable-item" data-actionable-id="${item.id}">
      <div class="actionable-item__checkbox ${checkedClass}" onclick="toggleActionable(${item.id})"></div>
      <span class="actionable-item__text ${textClass}" ${strikeClass}>${item.action}</span>
      <span class="actionable-item__gmv">${gmvDisplay}</span>
      <div class="actionable-item__actions">
        ${!item.completed ? `
          <button class="btn btn--primary btn--sm" onclick="executeActionable(${item.id})">Execute</button>
          <button class="btn btn--secondary btn--sm" onclick="snoozeActionable(${item.id})">Snooze</button>
        ` : `
          <span class="badge badge--success">Done</span>
        `}
      </div>
    </div>
  `;
}

/**
 * Create an actionables list
 * @param {Array} items - Array of actionable items
 * @param {boolean} [showDisclaimer=true] - Whether to show LLM disclaimer
 * @returns {string} HTML string
 */
function createActionablesList(items, showDisclaimer = true) {
  const itemsHtml = items.map(item => createActionableItem(item)).join('');

  const disclaimerHtml = showDisclaimer ? `
    <div class="actionable-list__disclaimer">
      <span>âš ï¸</span>
      <span>LLM generated recommendations - please verify before executing</span>
    </div>
  ` : '';

  return `
    <div class="actionables-list">
      ${itemsHtml}
    </div>
    ${disclaimerHtml}
  `;
}

/**
 * Create an actionables section with header
 * @param {Array} items - Array of actionable items
 * @param {string} [title='Top Actionables'] - Section title
 * @returns {string} HTML string
 */
function createActionablesSection(items, title = 'Top Actionables') {
  const pendingCount = items.filter(i => !i.completed).length;
  const totalGmv = items.filter(i => !i.completed).reduce((sum, i) => sum + i.gmv, 0);

  return `
    <div class="actionables-section">
      <div class="actionables-section__header">
        <h3 class="actionables-section__title">${title}</h3>
        <span class="text-sm text-gray-500">
          ${pendingCount} pending Â· ${formatGmv(totalGmv)} GMV impact
        </span>
      </div>
      ${createActionablesList(items)}
    </div>
  `;
}

/**
 * Toggle actionable completion state
 * Global function called from onclick
 */
window.toggleActionable = function(id) {
  const item = document.querySelector(`[data-actionable-id="${id}"]`);
  if (item) {
    const checkbox = item.querySelector('.actionable-item__checkbox');
    const text = item.querySelector('.actionable-item__text');
    const actionsDiv = item.querySelector('.actionable-item__actions');

    checkbox.classList.toggle('checked');

    if (checkbox.classList.contains('checked')) {
      text.classList.add('text-gray-400');
      text.style.textDecoration = 'line-through';
      actionsDiv.innerHTML = '<span class="badge badge--success">Done</span>';
    } else {
      text.classList.remove('text-gray-400');
      text.style.textDecoration = 'none';
      actionsDiv.innerHTML = `
        <button class="btn btn--primary btn--sm" onclick="executeActionable(${id})">Execute</button>
        <button class="btn btn--secondary btn--sm" onclick="snoozeActionable(${id})">Snooze</button>
      `;
    }
  }
};

/**
 * Execute actionable (mock implementation)
 * Global function called from onclick
 */
window.executeActionable = function(id) {
  // In a real implementation, this would trigger the action
  alert(`Executing action #${id}...\n\nIn production, this would trigger the corresponding workflow.`);

  // Mark as completed
  window.toggleActionable(id);
};

/**
 * Snooze actionable (mock implementation)
 * Global function called from onclick
 */
window.snoozeActionable = function(id) {
  // In a real implementation, this would snooze for a period
  const item = document.querySelector(`[data-actionable-id="${id}"]`);
  if (item) {
    item.style.opacity = '0.5';
    setTimeout(() => {
      item.style.opacity = '1';
    }, 2000);
  }

  alert(`Action #${id} snoozed for 24 hours.\n\nIn production, this would reschedule the reminder.`);
};

/**
 * Create a quick actions panel
 * @param {Array} actions - Array of quick action buttons
 * @returns {string} HTML string
 */
function createQuickActionsPanel(actions) {
  const buttonsHtml = actions.map(action => `
    <button class="btn btn--secondary" onclick="${action.onclick || ''}">
      ${action.icon ? `<span>${action.icon}</span>` : ''}
      ${action.label}
    </button>
  `).join('');

  return `
    <div class="card">
      <div class="card__header">
        <h3 class="card__title">Quick Actions</h3>
      </div>
      <div class="card__body">
        <div class="flex flex-wrap gap-2">
          ${buttonsHtml}
        </div>
      </div>
    </div>
  `;
}


// === js/components/kpi-tree.js ===
/**
 * KPI Tree Component
 * Renders a compact hierarchical tree of KPIs with dependencies, owners, and WoW comparison
 */


/**
 * Build KPI Tree from mock data
 * Structure: Availability â†’ Personas (by GMV contribution) â†’ Persona KPIs
 */
function buildKpiTreeData() {
  const { summary, gmvByOwner, categoryManagement, procurement, podOps, planning, warehouse, erpTeam, productSupport } = mockData;

  // Calculate total GMV to derive percentages
  const totalGmv = gmvByOwner.reduce((sum, o) => sum + o.gmv, 0);

  // Helper to get GMV % for a persona
  const getGmvPct = (ownerName) => {
    const owner = gmvByOwner.find(o => o.owner === ownerName);
    return owner ? Math.round((owner.gmv / totalGmv) * 100) : 0;
  };

  return {
    id: 'availability',
    name: 'Availability',
    value: summary.availability,
    target: summary.target,
    unit: '%',
    owner: 'Executive',
    ownerIcon: 'ðŸ“Š',
    wow: summary.sdlwComparison.chronicSkus > 0 ? -0.3 : +0.2,
    wowBad: true,
    children: [
      {
        id: 'category-branch',
        name: categoryManagement.persona.name,
        value: getGmvPct('Category Management'),
        unit: '%',
        owner: 'Category',
        ownerIcon: categoryManagement.persona.icon,
        wow: categoryManagement.kpis.avgFillRate.trend,
        wowBad: categoryManagement.kpis.avgFillRate.trend < 0,
        isTop: getGmvPct('Category Management') >= 30,
        link: '#/category',
        children: [
          { id: 'fill-rate', name: 'Avg Fill Rate', value: categoryManagement.kpis.avgFillRate.value, target: categoryManagement.kpis.avgFillRate.target, unit: '%', owner: 'Category', ownerIcon: categoryManagement.persona.icon, wow: categoryManagement.kpis.avgFillRate.trend, wowBad: categoryManagement.kpis.avgFillRate.trend < 0, isTop: true },
          { id: 'brands-risk', name: 'Brands at Risk', value: categoryManagement.kpis.brandsAtRisk.value, unit: '', owner: 'Category', ownerIcon: categoryManagement.persona.icon, wow: categoryManagement.kpis.brandsAtRisk.trend, wowBad: categoryManagement.kpis.brandsAtRisk.trend > 0 },
          { id: 'npi-pending', name: 'NPI Pending', value: categoryManagement.kpis.npiPending.value, target: categoryManagement.kpis.npiPending.threshold, unit: '', owner: 'Category', ownerIcon: categoryManagement.persona.icon, wow: categoryManagement.kpis.npiPending.trend, wowBad: categoryManagement.kpis.npiPending.trend > 0 },
          { id: 'escalations', name: 'Escalations', value: categoryManagement.kpis.escalations.value, unit: '', owner: 'Category', ownerIcon: categoryManagement.persona.icon, wow: categoryManagement.kpis.escalations.trend, wowBad: categoryManagement.kpis.escalations.trend > 0 }
        ]
      },
      {
        id: 'procurement-branch',
        name: procurement.persona.name,
        value: getGmvPct('Procurement'),
        unit: '%',
        owner: 'Procurement',
        ownerIcon: procurement.persona.icon,
        wow: procurement.kpis.otifRate.trend,
        wowBad: procurement.kpis.otifRate.trend < 0,
        isTop: getGmvPct('Procurement') >= 20,
        link: '#/procurement',
        children: [
          { id: 'otif', name: 'OTIF Rate', value: procurement.kpis.otifRate.value, target: procurement.kpis.otifRate.target, unit: '%', owner: 'Procurement', ownerIcon: procurement.persona.icon, wow: procurement.kpis.otifRate.trend, wowBad: procurement.kpis.otifRate.trend < 0 },
          { id: 'moq', name: 'MOQ Blocking', value: procurement.kpis.moqBlocking.value, unit: '%', owner: 'Procurement', ownerIcon: procurement.persona.icon, wow: procurement.kpis.moqBlocking.trend, wowBad: procurement.kpis.moqBlocking.trend > 0 },
          { id: 'pending-po', name: 'Pending POs', value: procurement.kpis.pendingPos.value, unit: '', owner: 'Procurement', ownerIcon: procurement.persona.icon, wow: procurement.kpis.pendingPos.trend, wowBad: procurement.kpis.pendingPos.trend > 0 },
          { id: 'contract-issues', name: 'Contract Issues', value: procurement.kpis.contractIssues.value, unit: '', owner: 'Procurement', ownerIcon: procurement.persona.icon, wow: procurement.kpis.contractIssues.trend, wowBad: procurement.kpis.contractIssues.trend > 0 }
        ]
      },
      {
        id: 'podops-branch',
        name: podOps.persona.name,
        value: getGmvPct('Pod Ops'),
        unit: '%',
        owner: 'Pod Ops',
        ownerIcon: podOps.persona.icon,
        wow: podOps.kpis.rackUtilization.trend,
        wowBad: podOps.kpis.rackUtilization.trend > 0,
        isTop: getGmvPct('Pod Ops') >= 15,
        link: '#/pod-ops',
        children: [
          { id: 'rack', name: 'Rack Utilization', value: podOps.kpis.rackUtilization.value, target: podOps.kpis.rackUtilization.target, unit: '%', owner: 'Pod Ops', ownerIcon: podOps.persona.icon, wow: podOps.kpis.rackUtilization.trend, wowBad: podOps.kpis.rackUtilization.trend > 0 },
          { id: 'inward', name: 'Inwarding TAT', value: podOps.kpis.inwardingTat.value, target: podOps.kpis.inwardingTat.target, unit: 'h', owner: 'Pod Ops', ownerIcon: podOps.persona.icon, wow: podOps.kpis.inwardingTat.trend, wowBad: podOps.kpis.inwardingTat.trend > 0 },
          { id: 'pods-risk', name: 'Pods at Risk', value: podOps.kpis.podsAtRisk.value, unit: '', owner: 'Pod Ops', ownerIcon: podOps.persona.icon, wow: podOps.kpis.podsAtRisk.trend, wowBad: podOps.kpis.podsAtRisk.trend > 0 },
          { id: 'ftr', name: 'FTR Rate', value: podOps.kpis.ftrRate.value, target: podOps.kpis.ftrRate.target, unit: '%', owner: 'Pod Ops', ownerIcon: podOps.persona.icon, wow: podOps.kpis.ftrRate.trend, wowBad: podOps.kpis.ftrRate.trend < 0 }
        ]
      },
      {
        id: 'planning-branch',
        name: planning.persona.name,
        value: getGmvPct('Planning'),
        unit: '%',
        owner: 'Planning',
        ownerIcon: planning.persona.icon,
        wow: planning.kpis.forecastAccuracy.trend,
        wowBad: planning.kpis.forecastAccuracy.trend < 0,
        link: '#/planning',
        children: [
          { id: 'wmape', name: 'Forecast Acc (wMAPE)', value: planning.kpis.forecastAccuracy.value, target: planning.kpis.forecastAccuracy.target, unit: '%', owner: 'Planning', ownerIcon: planning.persona.icon, wow: planning.kpis.forecastAccuracy.trend, wowBad: planning.kpis.forecastAccuracy.trend < 0 },
          { id: 'doh', name: 'DOH Breaches', value: planning.kpis.dohBreaches.value, target: planning.kpis.dohBreaches.threshold, unit: '', owner: 'Planning', ownerIcon: planning.persona.icon, wow: planning.kpis.dohBreaches.trend, wowBad: planning.kpis.dohBreaches.trend > 0 },
          { id: 'rr-gen', name: 'RR Generation', value: planning.kpis.rrGeneration.value, target: planning.kpis.rrGeneration.target, unit: '%', owner: 'Planning', ownerIcon: planning.persona.icon, wow: planning.kpis.rrGeneration.trend, wowBad: planning.kpis.rrGeneration.trend < 0 },
          { id: 'movement', name: 'Movement Gaps', value: planning.kpis.movementGaps.value, unit: '', owner: 'Planning', ownerIcon: planning.persona.icon, wow: planning.kpis.movementGaps.trend, wowBad: planning.kpis.movementGaps.trend > 0 }
        ]
      },
      {
        id: 'warehouse-branch',
        name: warehouse.persona.name,
        value: getGmvPct('Warehouse'),
        unit: '%',
        owner: 'Warehouse',
        ownerIcon: warehouse.persona.icon,
        wow: warehouse.kpis.grnTat.trend,
        wowBad: warehouse.kpis.grnTat.trend > 0,
        link: '#/warehouse',
        children: [
          { id: 'grn', name: 'GRN TAT', value: warehouse.kpis.grnTat.value, target: warehouse.kpis.grnTat.target, unit: 'h', owner: 'Warehouse', ownerIcon: warehouse.persona.icon, wow: warehouse.kpis.grnTat.trend, wowBad: warehouse.kpis.grnTat.trend > 0 },
          { id: 'outbound', name: 'Outbound Fill', value: warehouse.kpis.outboundFill.value, target: warehouse.kpis.outboundFill.target, unit: '%', owner: 'Warehouse', ownerIcon: warehouse.persona.icon, wow: warehouse.kpis.outboundFill.trend, wowBad: warehouse.kpis.outboundFill.trend < 0 },
          { id: 'wh-cap', name: 'Capacity Util', value: warehouse.kpis.capacityUtil.value, target: warehouse.kpis.capacityUtil.target, unit: '%', owner: 'Warehouse', ownerIcon: warehouse.persona.icon, wow: warehouse.kpis.capacityUtil.trend, wowBad: warehouse.kpis.capacityUtil.trend > 0 },
          { id: 'putaway', name: 'Putaway Pending', value: warehouse.kpis.putawayPending.value, unit: '', owner: 'Warehouse', ownerIcon: warehouse.persona.icon, wow: warehouse.kpis.putawayPending.trend, wowBad: warehouse.kpis.putawayPending.trend > 0 }
        ]
      },
      {
        id: 'erp-branch',
        name: erpTeam.persona.name,
        value: getGmvPct('ERP Team'),
        unit: '%',
        owner: 'ERP Team',
        ownerIcon: erpTeam.persona.icon,
        wow: erpTeam.kpis.enablementRate.trend,
        wowBad: erpTeam.kpis.enablementRate.trend < 0,
        link: '#/erp-team',
        children: [
          { id: 'enable', name: 'Enablement Rate', value: erpTeam.kpis.enablementRate.value, target: erpTeam.kpis.enablementRate.target, unit: '%', owner: 'ERP', ownerIcon: erpTeam.persona.icon, wow: erpTeam.kpis.enablementRate.trend, wowBad: erpTeam.kpis.enablementRate.trend < 0 },
          { id: 'vendor-codes', name: 'Missing Vendor Codes', value: erpTeam.kpis.missingVendorCodes.value, target: erpTeam.kpis.missingVendorCodes.threshold, unit: '', owner: 'ERP', ownerIcon: erpTeam.persona.icon, wow: erpTeam.kpis.missingVendorCodes.trend, wowBad: erpTeam.kpis.missingVendorCodes.trend > 0 },
          { id: 'contract-sync', name: 'Contract Sync', value: erpTeam.kpis.contractSync.value, target: erpTeam.kpis.contractSync.target, unit: '%', owner: 'ERP', ownerIcon: erpTeam.persona.icon, wow: erpTeam.kpis.contractSync.trend, wowBad: erpTeam.kpis.contractSync.trend < 0 },
          { id: 'config-err', name: 'Config Errors', value: erpTeam.kpis.configErrors.value, unit: '', owner: 'ERP', ownerIcon: erpTeam.persona.icon, wow: erpTeam.kpis.configErrors.trend, wowBad: erpTeam.kpis.configErrors.trend > 0 }
        ]
      },
      {
        id: 'product-branch',
        name: productSupport.persona.name,
        value: getGmvPct('Product Support'),
        unit: '%',
        owner: 'Product Support',
        ownerIcon: productSupport.persona.icon,
        wow: productSupport.kpis.staleRules.trend,
        wowBad: productSupport.kpis.staleRules.trend > 0,
        link: '#/product-support',
        children: [
          { id: 'oos-override', name: 'OOS Overrides', value: productSupport.kpis.oosOverrides.value, target: productSupport.kpis.oosOverrides.threshold, unit: '', owner: 'Product', ownerIcon: productSupport.persona.icon, wow: productSupport.kpis.oosOverrides.trend, wowBad: productSupport.kpis.oosOverrides.trend > 0 },
          { id: 'stale', name: 'Stale Rules', value: productSupport.kpis.staleRules.value, target: productSupport.kpis.staleRules.threshold, unit: '', owner: 'Product', ownerIcon: productSupport.persona.icon, wow: productSupport.kpis.staleRules.trend, wowBad: productSupport.kpis.staleRules.trend > 0 },
          { id: 'holiday', name: 'Holiday Misconfig', value: productSupport.kpis.holidayMisconfig.value, target: productSupport.kpis.holidayMisconfig.threshold, unit: '', owner: 'Product', ownerIcon: productSupport.persona.icon, wow: productSupport.kpis.holidayMisconfig.trend, wowBad: productSupport.kpis.holidayMisconfig.trend > 0 },
          { id: 'cr-rules', name: 'CR Rule Errors', value: productSupport.kpis.crRuleErrors.value, target: productSupport.kpis.crRuleErrors.threshold, unit: '', owner: 'Product', ownerIcon: productSupport.persona.icon, wow: productSupport.kpis.crRuleErrors.trend, wowBad: productSupport.kpis.crRuleErrors.trend > 0 }
        ]
      }
    ]
  };
}

/**
 * Get status class based on value vs target
 */
function getStatus(node) {
  if (!node.target) return '';
  const ratio = node.value / node.target;

  // IDs where higher is better
  const higherIsBetter = ['fill-rate', 'otif', 'wmape', 'ftr', 'outbound', 'enable', 'contract-sync', 'rr-gen'];

  if (higherIsBetter.includes(node.id)) {
    if (ratio >= 1) return 'good';
    if (ratio >= 0.85) return 'warn';
    return 'bad';
  }
  // Lower is better
  if (ratio <= 1) return 'good';
  if (ratio <= 1.5) return 'warn';
  return 'bad';
}

/**
 * Render a leaf node (no children)
 */
function renderLeaf(node) {
  const status = getStatus(node);
  const wowClass = node.wowBad ? 'bad' : 'good';
  const wowText = node.wow === 0 ? 'â€”' : (node.wow > 0 ? `+${node.wow}` : node.wow);
  const targetText = node.target ? `/${node.target}` : '';

  return `
    <div class="ktree-leaf ${node.isTop ? 'ktree-leaf--top' : ''}" title="${node.name}">
      <span class="ktree-leaf__name">${node.name}</span>
      <span class="ktree-leaf__value ktree-leaf__value--${status}">${node.value}${targetText}${node.unit}</span>
      <span class="ktree-leaf__wow ktree-leaf__wow--${wowClass}">${wowText}</span>
    </div>
  `;
}

/**
 * Render a branch node (has children)
 */
function renderBranch(node, isRoot = false) {
  const hasChildren = node.children && node.children.length > 0;
  const wowClass = node.wowBad ? 'bad' : 'good';
  const wowText = node.wow === 0 ? 'â€”' : (node.wow > 0 ? `+${node.wow}` : node.wow);

  const childrenHtml = hasChildren
    ? node.children.map(child =>
        child.children ? renderBranch(child) : renderLeaf(child)
      ).join('')
    : '';

  if (isRoot) {
    return `
      <div class="ktree-root">
        <div class="ktree-root__node">
          <div class="ktree-root__main">
            <span class="ktree-root__name">${node.name}</span>
            <span class="ktree-root__value">${node.value}${node.unit}</span>
            <span class="ktree-root__target">target: ${node.target}${node.unit}</span>
          </div>
          <div class="ktree-root__meta">
            <span class="ktree-root__wow ktree-leaf__wow--${wowClass}">${wowText} WoW</span>
          </div>
        </div>
        <div class="ktree-branches">
          ${node.children.map(child => renderBranch(child)).join('')}
        </div>
      </div>
    `;
  }

  const linkHtml = node.link ? `<a href="${node.link}" class="ktree-branch__link" title="Go to dashboard">â†’</a>` : '';

  return `
    <div class="ktree-branch ${node.isTop ? 'ktree-branch--top' : ''}" data-branch="${node.id}">
      <div class="ktree-branch__header" onclick="toggleKpiBranch('${node.id}')">
        <span class="ktree-branch__toggle">â–¶</span>
        <span class="ktree-branch__name">${node.name}</span>
        <span class="ktree-branch__pct">${node.value}%</span>
        <span class="ktree-branch__wow ktree-leaf__wow--${wowClass}">${wowText}</span>
        <span class="ktree-branch__owner">${node.ownerIcon} ${node.owner}</span>
        ${node.isTop ? '<span class="ktree-branch__top">TOP</span>' : ''}
        ${linkHtml}
      </div>
      <div class="ktree-branch__children">
        ${childrenHtml}
      </div>
    </div>
  `;
}

/**
 * Create the full KPI tree component
 */
function createKpiTree(title = 'KPI Dependency Tree') {
  const kpiTreeData = buildKpiTreeData();
  const treeHtml = renderBranch(kpiTreeData, true);

  return `
    <div class="card ktree-card">
      <div class="card__header">
        <h3 class="card__title">${title}</h3>
        <div class="ktree-legend">
          <span class="ktree-legend__item"><span class="ktree-legend__dot ktree-legend__dot--good"></span>On Track</span>
          <span class="ktree-legend__item"><span class="ktree-legend__dot ktree-legend__dot--warn"></span>At Risk</span>
          <span class="ktree-legend__item"><span class="ktree-legend__dot ktree-legend__dot--bad"></span>Critical</span>
          <span class="ktree-legend__item ktree-legend__item--wow">WoW = Week over Week</span>
        </div>
      </div>
      <div class="card__body ktree-body">
        ${treeHtml}
      </div>
    </div>
  `;
}

/**
 * Toggle branch expansion
 */
window.toggleKpiBranch = function(branchId) {
  const branch = document.querySelector(`[data-branch="${branchId}"]`);
  if (branch) {
    branch.classList.toggle('expanded');
  }
};


// === js/components/dropdown.js ===
/**
 * Custom Dropdown Component
 * Native HTML dropdown with consistent styling across all browsers
 */

/**
 * Create a custom dropdown
 * @param {Object} options - Dropdown options
 * @param {string} options.id - Unique identifier
 * @param {string} options.placeholder - Default text when nothing selected
 * @param {Array} options.items - Array of {value, label} objects
 * @returns {string} HTML string
 */
window.createDropdown = function({ id, placeholder, items }) {
  const optionsHtml = items.map(item => `
    <div class="dropdown__item" data-value="${item.value}" onclick="selectDropdownItem('${id}', '${item.value}', '${item.label}')">
      ${item.label}
    </div>
  `).join('');

  return `
    <div class="dropdown" data-dropdown-id="${id}">
      <button class="dropdown__trigger" onclick="toggleDropdown('${id}')">
        <span class="dropdown__value">${placeholder}</span>
        <span class="dropdown__arrow">â–¼</span>
      </button>
      <div class="dropdown__menu">
        ${optionsHtml}
      </div>
    </div>
  `;
}

/**
 * Create filter bar with dropdowns
 * @param {Array} filters - Array of filter configs
 * @returns {string} HTML string
 */
window.createFilterBar = function(filters) {
  const dropdownsHtml = filters.map((filter, index) =>
    window.createDropdown({
      id: `filter-${index}`,
      placeholder: filter.placeholder,
      items: filter.items
    })
  ).join('');

  return `
    <div class="filter-bar">
      <span class="filter-bar__label">Filter by:</span>
      ${dropdownsHtml}
    </div>
  `;
}

// Global dropdown functions
window.toggleDropdown = function(id) {
  const dropdown = document.querySelector(`[data-dropdown-id="${id}"]`);
  if (!dropdown) return;

  // Close all other dropdowns
  document.querySelectorAll('.dropdown.open').forEach(d => {
    if (d.getAttribute('data-dropdown-id') !== id) {
      d.classList.remove('open');
    }
  });

  dropdown.classList.toggle('open');
};

window.selectDropdownItem = function(id, value, label) {
  const dropdown = document.querySelector(`[data-dropdown-id="${id}"]`);
  if (!dropdown) return;

  const valueEl = dropdown.querySelector('.dropdown__value');
  if (valueEl) {
    valueEl.textContent = label;
    valueEl.classList.toggle('dropdown__value--selected', value !== '');
  }

  // Mark selected item
  dropdown.querySelectorAll('.dropdown__item').forEach(item => {
    item.classList.toggle('selected', item.getAttribute('data-value') === value);
  });

  dropdown.classList.remove('open');

  // Dispatch custom event for filtering logic
  dropdown.dispatchEvent(new CustomEvent('change', { detail: { value, label } }));
};

// Close dropdowns when clicking outside
document.addEventListener('click', function(e) {
  if (!e.target.closest('.dropdown')) {
    document.querySelectorAll('.dropdown.open').forEach(d => d.classList.remove('open'));
  }
});

// Export for module imports
const createDropdown = window.createDropdown;
const createFilterBar = window.createFilterBar;


// === js/pages/executive.js ===
/**
 * Executive Dashboard Page
 * Main overview dashboard with KPIs, charts, and accountability table
 */

// Charts removed for minimal view - KPI Tree and Accountability Table cover the same data

/**
 * Create the actionable completion widget
 * @param {Object} data - Completion data from mockData
 * @param {Object} config - Widget labels from config
 * @returns {string} HTML string
 */
function createCompletionWidget(data, config) {
  const overallPercentage = data.overall;
  const circumference = 2 * Math.PI * 50; // radius = 50
  const dashOffset = circumference - (circumference * overallPercentage / 100);

  // Determine status color
  let statusClass = 'good';
  if (overallPercentage < 50) statusClass = 'critical';
  else if (overallPercentage < 70) statusClass = 'warning';

  // Build team items
  const teamItemsHtml = data.byTeam.map(team => {
    let fillClass = 'good';
    if (team.percentage < 50) fillClass = 'critical';
    else if (team.percentage < 70) fillClass = 'warning';

    return `
      <div class="completion-widget__item">
        <div class="completion-widget__item-left">
          <span class="completion-widget__item-icon">${team.icon}</span>
          <span class="completion-widget__item-name">${team.name}</span>
        </div>
        <div class="completion-widget__item-right">
          <div class="completion-widget__item-bar">
            <div class="completion-widget__item-bar-fill completion-widget__item-bar-fill--${fillClass}" style="width: ${team.percentage}%"></div>
          </div>
          <span class="completion-widget__item-value">${team.completed}/${team.total}</span>
        </div>
      </div>
    `;
  }).join('');

  // Build impact items
  const impactItemsHtml = data.byImpact.map(impact => {
    let fillClass = 'good';
    if (impact.percentage < 50) fillClass = 'critical';
    else if (impact.percentage < 70) fillClass = 'warning';

    return `
      <div class="completion-widget__item">
        <div class="completion-widget__item-left">
          <span class="completion-widget__item-name">${impact.name}</span>
        </div>
        <div class="completion-widget__item-right">
          <div class="completion-widget__item-bar">
            <div class="completion-widget__item-bar-fill completion-widget__item-bar-fill--${fillClass}" style="width: ${impact.percentage}%"></div>
          </div>
          <span class="completion-widget__item-value">${impact.percentage}%</span>
        </div>
      </div>
    `;
  }).join('');

  return `
    <div class="completion-widget">
      <div class="completion-widget__header">
        <h3 class="completion-widget__title">${config.title}</h3>
        <span class="text-sm text-gray-500">${data.todayStats.completed}/${data.todayStats.assigned} done</span>
      </div>

      <div class="completion-widget__overall">
        <div class="completion-widget__circle">
          <svg width="120" height="120" viewBox="0 0 120 120">
            <circle class="completion-widget__circle-bg" cx="60" cy="60" r="50"></circle>
            <circle class="completion-widget__circle-progress completion-widget__circle-progress--${statusClass}"
                    cx="60" cy="60" r="50"
                    stroke-dasharray="${circumference}"
                    stroke-dashoffset="${dashOffset}"></circle>
          </svg>
          <span class="completion-widget__percentage">${overallPercentage}%</span>
        </div>
        <div class="completion-widget__label">${config.overallLabel}</div>
      </div>

      <div class="completion-widget__section">
        <div class="completion-widget__section-title">${config.byTeamLabel}</div>
        ${teamItemsHtml}
      </div>

      <div class="completion-widget__section">
        <div class="completion-widget__section-title">${config.byPriorityLabel}</div>
        ${impactItemsHtml}
      </div>
    </div>
  `;
}

/**
 * Render the Executive dashboard
 * @returns {string} HTML string
 */
function renderExecutiveDashboard() {
  const { dashboardConfig, summary, accountabilityTable, topP0Alerts, actionableCompletion } = mockData;
  const execConfig = dashboardConfig.executive;

  // Build header meta info
  const labels = execConfig.headerLabels;
  const headerMeta = `
    <div class="dashboard-header__meta pill-group">
      <span class="pill">
        <span class="pill__label">${labels.date}:</span>
        <span class="pill__value">${summary.date}</span>
      </span>
      <span class="pill">
        <span class="pill__label">${labels.city}:</span>
        <span class="pill__value">${summary.city}</span>
      </span>
      <span class="pill">
        <span class="pill__label">${labels.category}:</span>
        <span class="pill__value">${summary.category}</span>
      </span>
      <span class="pill">
        <span class="pill__label">${labels.tracking}:</span>
        <span class="pill__value">${summary.trackedSkus.toLocaleString()} SKUs</span>
      </span>
    </div>
  `;

  // Build KPIs section
  const kpisHtml = createExecutiveKpis(summary);

  // Build accountability table
  const accountabilityHtml = createAccountabilityTable(accountabilityTable, execConfig.tables.accountability);

  // Build top P0 alerts table
  const topAlertsHtml = createTopAlertsTable(topP0Alerts, execConfig.tables.topAlerts);

  // Build completion widget
  const completionWidgetHtml = createCompletionWidget(actionableCompletion, execConfig.completionWidget);

  // Build KPI dependency tree
  const kpiTreeHtml = createKpiTree(dashboardConfig.kpiTree.title);

  return `
    <div class="dashboard-header">
      <div class="dashboard-header__top">
        <h1 class="dashboard-header__title">
          <span class="dashboard-header__icon">${execConfig.icon}</span>
          ${execConfig.name}
        </h1>
      </div>
      ${headerMeta}
    </div>

    <div class="dashboard-content">
      <!-- KPIs Row -->
      ${kpisHtml}

      <!-- KPI Dependency Tree (shows GMV breakdown by persona) -->
      ${kpiTreeHtml}

      <!-- Accountability Table -->
      <div class="mb-6">
        ${accountabilityHtml}
      </div>

      <!-- Top P0 Alerts + Completion Widget Row -->
      <div class="exec-row">
        <div>
          ${topAlertsHtml}
        </div>
        <div>
          ${completionWidgetHtml}
        </div>
      </div>
    </div>
  `;
}

/**
 * Initialize charts after render (placeholder for future chart.js integrations)
 */
function initExecutiveCharts() {
  // No chart.js charts currently in use
  // KPI trees and other visualizations use HTML/CSS
}


// === js/pages/persona-dashboard.js ===
/**
 * Unified Persona Dashboard Template
 * Renders any persona dashboard using configuration from mock-data.js
 */


/**
 * Persona configuration mapping
 * Maps persona keys to their data keys and KPI prefixes
 */
const PERSONA_CONFIG = {
  'category': {
    dataKey: 'categoryManagement',
    kpiPrefix: 'cat',
    filters: [
      {
        placeholder: 'All Brands',
        field: 'entity',
        items: [
          { value: '', label: 'All Brands' },
          { value: 'Coca-Cola', label: 'Coca-Cola' },
          { value: 'Britannia', label: 'Britannia' },
          { value: 'Nestle', label: 'Nestle' },
          { value: 'Amul', label: 'Amul' }
        ]
      }
    ]
  },
  'procurement': {
    dataKey: 'procurement',
    kpiPrefix: 'proc',
    filters: [
      {
        placeholder: 'All Warehouses',
        field: 'entity',
        items: [
          { value: '', label: 'All Warehouses' },
          { value: 'Central WH', label: 'Central WH' },
          { value: 'Whitefield Hub', label: 'Whitefield Hub' },
          { value: 'Bommanahalli Hub', label: 'Bommanahalli Hub' },
          { value: 'Yelahanka Hub', label: 'Yelahanka Hub' }
        ]
      }
    ]
  },
  'pod-ops': {
    dataKey: 'podOps',
    kpiPrefix: 'pod',
    filters: [
      {
        placeholder: 'All Pods',
        field: 'entity',
        items: [
          { value: '', label: 'All Pods' },
          { value: 'HSR Layout Store', label: 'HSR Layout' },
          { value: 'Koramangala Store', label: 'Koramangala' },
          { value: 'Indiranagar Store', label: 'Indiranagar' },
          { value: 'Whitefield Store', label: 'Whitefield' },
          { value: 'Jayanagar Store', label: 'Jayanagar' }
        ]
      }
    ]
  },
  'planning': {
    dataKey: 'planning',
    kpiPrefix: 'plan',
    filters: [
      {
        placeholder: 'All Warehouses',
        field: 'entity',
        items: [
          { value: '', label: 'All Warehouses' },
          { value: 'Central WH', label: 'Central WH' },
          { value: 'Whitefield Hub', label: 'Whitefield Hub' },
          { value: 'Electronic City Hub', label: 'Electronic City' },
          { value: 'Bommanahalli Hub', label: 'Bommanahalli' }
        ]
      }
    ]
  },
  'warehouse': {
    dataKey: 'warehouse',
    kpiPrefix: 'wh',
    filters: [
      {
        placeholder: 'All Warehouses',
        field: 'entity',
        items: [
          { value: '', label: 'All Warehouses' },
          { value: 'Whitefield Hub', label: 'Whitefield Hub' },
          { value: 'Bommanahalli Hub', label: 'Bommanahalli Hub' },
          { value: 'Central WH', label: 'Central WH' },
          { value: 'Yelahanka Hub', label: 'Yelahanka Hub' }
        ]
      }
    ]
  },
  'erp-team': {
    dataKey: 'erpTeam',
    kpiPrefix: 'erp',
    filters: [
      {
        placeholder: 'All Cities',
        field: 'entity',
        items: [
          { value: '', label: 'All Cities' },
          { value: 'Bangalore', label: 'Bangalore' }
        ]
      }
    ]
  },
  'product-support': {
    dataKey: 'productSupport',
    kpiPrefix: 'ps',
    filters: [
      {
        placeholder: 'All Issue Types',
        field: 'entity',
        items: [
          { value: '', label: 'All Issue Types' },
          { value: 'Stale Override Rules', label: 'Stale Rules' },
          { value: 'Holiday Calendar Config', label: 'Holiday Config' },
          { value: 'OOS Override Accumulation', label: 'OOS Overrides' },
          { value: 'CR Rule Conflicts', label: 'CR Conflicts' }
        ]
      }
    ]
  }
};

/**
 * Get common filter options (shared across all personas)
 * Values come from dashboardConfig.persona.filters
 */
function getCommonFilters() {
  const filterConfig = mockData.dashboardConfig.persona.filters;
  return {
    priority: {
      placeholder: filterConfig.priority.placeholder,
      field: 'priority',
      items: [
        { value: '', label: filterConfig.priority.options[0] },
        { value: 'P0', label: filterConfig.priority.options[1] },
        { value: 'P1', label: filterConfig.priority.options[2] },
        { value: 'P2', label: filterConfig.priority.options[3] }
      ]
    },
    sort: {
      placeholder: filterConfig.sort.placeholder,
      field: 'sort',
      items: [
        { value: 'gmv', label: filterConfig.sort.options[0] },
        { value: 'days', label: filterConfig.sort.options[1] },
        { value: 'priority', label: filterConfig.sort.options[2] }
      ]
    }
  };
}

/**
 * Render a persona dashboard
 * @param {string} personaKey - Key identifying the persona (e.g., 'category', 'procurement')
 * @returns {string} HTML string
 */
function renderPersonaDashboard(personaKey) {
  const config = PERSONA_CONFIG[personaKey];
  if (!config) {
    return `<div class="error">Unknown persona: ${personaKey}</div>`;
  }

  const personaData = mockData[config.dataKey];
  if (!personaData) {
    return `<div class="error">No data for persona: ${personaKey}</div>`;
  }

  const { persona, kpis, alerts } = personaData;
  const dashConfig = mockData.dashboardConfig.persona;

  // Build KPIs section
  const kpisHtml = createPersonaKpis(kpis, config.kpiPrefix);

  // Build alerts section
  const alertsHtml = createAlertSection(alerts, dashConfig.sections.alerts, 5);

  // Build actionables section - derived from alerts, top 5 by GMV
  const topActionables = getTopActionablesFromAlerts(alerts, 5);
  const actionablesHtml = createActionablesSection(topActionables, dashConfig.sections.actionables);

  // Build filters: persona-specific + common filters
  const commonFilters = getCommonFilters();
  const allFilters = [
    ...config.filters,
    commonFilters.priority,
    commonFilters.sort
  ];

  const labels = dashConfig.labels;

  return `
    <div class="dashboard-header">
      <div class="dashboard-header__top">
        <h1 class="dashboard-header__title">
          <span class="dashboard-header__icon">${persona.icon}</span>
          ${persona.name}
        </h1>
      </div>
      <div class="dashboard-header__meta pill-group">
        <span class="pill">
          <span class="pill__label">${labels.level}:</span>
          <span class="pill__value">${persona.level}</span>
        </span>
        <span class="pill">
          <span class="pill__label">${labels.aggregateBy}:</span>
          <span class="pill__value">${persona.aggregateBy ? persona.aggregateBy.join(', ') : persona.level}</span>
        </span>
        <span class="pill">
          <span class="pill__label">${labels.focus}:</span>
          <span class="pill__value">${persona.description}</span>
        </span>
      </div>
    </div>

    <div class="dashboard-content">
      <!-- KPIs Row -->
      ${kpisHtml}

      <!-- Filter Bar -->
      ${createFilterBar(allFilters)}

      <!-- Alerts Section -->
      <div class="mb-6">
        ${alertsHtml}
      </div>

      <!-- Actionables Section -->
      ${actionablesHtml}
    </div>
  `;
}

/**
 * Initialize a persona dashboard after render
 * @param {string} personaKey - Key identifying the persona
 */
function initPersonaDashboard(personaKey) {
  const config = PERSONA_CONFIG[personaKey];
  if (!config) return;

  const personaData = mockData[config.dataKey];
  if (!personaData) return;

  initAlertSparklines(personaData.alerts);
}

/**
 * Get persona configuration
 * @param {string} personaKey - Key identifying the persona
 * @returns {Object} Persona configuration
 */
function getPersonaConfig(personaKey) {
  return PERSONA_CONFIG[personaKey] || null;
}

/**
 * Get all available persona keys
 * @returns {string[]} Array of persona keys
 */
function getAllPersonaKeys() {
  return Object.keys(PERSONA_CONFIG);
}


// === js/router.js ===
/**
 * Hash-based Client-side Router
 * Handles SPA navigation without server configuration
 */


/**
 * Route definitions
 * Executive dashboard uses its own module, persona dashboards use unified template
 */
const routes = {
  '/': {
    name: 'Executive',
    module: () => import('./pages/executive.js'),
    render: 'renderExecutiveDashboard',
    init: 'initExecutiveCharts'
  },
  // Persona dashboards - all use unified template with personaKey
  '/category': {
    name: 'Category Management',
    module: () => import('./pages/persona-dashboard.js'),
    render: 'renderPersonaDashboard',
    init: 'initPersonaDashboard',
    personaKey: 'category'
  },
  '/procurement': {
    name: 'Procurement',
    module: () => import('./pages/persona-dashboard.js'),
    render: 'renderPersonaDashboard',
    init: 'initPersonaDashboard',
    personaKey: 'procurement'
  },
  '/pod-ops': {
    name: 'Pod Ops',
    module: () => import('./pages/persona-dashboard.js'),
    render: 'renderPersonaDashboard',
    init: 'initPersonaDashboard',
    personaKey: 'pod-ops'
  },
  '/planning': {
    name: 'Planning',
    module: () => import('./pages/persona-dashboard.js'),
    render: 'renderPersonaDashboard',
    init: 'initPersonaDashboard',
    personaKey: 'planning'
  },
  '/warehouse': {
    name: 'Warehouse',
    module: () => import('./pages/persona-dashboard.js'),
    render: 'renderPersonaDashboard',
    init: 'initPersonaDashboard',
    personaKey: 'warehouse'
  },
  '/erp-team': {
    name: 'ERP Team',
    module: () => import('./pages/persona-dashboard.js'),
    render: 'renderPersonaDashboard',
    init: 'initPersonaDashboard',
    personaKey: 'erp-team'
  },
  '/product-support': {
    name: 'Product Support',
    module: () => import('./pages/persona-dashboard.js'),
    render: 'renderPersonaDashboard',
    init: 'initPersonaDashboard',
    personaKey: 'product-support'
  }
};

/**
 * Router class
 */
class Router {
  constructor(contentElement) {
    this.contentElement = contentElement;
    this.currentRoute = null;

    // Bind the hashchange handler
    window.addEventListener('hashchange', () => this.handleRoute());

    // Handle initial route
    this.handleRoute();
  }

  /**
   * Get current route path from hash
   * @returns {string} Route path
   */
  getPath() {
    const hash = window.location.hash.slice(1); // Remove #
    return hash || '/';
  }

  /**
   * Navigate to a route
   * @param {string} path - Route path
   */
  navigate(path) {
    window.location.hash = path;
  }

  /**
   * Handle route change
   */
  async handleRoute() {
    const path = this.getPath();
    const route = routes[path];

    if (!route) {
      // 404 - redirect to home
      this.navigate('/');
      return;
    }

    // Update current route
    this.currentRoute = path;

    // Show loading state
    this.contentElement.innerHTML = `
      <div class="loading">
        <div class="loading__spinner"></div>
      </div>
    `;

    try {
      // Dynamically import the page module
      const module = await route.module();

      // Render the page (pass personaKey if defined)
      const renderFn = module[route.render];
      if (renderFn) {
        this.contentElement.innerHTML = route.personaKey
          ? renderFn(route.personaKey)
          : renderFn();
      }

      // Initialize page (charts, sparklines, etc.)
      if (route.init && module[route.init]) {
        // Small delay to ensure DOM is ready
        setTimeout(() => {
          route.personaKey
            ? module[route.init](route.personaKey)
            : module[route.init]();
        }, 100);
      }

      // Update active nav item
      this.updateActiveNav(path);

    } catch (error) {
      console.error('Error loading route:', error);
      this.contentElement.innerHTML = `
        <div class="empty-state">
          <div class="empty-state__icon">âš ï¸</div>
          <div class="empty-state__title">Error Loading Page</div>
          <div class="empty-state__description">${error.message}</div>
        </div>
      `;
    }
  }

  /**
   * Update active state on nav items
   * @param {string} path - Current route path
   */
  updateActiveNav(path) {
    // Remove active class from all nav items
    document.querySelectorAll('.nav-item').forEach(item => {
      item.classList.remove('active');
    });

    // Add active class to current nav item
    const activeItem = document.querySelector(`.nav-item[href="#${path}"]`);
    if (activeItem) {
      activeItem.classList.add('active');
    }
  }
}

/**
 * Get navigation items for sidebar
 * Badge counts are calculated dynamically from alert data
 * @returns {Array} Navigation items
 */
function getNavItems() {
  // Get alert counts from mock data
  const alertCounts = {
    category: mockData.categoryManagement?.alerts?.length || 0,
    procurement: mockData.procurement?.alerts?.length || 0,
    podOps: mockData.podOps?.alerts?.length || 0,
    planning: mockData.planning?.alerts?.length || 0,
    warehouse: mockData.warehouse?.alerts?.length || 0,
    erpTeam: mockData.erpTeam?.alerts?.length || 0,
    productSupport: mockData.productSupport?.alerts?.length || 0
  };

  return [
    {
      section: 'Overview',
      items: [
        { path: '/', name: 'Executive Dashboard', icon: 'ðŸ“Š' }
      ]
    },
    {
      section: 'Team Dashboards',
      items: [
        { path: '/category', name: 'Category Management', icon: 'ðŸ“¦', badge: alertCounts.category, badgeLabel: 'Active Alerts' },
        { path: '/procurement', name: 'Procurement', icon: 'ðŸ­', badge: alertCounts.procurement, badgeLabel: 'Active Alerts' },
        { path: '/pod-ops', name: 'Pod Ops', icon: 'ðŸª', badge: alertCounts.podOps, badgeLabel: 'Active Alerts' },
        { path: '/planning', name: 'Planning', icon: 'ðŸ“‹', badge: alertCounts.planning, badgeLabel: 'Active Alerts' },
        { path: '/warehouse', name: 'Warehouse', icon: 'ðŸ¢', badge: alertCounts.warehouse, badgeLabel: 'Active Alerts' },
        { path: '/erp-team', name: 'ERP Team', icon: 'âš™ï¸', badge: alertCounts.erpTeam, badgeLabel: 'Active Alerts' },
        { path: '/product-support', name: 'Product Support', icon: 'ðŸ”§', badge: alertCounts.productSupport, badgeLabel: 'Active Alerts' }
      ]
    }
  ];
}


// === js/app.js ===
/**
 * Main Application Entry Point
 * Initializes router and renders sidebar navigation
 */


/**
 * Render the sidebar navigation
 * @returns {string} HTML string
 */
function renderSidebar() {
  const navSections = getNavItems();

  const sectionsHtml = navSections.map(section => {
    const itemsHtml = section.items.map(item => {
      const badgeHtml = item.badge
        ? `<span class="nav-item__badge" title="${item.badgeLabel || 'Count'}">${item.badge}</span>`
        : '';

      return `
        <a href="#${item.path}" class="nav-item" data-route="${item.path}">
          <span class="nav-item__icon">${item.icon}</span>
          <span class="nav-item__label">${item.name}</span>
          ${badgeHtml}
        </a>
      `;
    }).join('');

    return `
      <div class="sidebar__section">
        <div class="sidebar__section-title">${section.section}</div>
        ${itemsHtml}
      </div>
    `;
  }).join('');

  return `
    <div class="sidebar__header">
      <div class="sidebar__logo">
        <div class="sidebar__logo-icon">ðŸ§ </div>
        <div>
          <div class="sidebar__logo-text">Supply Chain Brain</div>
          <div class="sidebar__logo-subtitle">Availability ActionBoard</div>
        </div>
      </div>
    </div>
    <nav class="sidebar__nav">
      ${sectionsHtml}
    </nav>
    <div class="sidebar__footer" style="padding: var(--space-4); border-top: 1px solid rgba(255,255,255,0.1); margin-top: auto;">
      <div style="font-size: var(--text-xs); color: var(--color-gray-400);">
        Mock Dashboard v0.1<br>
        Last updated: Jan 14, 2026
      </div>
    </div>
  `;
}

/**
 * Initialize the application
 */
function initApp() {
  // Get DOM elements
  const sidebarElement = document.getElementById('sidebar');
  const contentElement = document.getElementById('main-content');

  if (!sidebarElement || !contentElement) {
    console.error('Required DOM elements not found');
    return;
  }

  // Render sidebar
  sidebarElement.innerHTML = renderSidebar();

  // Initialize router
  const router = new Router(contentElement);

  // Setup mobile menu toggle
  setupMobileMenu();

  // Log initialization
  console.log('Availability Monitoring Dashboard initialized');
}

/**
 * Setup mobile menu functionality
 */
function setupMobileMenu() {
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('mobile-overlay');
  const menuToggle = document.getElementById('mobile-menu-toggle');

  if (menuToggle) {
    menuToggle.addEventListener('click', () => {
      sidebar.classList.toggle('open');
      overlay.classList.toggle('visible');
    });
  }

  if (overlay) {
    overlay.addEventListener('click', () => {
      sidebar.classList.remove('open');
      overlay.classList.remove('visible');
    });
  }

  // Close menu on nav item click (mobile)
  document.addEventListener('click', (e) => {
    if (e.target.closest('.nav-item') && window.innerWidth < 768) {
      sidebar.classList.remove('open');
      overlay.classList.remove('visible');
    }
  });
}

// Initialize when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initApp);
} else {
  initApp();
}



// Router fix for bundled version (no dynamic imports)
const pageModules = {
  '/': { render: renderExecutiveDashboard, init: initExecutiveCharts },
  '/category': { render: () => renderPersonaDashboard('category'), init: () => initPersonaDashboard('category') },
  '/procurement': { render: () => renderPersonaDashboard('procurement'), init: () => initPersonaDashboard('procurement') },
  '/pod-ops': { render: () => renderPersonaDashboard('pod-ops'), init: () => initPersonaDashboard('pod-ops') },
  '/planning': { render: () => renderPersonaDashboard('planning'), init: () => initPersonaDashboard('planning') },
  '/warehouse': { render: () => renderPersonaDashboard('warehouse'), init: () => initPersonaDashboard('warehouse') },
  '/erp-team': { render: () => renderPersonaDashboard('erp-team'), init: () => initPersonaDashboard('erp-team') },
  '/product-support': { render: () => renderPersonaDashboard('product-support'), init: () => initPersonaDashboard('product-support') }
};

// Override Router handleRoute for bundled version
Router.prototype.handleRoute = async function() {
  const path = this.getPath();
  const route = routes[path];
  const pageModule = pageModules[path];

  if (!route || !pageModule) {
    this.navigate('/');
    return;
  }

  this.currentRoute = path;

  // Render the page
  if (pageModule.render) {
    this.contentElement.innerHTML = pageModule.render();
  }

  // Initialize page
  if (pageModule.init) {
    setTimeout(() => pageModule.init(), 100);
  }

  this.updateActiveNav(path);
};


// Mobile toggle
function updateMobileToggle() {
  const toggle = document.getElementById('mobile-menu-toggle');
  if (toggle) toggle.style.display = window.innerWidth < 768 ? 'flex' : 'none';
}
updateMobileToggle();
window.addEventListener('resize', updateMobileToggle);
  </script>
</body>
</html>